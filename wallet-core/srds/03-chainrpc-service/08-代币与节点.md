# 代币与节点管理

> 返回 [ChainRPC 服务目录](./README.md)

---

## 代币信息

### F-CRPC-023: 查询代币信息

**描述**: 获取代币合约的详细信息。

**gRPC 方法**: `GetTokenInfo`

**请求 Schema**:
```json
{
  "chain": 1,
  "token_contract": "TR7N..."
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "",
  "token_info": {
    "contract_address": "TR7N...",
    "name": "Tether USD",
    "symbol": "USDT",
    "decimals": 6,
    "total_supply": "40000000000000000",
    "total_supply_formatted": "40,000,000,000",
    "owner": "TXyz...",
    "verified": true,
    "price_usd": 1.0
  }
}
```

---

### F-CRPC-024: 批量查询代币信息

**描述**: 批量获取多个代币的信息。

**gRPC 方法**: `GetTokenInfoBatch`

**请求 Schema**:
```json
{
  "chain": 1,
  "token_contracts": ["TR7N...", "TABC..."]
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "",
  "tokens": [...],
  "total": 2
}
```

---

## 节点管理

### F-CRPC-025: 节点健康检查

**描述**: 检查 RPC 节点的健康状态。

**gRPC 方法**: `HealthCheck`

**请求 Schema**:
```json
{
  "chain": 1                            // 可选，空则检查所有
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "",
  "chains": [
    {
      "chain": 1,
      "healthy": true,
      "current_node": "quicknode-tron-1",
      "response_time_ms": 150,
      "block_height": 12345678,
      "last_block_time": 1702300800,
      "error_message": ""
    }
  ],
  "healthy_count": 4,
  "total_count": 4
}
```

---

### F-CRPC-026: 获取节点状态

**描述**: 获取节点的详细状态信息。

**gRPC 方法**: `GetNodeStatus`

**请求 Schema**:
```json
{
  "chain": 1
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "",
  "nodes": [
    {
      "node_id": "quicknode-tron-1",
      "node_type": 1,                   // NodeType 枚举
      "endpoint": "https://...",
      "healthy": true,
      "response_time_ms": 150,
      "success_rate": 99,
      "total_requests": 10000,
      "failed_requests": 10,
      "last_success_time": 1702300800,
      "last_error": "",
      "is_primary": true,
      "weight": 1.0
    }
  ],
  "active_node": "quicknode-tron-1"
}
```

**节点类型枚举**:

| 值 | 名称 | 描述 |
|----|------|------|
| 1 | NODE_TYPE_QUICKNODE | QuickNode |
| 2 | NODE_TYPE_INFURA | Infura |
| 3 | NODE_TYPE_ALCHEMY | Alchemy |
| 4 | NODE_TYPE_ANKR | Ankr |
| 5 | NODE_TYPE_CUSTOM | 自建节点 |

---

### F-CRPC-027: 切换节点

**描述**: 手动切换到指定的 RPC 节点。

**gRPC 方法**: `SwitchNode`

**请求 Schema**:
```json
{
  "chain": 1,
  "node_id": "infura-tron-1",
  "force": false
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "",
  "old_node": "quicknode-tron-1",
  "new_node": "infura-tron-1",
  "switched_at": 1702300800
}
```

---

### F-CRPC-028: 测试节点连接

**描述**: 测试自定义 RPC 节点的连接。

**gRPC 方法**: `TestNode`

**请求 Schema**:
```json
{
  "chain": 1,
  "endpoint": "https://custom-rpc.example.com",
  "headers": {
    "X-Api-Key": "your-api-key"
  },
  "timeout_seconds": 10
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "",
  "healthy": true,
  "response_time_ms": 200,
  "block_height": 12345678,
  "chain_id": "1",
  "node_info": {
    "version": "v1.0.0",
    "network": "mainnet"
  }
}
```
