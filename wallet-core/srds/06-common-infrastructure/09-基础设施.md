# 基础设施

## Docker Compose 配置

**文件**: `deploy/docker/docker-compose.yml`

---

## 1. MariaDB

- **镜像**: mariadb:10.11
- **端口**: 3306
- **功能**: 主数据库
- **配置**:
  - 数据库: crypto_exchange
  - 字符集: utf8mb4
  - 时区: Asia/Shanghai
  - 数据持久化: mariadb_data volume

---

## 2. Redis

- **镜像**: redis:7-alpine
- **端口**: 6379
- **功能**: 缓存、速率限制、验证码存储
- **配置**:
  - AOF 持久化
  - 密码保护
  - 数据持久化: redis_data volume

---

## 3. Kafka

- **镜像**: confluentinc/cp-kafka:7.5.0
- **端口**: 9092 (内部), 9093 (外部)
- **功能**: 异步消息队列
- **依赖**: Zookeeper
- **配置**:
  - 自动创建 Topic
  - 单副本模式

---

## 4. Zookeeper

- **镜像**: confluentinc/cp-zookeeper:7.5.0
- **端口**: 2181
- **功能**: Kafka 协调服务

---

## 5. ETCD

- **镜像**: quay.io/coreos/etcd:v3.5.9
- **端口**: 2379 (客户端), 2380 (对等)
- **功能**: 服务发现、配置中心
- **配置**:
  - 单节点模式
  - 数据持久化: etcd_data volume

---

## 6. Prometheus

- **镜像**: prom/prometheus:latest
- **端口**: 9090
- **功能**: 指标收集和存储
- **配置**:
  - 配置文件: prometheus/prometheus.yml
  - 数据持久化: prometheus_data volume

---

## 7. Grafana

- **镜像**: grafana/grafana:latest
- **端口**: 3000
- **功能**: 监控仪表板
- **配置**:
  - 禁用用户注册
  - 数据持久化: grafana_data volume

---

## 8. Jaeger

- **镜像**: jaegertracing/all-in-one:latest
- **端口**:
  - 16686: Web UI
  - 6831/6832: Agent (UDP)
  - 14268: Collector HTTP
  - 14250: Collector gRPC
- **功能**: 分布式链路追踪

---

## 网络配置

所有服务通过 `crypto-network` 桥接网络互联。

---

## 数据卷

| Volume | 用途 |
|--------|------|
| mariadb_data | MariaDB 数据 |
| redis_data | Redis 持久化数据 |
| zookeeper_data | Zookeeper 数据 |
| zookeeper_logs | Zookeeper 日志 |
| kafka_data | Kafka 数据 |
| prometheus_data | Prometheus 指标数据 |
| grafana_data | Grafana 配置和仪表板 |
| etcd_data | ETCD 数据 |
