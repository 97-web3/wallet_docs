# Internal-Wallet 软件需求文档 (SRD)

## 文档目录

本目录包含 Internal-Wallet 加密货币钱包系统的完整软件需求文档，按模块组织，记录所有已实现的功能。

---

## 1. 项目概述

**Internal-Wallet** 是一个基于 Go-Zero 微服务架构构建的企业级加密货币交易所内部钱包系统。

### 1.1 核心功能

- **多链钱包管理**: 支持 Ethereum、BSC、TRON 等多条区块链
- **HD 钱包**: BIP39/BIP44 分层确定性钱包实现
- **安全签名**: 热/冷钱包分离，交易签名审计
- **区块链同步**: 实时区块同步、存款监控、余额追踪
- **用户管理**: 认证、资产管理、内部转账

### 1.2 系统架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                          客户端应用                                 │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    API 网关 (HTTP → gRPC)                           │
│  - JWT 认证    - 速率限制    - CORS    - 验证码                     │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
                    ▼               ▼               ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│   业务服务   │ │   链RPC服务  │ │  链同步服务  │ │   签名服务   │
│              │ │              │ │              │ │              │
│ - 用户认证   │ │ - 地址生成   │ │ - 区块同步   │ │ - HD 钱包    │
│ - 资金转移   │ │ - 交易构建   │ │ - 存款监控   │ │ - 交易签名   │
│ - 资产管理   │ │ - 广播交易   │ │ - 余额监控   │ │ - 密钥管理   │
│ - 通知中心   │ │              │ │              │ │ - 审计日志   │
└──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘
        │               │               │               │
        └───────────────┴───────┬───────┴───────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                          基础设施层                                 │
│  MariaDB │ Redis │ Kafka │ ETCD │ Prometheus │ Grafana │ Jaeger     │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.3 技术栈

| 类别 | 技术 | 版本 |
|------|------|------|
| 编程语言 | Go | 1.25.4 |
| 微服务框架 | Go-Zero | 1.6.0 |
| RPC | gRPC | 1.75.0 |
| 数据库 | MariaDB | 10.11 |
| 缓存 | Redis | 7.x |
| 消息队列 | Kafka | 7.5.0 |
| 服务发现 | ETCD | 3.5.9 |
| 监控 | Prometheus + Grafana | - |
| 追踪 | Jaeger | - |

---

## 2. 文档列表

| 序号 | 文档名称 | 描述 | 功能数量 |
|------|----------|------|----------|
| 01 | [API 网关](./01-api-gateway.md) | HTTP 网关、路由、认证、速率限制 | 7+ |
| 02 | [业务服务](./02-business-service/) | 用户管理、认证、资产、充提、通知 | 36 RPC |
| 03 | [链 RPC 服务](./03-chainrpc-service/) | 地址生成、交易构建、广播、链上查询 | 28 RPC |
| 04 | [链同步服务](./04-chainsync-service/) | 区块同步、地址监控、余额追踪 | 17 RPC |
| 05 | [签名服务](./05-signer-service/) | HD 钱包、交易签名、密钥管理 | 14 RPC |
| 06 | [通用库与基础设施](./06-common-infrastructure.md) | 共享库、数据库、部署配置 | - |

### 2.1 业务服务 (Business Service)

| 文档 | 描述 |
|------|------|
| [01-用户认证](./02-business-service/01-用户认证.md) | 注册、登录、登出、刷新、密码重置 |
| [02-用户信息管理](./02-business-service/02-用户信息管理.md) | 获取、更新用户信息 |
| [03-资产管理](./02-business-service/03-资产管理.md) | 余额、记录、统计 |
| [04-充值功能](./02-business-service/04-充值功能.md) | 充值地址、充值记录 |
| [05-提现功能](./02-business-service/05-提现功能.md) | 提现申请、提现记录 |
| [06-内部转账](./02-business-service/06-内部转账.md) | 内部转账、转账记录 |
| [07-安全设置](./02-business-service/07-安全设置.md) | 2FA、密码修改、设备管理 |
| [08-通知中心](./02-business-service/08-通知中心.md) | 通知列表、标记已读、设置 |
| [09-偏好设置](./02-business-service/09-偏好设置.md) | 语言、时区、货币 |
| [10-钱包地址管理](./02-business-service/10-钱包地址管理.md) | 地址簿管理 |
| [11-登录记录](./02-business-service/11-登录记录.md) | 登录历史查询 |
| [99-数据模型与配置](./02-business-service/99-数据模型与配置.md) | 数据库、枚举、配置 |

### 2.2 链 RPC 服务 (ChainRPC Service)

| 文档 | 描述 |
|------|------|
| [01-地址管理](./03-chainrpc-service/01-地址管理.md) | 地址生成、验证、批量生成 |
| [02-交易构建](./03-chainrpc-service/02-交易构建.md) | 原生转账、代币转账、批量转账 |
| [03-Gas管理](./03-chainrpc-service/03-Gas管理.md) | Gas 估算、价格获取 |
| [04-交易广播](./03-chainrpc-service/04-交易广播.md) | 广播、加速、取消 |
| [05-链上查询](./03-chainrpc-service/05-链上查询.md) | 余额、代币余额、多地址余额 |
| [06-交易查询](./03-chainrpc-service/06-交易查询.md) | 交易详情、状态、收据 |
| [07-区块查询](./03-chainrpc-service/07-区块查询.md) | 区块高度、区块信息 |
| [08-代币与节点](./03-chainrpc-service/08-代币与节点.md) | 代币信息、节点管理 |
| [99-数据模型与配置](./03-chainrpc-service/99-数据模型与配置.md) | 数据库、配置、依赖 |

### 2.3 链同步服务 (ChainSync Service)

| 文档 | 描述 |
|------|------|
| [01-同步状态管理](./04-chainsync-service/01-同步状态管理.md) | 启动、停止、状态、重置 |
| [02-地址监控](./04-chainsync-service/02-地址监控.md) | 添加、移除、列表 |
| [03-交易监控](./04-chainsync-service/03-交易监控.md) | 交易获取、历史、区块交易 |
| [04-余额监控](./04-chainsync-service/04-余额监控.md) | 单地址、多地址余额 |
| [05-服务商管理](./04-chainsync-service/05-服务商管理.md) | 状态、切换、测试 |
| [06-统计信息](./04-chainsync-service/06-统计信息.md) | 同步统计、性能指标 |
| [99-数据模型与配置](./04-chainsync-service/99-数据模型与配置.md) | 数据库、配置、安全 |

### 2.4 签名服务 (Signer Service)

| 文档 | 描述 |
|------|------|
| [01-种子管理](./05-signer-service/01-种子管理.md) | 初始化、导入、列表、状态 |
| [02-地址生成](./05-signer-service/02-地址生成.md) | 充值地址、路径派生、批量 |
| [03-公钥导出](./05-signer-service/03-公钥导出.md) | 单个、批量导出 |
| [04-交易签名](./05-signer-service/04-交易签名.md) | 单笔、批量签名 |
| [05-消息签名](./05-signer-service/05-消息签名.md) | 消息签名 |
| [06-日志与健康](./05-signer-service/06-日志与健康.md) | 签名日志、健康检查 |
| [99-数据模型与配置](./05-signer-service/99-数据模型与配置.md) | 数据库、加密、配置 |

---

## 3. 支持的区块链

| 链 | 代号 | 原生币 | 代币标准 | 状态 |
|----|------|--------|----------|------|
| TRON | TRN | TRX | TRC20 | 已实现 |
| Binance Smart Chain | BSC | BNB | BEP20 | 已实现 |
| Ethereum | ETH | ETH | ERC20 | 已实现 |
| Polygon | MATIC | MATIC | ERC20 | 已实现 |

---

## 4. 服务端口配置

| 服务 | 默认端口 | 协议 | 描述 |
|------|----------|------|------|
| API Gateway | 8080 | HTTP | 统一入口 |
| Business RPC | 动态 | gRPC | 业务服务 |
| ChainRPC | 动态 | gRPC | 链操作服务 |
| ChainSync | 9001 | gRPC | 链同步服务 |
| Signer RPC | 动态 | gRPC | 签名服务 |

---

## 5. 目录结构参考

```
Internal-Wallet/
├── api-gateway/                    # API 网关
├── services/
│   ├── account/                   # 账户服务
│   ├── business/                  # 业务服务
│   ├── chainrpc/                  # 链 RPC 服务
│   ├── chainsync/                 # 链同步服务
│   └── signer/                    # 签名服务
├── common/                         # 共享库
├── proto/                          # Protocol Buffer 定义
├── deploy/                         # 部署配置
├── docs/                           # 文档
│   ├── srd/                       # 软件需求文档 (本目录)
│   ├── security-issues/           # 安全审计
│   └── gateway/                   # 网关文档
└── scripts/                        # 脚本工具
```
