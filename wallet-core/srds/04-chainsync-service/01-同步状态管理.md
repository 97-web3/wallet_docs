# 同步状态管理

> 返回 [ChainSync 服务目录](./README.md)

---

## F-SYNC-001: 启动同步

**描述**: 启动指定区块链的区块同步任务。

**gRPC 方法**: `StartSync`

**请求 Schema**:
```json
{
  "chain": 1,                           // BlockChainType 枚举
  "start_block": 0,                     // 起始区块，0 表示从最新开始
  "end_block": 0,                       // 结束区块，0 表示持续同步
  "enable_real_time": true,             // 启用实时同步
  "addresses": ["TKvjY...", "TAbcD..."], // 监控地址列表
  "monitor_type": 4,                    // MonitorType 枚举
  "priority": 2                         // Priority 枚举
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "同步任务已启动",
  "sync_id": "sync_tron_001",
  "current_block": 12345678,
  "latest_block": 12345700
}
```

---

## F-SYNC-002: 停止同步

**描述**: 停止指定的同步任务。

**gRPC 方法**: `StopSync`

**请求 Schema**:
```json
{
  "sync_id": "sync_tron_001",           // 同步任务 ID
  "chain": 1                            // 可选：区块链类型
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "同步任务已停止",
  "sync_id": "sync_tron_001",
  "final_status": 1                     // SyncStatus 枚举
}
```

---

## F-SYNC-003: 获取同步状态

**描述**: 获取同步任务的当前状态。

**gRPC 方法**: `GetSyncStatus`

**请求 Schema**:
```json
{
  "chain": 1,                           // 可选：过滤链
  "sync_id": ""                         // 可选：指定任务 ID
}
```

**响应 Schema**:
```json
{
  "success": true,
  "sync_infos": [
    {
      "sync_id": "sync_tron_001",
      "chain": 1,
      "status": 2,                      // SyncStatus 枚举
      "current_block": 12345690,
      "latest_block": 12345700,
      "start_block": 12345000,
      "end_block": 0,
      "blocks_per_second": 10,
      "estimated_remaining_seconds": 1,
      "last_error": "",
      "last_update_time": 1702300800,
      "start_time": 1702300000,
      "monitored_addresses": ["TKvjY..."],
      "priority": 2
    }
  ],
  "total_syncs": 3,
  "active_syncs": 2
}
```

**同步状态枚举 (SyncStatus)**:

| 值 | 名称 | 描述 |
|----|------|------|
| 1 | SYNC_STATUS_STOPPED | 已停止 |
| 2 | SYNC_STATUS_SYNCING | 同步中 |
| 3 | SYNC_STATUS_CAUGHT_UP | 已追上最新 |
| 4 | SYNC_STATUS_ERROR | 错误 |
| 5 | SYNC_STATUS_PAUSED | 暂停 |

---

## F-SYNC-004: 重置同步位置

**描述**: 重置同步任务到指定区块重新开始。

**gRPC 方法**: `ResetSync`

**请求 Schema**:
```json
{
  "chain": 1,
  "reset_block": 12345000,              // 重置到的区块号
  "sync_id": ""                         // 可选：指定任务
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "同步已重置",
  "sync_id": "sync_tron_001",
  "reset_to_block": 12345000
}
```
