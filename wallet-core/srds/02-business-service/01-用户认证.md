# 用户认证

> 返回 [业务服务目录](./README.md)

---

## F-BUS-001: 用户登录

**描述**: 支持手机验证码和 Google OAuth 两种登录方式。

**gRPC 方法**: `Login`

**请求 Schema**:
```json
{
  "method": 1,              // LoginMethod: 1=手机验证码, 2=Google OAuth
  "phone": "13800138000",   // 手机号 (method=1 时)
  "country_code": "86",     // 国际区号
  "code": "123456",         // 手机验证码
  "google_id_token": "",    // Google ID Token (method=2 时)
  "google_auth_code": ""    // Google OAuth 授权码
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "登录成功",
  "user_id": "10001",
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "expires_in": 86400
}
```

**业务规则**:
- 新用户首次登录自动创建账户
- 登录成功后生成 JWT Token
- 记录登录日志 (IP、设备、时间)
- 失败次数过多触发账户锁定

---

## F-BUS-002: 用户登出

**描述**: 使当前会话的 Token 失效。

**gRPC 方法**: `Logout`

**请求 Schema**:
```json
{}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "登出成功"
}
```

---

## F-BUS-003: 发送验证码

**描述**: 发送 SMS 或邮件验证码，用于登录、注册、找回密码等场景。

**gRPC 方法**: `SendVerificationCode`

**请求 Schema**:
```json
{
  "method": 1,     // LoginMethod: 1=手机, 2=邮箱
  "type": 1        // CodeType: 1=注册, 2=登录, 3=重置密码, 4=绑定邮箱, 5=绑定手机, 6=提现, 7=二次验证
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "验证码已发送",
  "expire_seconds": 300
}
```

**验证码类型枚举**:

| 值 | 名称 | 描述 |
|----|------|------|
| 1 | CODE_TYPE_REGISTER | 注册 |
| 2 | CODE_TYPE_LOGIN | 登录 |
| 3 | CODE_TYPE_RESET_PASSWORD | 重置密码 |
| 4 | CODE_TYPE_BIND_EMAIL | 绑定邮箱 |
| 5 | CODE_TYPE_BIND_PHONE | 绑定手机 |
| 6 | CODE_TYPE_WITHDRAW | 提现 |
| 7 | CODE_TYPE_2FA | 二次验证 |

---

## F-BUS-004: 重置密码

**描述**: 通过验证码重置登录密码。

**gRPC 方法**: `ResetPassword`

**请求 Schema**:
```json
{
  "method": 1,              // 验证方式
  "phone": "13800138000",   // 手机号 (二选一)
  "country_code": "86",
  "email": "",              // 邮箱 (二选一)
  "code": "123456",         // 验证码
  "new_password": "NewPass123!"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "密码重置成功"
}
```

---

## F-BUS-005: 修改密码

**描述**: 已登录用户修改密码。

**gRPC 方法**: `ChangePassword`

**请求 Schema**:
```json
{
  "old_password": "OldPass123!",
  "new_password": "NewPass456!"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "密码修改成功"
}
```
