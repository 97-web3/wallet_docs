# 用户信息管理

> 返回 [业务服务目录](./README.md)

---

## F-BUS-006: 获取用户概览

**描述**: 获取当前用户的基本信息和状态概览。

**gRPC 方法**: `GetMyOverview`

**请求 Schema**:
```json
{}
```

**响应 Schema**:
```json
{
  "success": true,
  "uid": "U20251210ABCD",
  "nickname": "用户昵称",
  "avatar": "https://...",
  "role": "user",                       // 角色类型: user/finance/admin
  "role_text": "普通用户",
  "email_bound": true,
  "email_masked": "a***@gmail.com",
  "phone_bound": true,
  "phone_masked": "138****0000",
  "google_auth_enabled": false,
  "has_trade_password": true,
  "biometric_enabled": true,
  "biometric_type": "face_id",
  "platform_bound": true,               // 是否已绑定平台账户
  "platform_uid": "U20251210ABCD",
  "bound_wallet_address": "0x1234...abcd",
  "unread_count": 5,
  "devices_count": 2,
  "language": "zh_CN",
  "theme_mode": "light",
  "price_unit": "USD",
  "kyc_level": 1,
  "kyc_level_text": "初级认证",
  "register_time": "2025-12-10T10:00:00Z",
  "last_login_time": "2025-12-10T15:30:00Z"
}
```

**角色类型说明**:
| 角色 | 枚举值 | 描述 |
|------|--------|------|
| user | 1 | C端用户 (普通用户) |
| finance | 2 | 财务 (可进行薪资发放等操作) |
| admin | 3 | 管理员 (完整后台权限) |

---

## F-BUS-007: 获取个人信息

**描述**: 获取用户详细个人信息。

**gRPC 方法**: `GetPersonalInfo`

**请求 Schema**:
```json
{}
```

**响应 Schema**:
```json
{
  "success": true,
  "real_name": "张三",
  "id_number": "1101***********1234",
  "birthday": "1990-01-01",
  "gender": 1,              // 1=男, 2=女
  "address": "北京市朝阳区"
}
```

---

## F-BUS-008: 更新个人信息

**描述**: 更新用户个人信息。

**gRPC 方法**: `UpdatePersonalInfo`

**请求 Schema**:
```json
{
  "real_name": "张三",
  "id_number": "110101199001011234",
  "birthday": "1990-01-01",
  "gender": 1,
  "address": "北京市朝阳区"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "信息更新成功"
}
```

---

## F-BUS-041: 获取关联钱包地址

**描述**: 获取用户已关联的 Web3 钱包地址列表。

**gRPC 方法**: `ListLinkedWallets`

**请求 Schema**:
```json
{}
```

**响应 Schema**:
```json
{
  "success": true,
  "wallets": [
    {
      "binding_id": "BIND-20251210-001",
      "wallet_address": "0x1234567890123456789012345678901234567890",
      "chain": "ETH",
      "chain_name": "Ethereum",
      "is_primary": true,                 // 是否为主钱包
      "bound_at": "2025-12-10T10:00:00Z",
      "last_used_at": "2025-12-10T15:30:00Z"
    }
  ]
}
```

**业务规则**:
- 1:1 绑定规则: 一个 UID 只能绑定一个钱包地址
- 绑定后，Web2 钱包向该地址提现免审批
- 可通过安全设置解绑后重新绑定其他地址

---

## F-BUS-042: 获取信任设备列表

**描述**: 获取用户的信任设备列表。

**gRPC 方法**: `ListTrustedDevices`

**请求 Schema**:
```json
{}
```

**响应 Schema**:
```json
{
  "success": true,
  "devices": [
    {
      "device_id": "device-uuid-xxx",
      "device_name": "iPhone 15 Pro",
      "device_model": "iPhone 15 Pro",
      "platform": "iOS",
      "os_version": "17.0",
      "biometric_enabled": true,
      "biometric_type": "face_id",
      "biometric_type_text": "Face ID",
      "is_current": true,                 // 是否为当前设备
      "last_used_at": "2025-12-10T15:30:00Z",
      "last_ip": "192.168.1.1",
      "last_location": "北京市",
      "trusted_at": "2025-12-01T10:00:00Z"
    },
    {
      "device_id": "device-uuid-yyy",
      "device_name": "Xiaomi 14",
      "device_model": "Xiaomi 14",
      "platform": "Android",
      "os_version": "14.0",
      "biometric_enabled": true,
      "biometric_type": "fingerprint",
      "biometric_type_text": "指纹识别",
      "is_current": false,
      "last_used_at": "2025-12-09T20:00:00Z",
      "last_ip": "192.168.1.2",
      "last_location": "上海市",
      "trusted_at": "2025-11-15T08:00:00Z"
    }
  ],
  "total": 2
}
```

---

## F-BUS-043: 移除信任设备

**描述**: 移除指定的信任设备，该设备将无法使用生物识别登录。

**gRPC 方法**: `RemoveTrustedDevice`

**请求 Schema**:
```json
{
  "device_id": "device-uuid-yyy",
  "verification": {
    "trade_password": "123456"          // 需要验证身份
  }
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "设备已移除"
}
```

**业务规则**:
- 移除需要身份验证
- 不能移除当前设备 (需先在设置中关闭生物识别)
- 移除后该设备需重新登录并开启生物识别
- 移除操作记入安全日志

---

## F-BUS-066: 更新头像

**描述**: 更新用户头像。

**gRPC 方法**: `UpdateAvatar`

**请求 Schema**:
```json
{
  "avatar_url": "https://..."           // 已上传的头像 URL
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "头像更新成功",
  "avatar_url": "https://..."
}
```

---

## F-BUS-067: 更新昵称

**描述**: 更新用户昵称。

**gRPC 方法**: `UpdateNickname`

**请求 Schema**:
```json
{
  "nickname": "新昵称"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "昵称更新成功"
}
```

**业务规则**:
- 昵称长度: 2-20 个字符
- 不能包含特殊字符和敏感词
- 30 天内只能修改一次
