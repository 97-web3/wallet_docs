# 种子管理

> 返回 [Signer 服务目录](./README.md)

---

## F-SIGN-001: 初始化种子

**描述**: 创建并加密存储新的主种子 (Master Seed)。

**gRPC 方法**: `InitSeed`

**请求 Schema**:
```json
{
  "seed_id": "seed_hot_001",            // 种子唯一标识
  "seed_name": "热钱包主种子",
  "supported_chains": ["TRN", "BSC", "ETH"],
  "temperature": 1,                      // 1=热钱包, 2=冷钱包
  "encryption_password": "SecurePassword123!",
  "description": "主热钱包种子",
  "custom_seed": ""                      // 可选：自定义种子 (hex)
}
```

**响应 Schema**:
```json
{
  "code": 0,
  "message": "种子初始化成功",
  "seed_id": "seed_hot_001",
  "seed_hash": "sha256:abc123...",       // 种子哈希 (用于验证)
  "status": 1,
  "created_at": "2025-12-10T10:00:00Z",
  "mnemonic": "abandon abandon ... about"  // 仅首次返回，需立即备份
}
```

**业务规则**:
- 新种子会自动生成 BIP39 助记词
- 助记词仅在创建时返回一次
- 种子使用 AES-256-GCM 加密后存储
- 加密密钥通过 PBKDF2 派生

---

## 助记词规格

### BIP39 助记词生成规则

| 属性 | 规格 |
|------|------|
| 标准 | BIP39 |
| 词表 | 英文 2048 词表 |
| 长度选项 | 12 词 (128位熵) / 24 词 (256位熵) |
| 默认长度 | 12 词 (推荐用户使用) |
| 校验位 | 4位 (12词) / 8位 (24词) |

### 12 词助记词说明

- **熵长度**: 128 位 (16 字节)
- **校验位**: 4 位 (SHA256 前 4 位)
- **总长度**: 132 位 = 12 × 11 位
- **安全强度**: 2^128 种可能，足够安全
- **使用场景**: C端用户钱包创建

### 24 词助记词说明

- **熵长度**: 256 位 (32 字节)
- **校验位**: 8 位 (SHA256 前 8 位)
- **总长度**: 264 位 = 24 × 11 位
- **安全强度**: 2^256 种可能，极高安全
- **使用场景**: 企业级冷钱包、高价值资产

### 助记词验证规则

```
1. 检查词数量 (12 或 24)
2. 检查每个词是否在 BIP39 词表中
3. 验证校验位正确性
4. 可选: 检查是否包含连续重复词
```

---

## 客户端备份说明

### iCloud 备份 (iOS)

**实现方式**: 客户端本地实现，服务端不存储私钥/助记词

| 步骤 | 说明 |
|------|------|
| 1 | 用户输入交易密码作为加密密钥来源 |
| 2 | 通过 PBKDF2 派生 AES-256 密钥 |
| 3 | 使用 AES-256-GCM 加密助记词 |
| 4 | 将加密数据存储到 iCloud Keychain |
| 5 | 恢复时需输入相同交易密码解密 |

**安全性**:
- 助记词明文永不离开设备
- 云端仅存储加密数据
- 密钥派生参数: PBKDF2, 100000 轮, SHA256

### Google Drive 备份 (Android)

**实现方式**: 与 iCloud 类似，使用 Android Keystore + Google Drive

| 步骤 | 说明 |
|------|------|
| 1 | 用户输入交易密码 |
| 2 | 使用 Android Keystore 派生密钥 |
| 3 | AES-256-GCM 加密助记词 |
| 4 | 存储到 Google Drive App Data 文件夹 |
| 5 | 恢复时需相同设备密钥 + 交易密码 |

---

## F-SIGN-002: 从助记词初始化种子

**描述**: 从已有的 BIP39 助记词导入种子。

**gRPC 方法**: `InitSeedFromMnemonic`

**请求 Schema**:
```json
{
  "seed_id": "seed_cold_001",
  "seed_name": "冷钱包主种子",
  "mnemonic": "abandon abandon abandon ... about",  // 12 或 24 个单词
  "passphrase": "",                      // 可选：BIP39 passphrase
  "supported_chains": ["TRN", "BSC", "ETH"],
  "temperature": 2,                      // 冷钱包
  "description": "从助记词恢复的冷钱包"
}
```

**响应 Schema**:
```json
{
  "code": 0,
  "message": "种子导入成功",
  "seed_id": "seed_cold_001",
  "seed_hash": "sha256:def456...",
  "status": 1,
  "created_at": "2025-12-10T10:00:00Z",
  "mnemonic": ""                         // 导入时不返回助记词
}
```

---

## F-SIGN-003: 查询种子列表

**描述**: 获取所有种子的基本信息。

**gRPC 方法**: `ListSeeds`

**请求 Schema**:
```json
{
  "status": 0                            // 可选：筛选状态 (0=全部)
}
```

**响应 Schema**:
```json
{
  "code": 0,
  "message": "",
  "seeds": [
    {
      "seed_id": "seed_hot_001",
      "seed_name": "热钱包主种子",
      "supported_chains": ["TRN", "BSC", "ETH"],
      "temperature": 1,
      "status": 1,                       // 1=激活, 2=停用, 3=废弃
      "total_signatures": 15000,
      "last_signature_at": "2025-12-10T09:00:00Z",
      "created_at": "2025-01-01T00:00:00Z"
    }
  ]
}
```

**种子状态**:

| 值 | 名称 | 描述 |
|----|------|------|
| 1 | 激活 | 正常使用中 |
| 2 | 停用 | 暂停使用 |
| 3 | 废弃 | 永久停用 |

---

## F-SIGN-004: 更新种子状态

**描述**: 更新种子的状态 (激活/停用/废弃)。

**gRPC 方法**: `UpdateSeedStatus`

**请求 Schema**:
```json
{
  "seed_id": "seed_hot_001",
  "status": 2,                           // 停用
  "reason": "密钥轮换"
}
```

**响应 Schema**:
```json
{
  "code": 0,
  "message": "状态更新成功",
  "seed_id": "seed_hot_001",
  "status": 2,
  "updated_at": "2025-12-10T10:00:00Z"
}
```
