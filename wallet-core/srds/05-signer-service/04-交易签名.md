# 交易签名

> 返回 [Signer 服务目录](./README.md)

---

## F-SIGN-010: 签名交易

**描述**: 对构建好的未签名交易进行签名。

**gRPC 方法**: `SignTransaction`

**请求 Schema**:
```json
{
  "request_id": "req_20251210_001",       // 幂等性 ID
  "seed_id": "seed_hot_001",
  "chain": "TRN",
  "derivation_path": "m/44'/195'/0'/0/10001",
  "raw_transaction": "0a02...",           // hex 编码的未签名交易
  "operation_type": 2,                    // 操作类型
  "amount": "1000000000",                 // 金额 (审计用)
  "to_address": "TAbcD...",               // 目标地址 (审计用)
  "from_address": "TKvjY...",             // 源地址 (审计用)
  "asset_symbol": "TRX",                  // 资产符号 (审计用)
  "token_contract": "",                   // 代币合约 (审计用)
  "requester": "business_service"
}
```

**响应 Schema**:
```json
{
  "code": 0,
  "message": "签名成功",
  "request_id": "req_20251210_001",
  "chain": "TRN",
  "signature": "1b2c3d4e5f...",           // hex 编码签名
  "tx_hash": "abc123def456...",           // 交易哈希
  "signed_at": "2025-12-10T10:00:00Z"
}
```

**操作类型枚举**:

| 值 | 名称 | 描述 |
|----|------|------|
| 1 | 充值 | 充值入账 |
| 2 | 提币 | 用户提现 |
| 3 | 归集 | 资产归集 |
| 4 | 冷转 | 冷钱包转账 |
| 5 | 消息签名 | 消息签名 |
| 6 | 其他 | 其他操作 |

---

## F-SIGN-011: 批量签名

**描述**: 批量签名多笔交易。

**gRPC 方法**: `SignBatch`

**请求 Schema**:
```json
{
  "batch_id": "batch_20251210_001",
  "seed_id": "seed_hot_001",
  "chain": "TRN",
  "operation_type": 3,                    // 归集
  "transactions": [
    {
      "request_id": "req_001",
      "derivation_path": "m/44'/195'/0'/0/10001",
      "raw_transaction": "0a02...",
      "amount": "1000000000",
      "to_address": "TAbcD...",
      "from_address": "TKvjY...",
      "asset_symbol": "TRX",
      "token_contract": ""
    },
    {
      "request_id": "req_002",
      "derivation_path": "m/44'/195'/0'/0/10002",
      "raw_transaction": "0b03...",
      "amount": "2000000000",
      "to_address": "TAbcD...",
      "from_address": "TEfgH...",
      "asset_symbol": "USDT",
      "token_contract": "TR7N..."
    }
  ]
}
```

**响应 Schema**:
```json
{
  "code": 0,
  "message": "",
  "batch_id": "batch_20251210_001",
  "total": 2,
  "success": 2,
  "failed": 0,
  "results": [
    {
      "request_id": "req_001",
      "signature": "1b2c3d...",
      "tx_hash": "abc123...",
      "status": 2,                        // 成功
      "error_msg": ""
    },
    {
      "request_id": "req_002",
      "signature": "4e5f6g...",
      "tx_hash": "def456...",
      "status": 2,
      "error_msg": ""
    }
  ]
}
```
