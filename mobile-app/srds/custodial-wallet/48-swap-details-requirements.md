# 闪兑详情页面 - 软件需求规格说明书

## 1. 页面标识

| 属性 | 值 |
|------|-----|
| 页面ID | CW-048 |
| 页面名称 | 闪兑详情页面 |
| 版本 | 1.0 |
| 更新日期 | 2025-12-09 |
| 状态 | 草稿 |

### 功能描述

用户输入兑换金额，查看实时汇率、滑点、预估到账金额和 Gas 费用。支持设置滑点容差，获取 DEX 聚合器的最优报价。

> 相关规格: [COMMON-001 代币精度规则](../common/token-precision-rules.md) | [COMMON-005 实时汇率集成](../common/price-feed-integration.md) | [COMMON-006 术语表](../common/glossary.md)

---

## 2. UI组件

### 2.1 布局概述

页面采用垂直布局，顶部导航栏，中部为金额输入和汇率显示区域，底部为费用明细和确认按钮。

### 2.2 组件详情

| 组件 | 类型 | 描述 | 位置 |
|------|------|------|------|
| 返回按钮 | 图标按钮 | 左箭头 | 左上角 |
| 页面标题 | 文本标签 | "闪兑" | 标题栏中央 |
| 设置按钮 | 图标按钮 | 齿轮图标，进入滑点设置 | 右上角 |
| 支付金额输入框 | 数字输入框 | 输入要支付的金额 | 中上部 |
| 源代币标签 | 文本标签 | 代币符号（如 USDT） | 输入框右侧 |
| 可用余额 | 文本标签 | "可用: xxx" | 输入框下方 |
| 全部按钮 | 文本按钮 | 点击填入全部余额 | 可用余额右侧 |
| 汇率显示 | 文本标签 | "1 USDT ≈ 0.00xxx ETH" | 中部 |
| 汇率刷新按钮 | 图标按钮 | 刷新图标 | 汇率右侧 |
| 获得金额显示 | 文本标签 | 预估获得的目标代币数量 | 中下部 |
| 目标代币标签 | 文本标签 | 代币符号 | 获得金额右侧 |
| 费用明细卡片 | 卡片组件 | 展示费用详情 | 下部 |
| 汇率行 | 文本标签 | 当前兑换汇率 | 卡片内 |
| 滑点行 | 文本标签 | 滑点容差百分比 | 卡片内 |
| Gas费行 | 文本标签 | 预估 Gas 费用 | 卡片内 |
| 最小获得行 | 文本标签 | 考虑滑点后的最小获得量 | 卡片内 |
| 确认兑换按钮 | 主按钮 | "确认兑换"，荧光绿色 | 底部 |

---

## 3. 功能需求

### FR-CW-048-01: 输入支付金额

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-048-01 |
| **描述** | 用户输入要支付的代币金额 |
| **验收标准** | 1. **假设** 用户输入金额, **当** 输入变化, **则** 实时计算并显示预估获得金额<br>2. **假设** 输入金额超过余额, **当** 验证, **则** 输入框变红并提示"余额不足"<br>3. **假设** 用户点击"全部", **当** 触发, **则** 自动填入可用余额（扣除 Gas 费预留） |
| **优先级** | 必须 |

### FR-CW-048-02: 获取实时汇率

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-048-02 |
| **描述** | 从 DEX 聚合器获取最优兑换汇率 |
| **验收标准** | 1. **假设** 页面加载, **当** 完成, **则** 自动获取当前汇率<br>2. **假设** 汇率获取成功, **当** 显示, **则** 格式为"1 源代币 ≈ x.xxxxxxx 目标代币"<br>3. **假设** 用户点击刷新, **当** 触发, **则** 重新获取最新汇率<br>4. **假设** 汇率自动刷新, **当** 每30秒, **则** 自动更新汇率和预估金额 |
| **优先级** | 必须 |

### FR-CW-048-03: 计算预估获得金额

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-048-03 |
| **描述** | 根据输入金额和汇率计算预估获得量 |
| **验收标准** | 1. **假设** 输入金额和汇率都有效, **当** 计算, **则** 预估获得 = 输入金额 × 汇率<br>2. **假设** 计算结果, **当** 显示, **则** 遵循代币精度规则（7位小数，截断）<br>3. **假设** 考虑滑点, **当** 计算最小获得, **则** 最小获得 = 预估获得 × (1 - 滑点%) |
| **优先级** | 必须 |

### FR-CW-048-04: 滑点设置

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-048-04 |
| **描述** | 用户可设置滑点容差 |
| **验收标准** | 1. **假设** 用户点击设置按钮, **当** 弹出滑点设置, **则** 显示预设选项(0.5%/1%/3%)和自定义输入<br>2. **假设** 选择滑点, **当** 确认, **则** 更新滑点显示和最小获得计算<br>3. **假设** 默认滑点, **当** 首次进入, **则** 使用 Admin 配置的默认滑点 |
| **优先级** | 应该 |

### FR-CW-048-05: Gas费估算

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-048-05 |
| **描述** | 显示预估的链上交易 Gas 费 |
| **验收标准** | 1. **假设** 获取 Gas 价格, **当** 成功, **则** 显示预估 Gas 费（原生代币单位）<br>2. **假设** Gas 费显示, **当** 渲染, **则** 同时显示法币等值（如 ≈ $0.50） |
| **优先级** | 必须 |

### FR-CW-048-06: 最小金额验证

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-048-06 |
| **描述** | 验证兑换金额是否满足最小要求 |
| **验收标准** | 1. **假设** 输入金额法币价值 < 10 USDT, **当** 验证, **则** 提示"最小兑换金额为 10 USDT 等值"<br>2. **假设** 金额不满足最小要求, **当** 点击确认, **则** 阻止提交并显示错误 |
| **优先级** | 必须 |

### FR-CW-048-07: 确认兑换

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-048-07 |
| **描述** | 验证通过后进入确认页面 |
| **验收标准** | 1. **假设** 所有验证通过, **当** 点击确认兑换, **则** 跳转至闪兑确认页 (CW-049)<br>2. **假设** 验证失败, **当** 点击确认, **则** 显示具体错误信息 |
| **优先级** | 必须 |

---

## 4. 用户交互

### 4.1 用户工作流

1. 从选择代币页进入，显示已选代币对
2. 输入要支付的金额（或点击"全部"）
3. 查看实时汇率和预估获得金额
4. （可选）调整滑点设置
5. 确认费用明细
6. 点击"确认兑换"进入下一步

### 4.2 导航流程

```
选择代币 (CW-047) → 闪兑详情 (CW-048) → 闪兑确认 (CW-049)
                          ↓
                    点击返回 → CW-047
```

---

## 5. 数据需求

### 5.1 显示数据

| 数据项 | 数据类型 | 说明 |
|--------|---------|------|
| 可用余额 | Decimal | 源代币可用余额 |
| 汇率 | Decimal | 1 源代币 = x 目标代币 |
| 预估获得 | Decimal | 预估获得的目标代币数量 |
| 滑点 | Percentage | 滑点容差百分比 |
| Gas费 | Decimal | 预估 Gas 费用 |
| 最小获得 | Decimal | 考虑滑点后的最小获得量 |

### 5.2 输入数据

| 字段名称 | 数据类型 | 必填 | 验证规则 |
|---------|---------|------|---------|
| 支付金额 | Decimal | 是 | > 0，≤ 可用余额，≥ 10 USDT 等值 |
| 滑点容差 | Percentage | 否 | 0.1% ~ 50%，默认使用系统配置 |

---

## 6. 验证规则

### 6.1 输入验证

| 规则 | 说明 |
|------|------|
| 金额格式 | 最多7位小数 |
| 最小金额 | 法币价值 ≥ 10 USDT |
| 余额验证 | 输入金额 ≤ 可用余额 |
| 滑点范围 | 0.1% ~ 50% |

### 6.2 错误处理

| 场景 | 提示 |
|------|------|
| 余额不足 | "余额不足" |
| 低于最小金额 | "最小兑换金额为 10 USDT 等值" |
| 汇率获取失败 | "获取汇率失败，请重试" |
| 滑点超出范围 | "滑点设置无效，请输入 0.1%-50%" |

---

## 7. 技术考虑

### 7.1 API 集成

| 接口 | 说明 |
|------|------|
| DEX 报价接口 | 获取最优兑换路径和汇率 |
| Gas 估算接口 | 预估交易 Gas 费用 |
| 价格接口 | 获取代币法币价值 |

### 7.2 DEX 配置（Admin 后台）

| 配置项 | 说明 |
|--------|------|
| RPC URL | 区块链节点 RPC 地址 |
| Router Contract | DEX 路由合约地址 |
| 默认滑点 | 系统默认滑点容差 |
| 过期时间 | 交易有效期（秒） |

### 7.3 性能要求

- 汇率刷新间隔：30秒
- 汇率缓存时间：30秒
- 页面加载时间：< 2秒

---

## 8. 验收标准汇总

1. ✅ 正确显示源代币和目标代币信息
2. ✅ 金额输入实时计算预估获得量
3. ✅ 汇率自动刷新和手动刷新正常
4. ✅ "全部"按钮正确填入可用余额
5. ✅ 滑点设置功能正常
6. ✅ Gas 费估算显示正确
7. ✅ 最小金额验证（10 USDT）正常
8. ✅ 余额不足时正确提示
9. ✅ 确认按钮跳转正常
10. ✅ UI 符合设计稿

---

## 9. 无障碍访问要求

- [ ] 输入框有清晰的标签和占位符
- [ ] 错误提示可被屏幕阅读器朗读
- [ ] 按钮最小触摸目标 44x44pt
- [ ] 颜色对比度符合 WCAG 2.1 AA 标准

---

*文档创建日期: 2025-12-09*
