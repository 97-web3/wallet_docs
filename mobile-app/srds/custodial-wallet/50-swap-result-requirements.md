# 闪兑结果页面 - 软件需求规格说明书

## 1. 页面标识

| 属性 | 值 |
|------|-----|
| 页面ID | CW-050 |
| 页面名称 | 闪兑结果页面 |
| 版本 | 1.0 |
| 更新日期 | 2025-12-09 |
| 状态 | 草稿 |

### 功能描述

展示闪兑交易的提交结果，包括成功、处理中和失败三种状态。成功时显示交易详情，处理中时显示进度，失败时显示错误原因。

> 相关规格: [COMMON-006 术语表](../common/glossary.md)

---

## 2. UI组件

### 2.1 布局概述

页面采用垂直居中布局，顶部为状态图标和标题，中部为交易详情，底部为操作按钮。

### 2.2 组件详情 - 成功状态

| 组件 | 类型 | 描述 | 位置 |
|------|------|------|------|
| 成功图标 | 图标 | 绿色对勾图标 | 顶部居中 |
| 状态标题 | 文本标签 | "兑换成功" | 图标下方 |
| 交易摘要卡片 | 卡片组件 | 显示兑换摘要 | 中部 |
| 支付信息 | 文本标签 | "-xx.xxxxxxx USDT" | 卡片内 |
| 获得信息 | 文本标签 | "+xx.xxxxxxx ETH"（绿色） | 卡片内 |
| 交易详情按钮 | 文本按钮 | "查看详情" | 卡片内 |
| 分隔线 | 线条 | 分隔摘要和详情 | 卡片内 |
| 交易哈希 | 文本标签 | 交易哈希（可点击复制） | 详情区 |
| 复制按钮 | 图标按钮 | 复制交易哈希 | 哈希右侧 |
| 网络信息 | 文本标签 | "网络: Ethereum" | 详情区 |
| 时间信息 | 文本标签 | "时间: 2025-12-09 14:30:00" | 详情区 |
| 完成按钮 | 主按钮 | "完成"，荧光绿色 | 底部 |
| 再次兑换按钮 | 次要按钮 | "再次兑换" | 完成按钮上方 |

### 2.3 组件详情 - 处理中状态

| 组件 | 类型 | 描述 | 位置 |
|------|------|------|------|
| 加载图标 | 动画图标 | 旋转的加载动画 | 顶部居中 |
| 状态标题 | 文本标签 | "交易处理中" | 图标下方 |
| 状态说明 | 文本标签 | "交易已提交，等待链上确认..." | 标题下方 |
| 进度指示 | 进度条 | 显示确认进度（如 1/12 确认） | 中部 |
| 交易哈希 | 文本标签 | 交易哈希（可点击查看区块浏览器） | 中下部 |
| 查看区块浏览器 | 文本按钮 | 跳转到区块浏览器 | 哈希下方 |

### 2.4 组件详情 - 失败状态

| 组件 | 类型 | 描述 | 位置 |
|------|------|------|------|
| 失败图标 | 图标 | 红色叉号图标 | 顶部居中 |
| 状态标题 | 文本标签 | "兑换失败" | 图标下方 |
| 错误原因 | 文本标签 | 具体失败原因 | 标题下方 |
| 重试按钮 | 主按钮 | "重试" | 底部 |
| 返回首页按钮 | 次要按钮 | "返回首页" | 重试按钮上方 |

---

## 3. 功能需求

### FR-CW-050-01: 显示成功状态

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-050-01 |
| **描述** | 交易成功时显示成功页面 |
| **验收标准** | 1. **假设** 交易成功, **当** 进入页面, **则** 显示绿色成功图标和"兑换成功"标题<br>2. **假设** 显示摘要, **当** 渲染, **则** 显示支付金额（负数）和获得金额（正数绿色）<br>3. **假设** 交易哈希, **当** 显示, **则** 可点击复制到剪贴板 |
| **优先级** | 必须 |

### FR-CW-050-02: 显示处理中状态

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-050-02 |
| **描述** | 交易等待确认时显示处理中状态 |
| **验收标准** | 1. **假设** 交易已提交未确认, **当** 进入页面, **则** 显示加载动画和"交易处理中"<br>2. **假设** 确认进度更新, **当** 区块确认, **则** 实时更新进度（如 1/12 → 2/12）<br>3. **假设** 确认完成, **当** 达到所需确认数, **则** 自动切换到成功状态 |
| **优先级** | 必须 |

### FR-CW-050-03: 显示失败状态

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-050-03 |
| **描述** | 交易失败时显示失败页面 |
| **验收标准** | 1. **假设** 交易失败, **当** 进入页面, **则** 显示红色失败图标和"兑换失败"<br>2. **假设** 失败原因, **当** 显示, **则** 显示具体的失败原因（如"滑点超出限制"）<br>3. **假设** 用户点击重试, **当** 触发, **则** 返回闪兑详情页重新提交 |
| **优先级** | 必须 |

### FR-CW-050-04: 复制交易哈希

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-050-04 |
| **描述** | 用户可复制交易哈希 |
| **验收标准** | 1. **假设** 用户点击复制按钮, **当** 触发, **则** 交易哈希复制到剪贴板<br>2. **假设** 复制成功, **当** 完成, **则** 显示"已复制"提示 |
| **优先级** | 应该 |

### FR-CW-050-05: 查看区块浏览器

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-050-05 |
| **描述** | 用户可在区块浏览器查看交易详情 |
| **验收标准** | 1. **假设** 用户点击"查看区块浏览器", **当** 触发, **则** 打开对应网络的区块浏览器交易页<br>2. **假设** 不同网络, **当** 跳转, **则** 使用正确的区块浏览器（Etherscan/BscScan/Tronscan） |
| **优先级** | 应该 |

### FR-CW-050-06: 完成和再次兑换

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-050-06 |
| **描述** | 成功后的操作选项 |
| **验收标准** | 1. **假设** 用户点击"完成", **当** 触发, **则** 返回钱包首页<br>2. **假设** 用户点击"再次兑换", **当** 触发, **则** 返回闪兑选择代币页（保留上次选择） |
| **优先级** | 必须 |

---

## 4. 用户交互

### 4.1 用户工作流

**成功流程：**
1. 查看兑换成功信息
2. （可选）复制交易哈希
3. （可选）查看区块浏览器
4. 点击"完成"返回首页 或 点击"再次兑换"继续

**处理中流程：**
1. 查看交易处理进度
2. 等待链上确认
3. 确认完成后自动切换到成功页面

**失败流程：**
1. 查看失败原因
2. 点击"重试"重新提交 或 点击"返回首页"

### 4.2 导航流程

```
闪兑确认 (CW-049) → 闪兑结果 (CW-050)
                          ↓
         ┌────────────────┼────────────────┐
         ↓                ↓                ↓
    点击完成         点击再次兑换        点击重试
         ↓                ↓                ↓
    钱包首页        选择代币(CW-047)   详情页(CW-048)
```

---

## 5. 数据需求

### 5.1 显示数据

| 数据项 | 数据类型 | 说明 |
|--------|---------|------|
| 交易状态 | Enum | completed / pending / failed |
| 支付金额 | Decimal | 源代币数量 |
| 获得金额 | Decimal | 目标代币数量 |
| 交易哈希 | String | 区块链交易哈希 |
| 网络名称 | String | 区块链网络 |
| 交易时间 | DateTime | 交易提交时间 |
| 确认数 | Integer | 当前确认数 / 所需确认数 |
| 失败原因 | String | 失败时显示 |

### 5.2 区块浏览器 URL

| 网络 | 浏览器 URL |
|------|-----------|
| ETH | https://etherscan.io/tx/{hash} |
| BNB | https://bscscan.com/tx/{hash} |
| TRX | https://tronscan.org/#/transaction/{hash} |

---

## 6. 验证规则

### 6.1 状态判断

| 状态 | 条件 |
|------|------|
| 成功 | 交易已确认，确认数 ≥ 所需确认数 |
| 处理中 | 交易已提交，确认数 < 所需确认数 |
| 失败 | 交易回滚或超时 |

### 6.2 确认数要求

| 网络 | 所需确认数 |
|------|-----------|
| ETH | 12 |
| BNB | 15 |
| TRX | 19 |

---

## 7. 技术考虑

### 7.1 实时更新

- 处理中状态需轮询或 WebSocket 获取确认进度
- 轮询间隔：5秒
- 确认完成后停止轮询

### 7.2 API 集成

| 接口 | 说明 |
|------|------|
| 交易状态查询 | 获取交易确认状态 |
| 交易详情查询 | 获取完整交易信息 |

### 7.3 离开页面处理

- 处理中状态离开页面：交易继续在后台确认
- 重新进入时恢复显示正确状态

---

## 8. 验收标准汇总

1. ✅ 成功状态正确显示绿色图标和交易详情
2. ✅ 处理中状态显示加载动画和确认进度
3. ✅ 失败状态显示红色图标和失败原因
4. ✅ 交易哈希可复制
5. ✅ 区块浏览器链接正确
6. ✅ 确认进度实时更新
7. ✅ 确认完成自动切换状态
8. ✅ "完成"返回首页正常
9. ✅ "再次兑换"跳转正常
10. ✅ "重试"功能正常
11. ✅ UI 符合设计稿

---

## 9. 无障碍访问要求

- [ ] 状态图标有替代文本
- [ ] 成功/失败状态有语音播报
- [ ] 按钮最小触摸目标 44x44pt
- [ ] 进度更新可被屏幕阅读器感知

---

*文档创建日期: 2025-12-09*
