# 编辑收款方 - 软件需求规格说明书

## 1. 页面标识

| 属性 | 值 |
|------|-----|
| 页面ID | CW-035 |
| 页面名称 | 编辑收款方 |
| 版本 | 1.1 |
| 更新日期 | 2025-12-08 |
| 状态 | 草稿 |

### 功能描述
编辑收款方页面用于修改或添加提现时的收款地址。用户可以输入或粘贴区块链地址，选择已保存的地址，或从通讯录中选择收款方。页面支持地址格式验证和地址簿管理。

---

## 2. UI组件

### 2.1 布局概述
页面采用表单布局，深色背景主题。顶部显示导航栏和标题，中间是地址输入区域，包含输入框和快捷操作按钮，底部可能有确认按钮。

### 2.2 组件详情

| 组件 | 类型 | 描述 | 位置 |
|------|------|------|------|
| 返回按钮 | 图标按钮 | 左箭头，返回上一页 | 顶部左侧 |
| 页面标题 | 标签 | "编辑收款方"或"收款地址" | 顶部居中 |
| 地址输入框 | 多行文本 | 用于输入区块链地址 | 内容区域 |
| 粘贴按钮 | 图标按钮 | 粘贴板图标，快速粘贴 | 输入框内右侧 |
| 扫码按钮 | 图标按钮 | 二维码扫描图标 | 输入框右侧 |
| 通讯录按钮 | 图标按钮 | 联系人图标，打开地址簿 | 输入框右侧 |
| 地址验证提示 | 标签 | 显示地址有效性状态 | 输入框下方 |
| 确认按钮 | 主按钮 | 绿色按钮，"确认" | 底部 |

---

## 3. 功能需求

### FR-035-01: 输入收款地址

| 字段 | 内容 |
|------|------|
| **ID** | FR-035-01 |
| **描述** | 用户可以手动输入区块链收款地址 |
| **验收标准** | 1. **假设** 用户点击地址输入框，**当** 开始输入，**则** 弹出字母数字键盘<br>2. **假设** 用户输入地址，**当** 输入进行，**则** 实时显示输入内容 |
| **优先级** | 必须 |

### FR-035-02: 粘贴地址

| 字段 | 内容 |
|------|------|
| **ID** | FR-035-02 |
| **描述** | 用户可以快速粘贴剪贴板中的地址 |
| **验收标准** | 1. **假设** 剪贴板有内容，**当** 用户点击粘贴按钮，**则** 将内容粘贴到输入框<br>2. **假设** 粘贴成功，**当** 内容填入，**则** 自动验证地址格式 |
| **优先级** | 必须 |

### FR-035-03: 扫码输入地址

| 字段 | 内容 |
|------|------|
| **ID** | FR-035-03 |
| **描述** | 用户可以通过扫描二维码输入地址 |
| **验收标准** | 1. **假设** 用户点击扫码按钮，**当** 按钮被点击，**则** 打开相机扫码界面<br>2. **假设** 扫描到有效地址，**当** 识别成功，**则** 将地址填入输入框 |
| **优先级** | 应该 |

### FR-035-04: 从通讯录选择

| 字段 | 内容 |
|------|------|
| **ID** | FR-035-04 |
| **描述** | 用户可以从已保存的地址簿中选择收款方 |
| **验收标准** | 1. **假设** 用户点击通讯录按钮，**当** 按钮被点击，**则** 打开地址簿选择页面<br>2. **假设** 用户选择某个地址，**当** 选择确认，**则** 将地址填入输入框 |
| **优先级** | 应该 |

### FR-035-05: 地址格式验证

| 字段 | 内容 |
|------|------|
| **ID** | FR-035-05 |
| **描述** | 系统应验证输入的地址格式是否正确 |
| **验收标准** | 1. **假设** 用户输入地址，**当** 验证格式，**则** 显示有效/无效状态<br>2. **假设** 地址格式错误，**当** 显示错误，**则** 提示"地址格式无效" |
| **优先级** | 必须 |

### FR-035-06: 确认收款地址

| 字段 | 内容 |
|------|------|
| **ID** | FR-035-06 |
| **描述** | 用户确认后将地址用于提现操作 |
| **验收标准** | 1. **假设** 地址验证通过，**当** 用户点击确认，**则** 返回上一页并使用该地址<br>2. **假设** 地址无效，**当** 用户点击确认，**则** 提示需要有效地址 |
| **优先级** | 必须 |

### FR-035-07: 保存到地址簿选项

| 字段 | 内容 |
|------|------|
| **ID** | FR-035-07 |
| **描述** | 用户可以选择将新地址保存到地址簿 |
| **验收标准** | 1. **假设** 输入的是新地址，**当** 地址验证通过，**则** 显示"保存到地址簿"勾选框<br>2. **假设** 用户勾选保存，**当** 点击确认，**则** 弹出输入备注名称的对话框<br>3. **假设** 输入备注名称，**当** 保存成功，**则** 显示"已保存到地址簿"提示<br>4. **假设** 地址已在地址簿中，**当** 显示，**则** 显示已有的备注名称，不显示保存选项 |
| **优先级** | 应该 |

### FR-035-08: 网络兼容性验证（安全关键）

| 字段 | 内容 |
|------|------|
| **ID** | FR-035-08 |
| **描述** | 验证地址与选定网络的兼容性，防止资产丢失 |
| **验收标准** | 1. **假设** 输入地址，**当** 验证格式，**则** 同时检查地址与当前选定网络的兼容性<br>2. **假设** 地址格式与网络不匹配，**当** 检测到，**则** 显示红色警告"此地址可能与选择的网络不兼容，发送到错误网络将导致资产永久丢失"<br>3. **假设** 检测到潜在的网络不匹配，**当** 用户仍要继续，**则** 弹出二次确认对话框要求用户确认风险 |
| **优先级** | **必须（安全关键）** |

> **安全说明**：将资产发送到不兼容的网络地址是加密货币转账中最常见的永久性资产丢失原因之一。

### FR-035-09: 自己地址检测

| 字段 | 内容 |
|------|------|
| **ID** | FR-035-09 |
| **描述** | 检测用户是否输入了自己的充值地址 |
| **验收标准** | 1. **假设** 输入地址，**当** 验证，**则** 检查是否为用户自己的充值地址<br>2. **假设** 检测到是自己的地址，**当** 显示，**则** 显示友好提示"这是您在本平台的充值地址，无需转账"<br>3. **假设** 用户确认要转账给自己，**当** 继续操作，**则** 允许但显示说明"链上转账到自己地址会产生手续费，建议使用内部转账" |
| **优先级** | 应该 |

### FR-035-10: 地址历史记录

| 字段 | 内容 |
|------|------|
| **ID** | FR-035-10 |
| **描述** | 显示最近使用过的收款地址，方便快速选择 |
| **验收标准** | 1. **假设** 用户有历史转账记录，**当** 进入页面，**则** 在输入框下方显示"最近使用"区域<br>2. **假设** 显示最近使用，**当** 渲染，**则** 显示最近3-5个使用过的地址（带备注名称，如有）<br>3. **假设** 用户点击历史地址，**当** 触发，**则** 将该地址填入输入框 |
| **优先级** | 应该 |

---

## 4. 用户交互

### 4.1 用户工作流
1. 用户从提现页面进入编辑收款方
2. 选择输入方式：手动输入、粘贴、扫码或通讯录
3. 输入或选择地址
4. 系统验证地址格式
5. 用户确认地址
6. 返回提现页面继续操作

### 4.2 导航流程
- **来源页面**: 提现详情页面、提现确认页面
- **目标页面**:
  - 扫码: 扫码页面
  - 通讯录: 地址簿选择页面
  - 确认: 返回来源页面

### 4.3 手势与交互
| 手势 | 行为 |
|------|------|
| 点击输入框 | 开始输入地址 |
| 点击粘贴 | 粘贴剪贴板内容 |
| 点击扫码 | 打开扫码界面 |
| 点击通讯录 | 打开地址簿 |
| 点击确认 | 确认使用该地址 |

---

## 5. 数据需求

### 5.1 显示数据
| 数据字段 | 类型 | 来源 | 格式 |
|----------|------|------|------|
| 当前地址 | String | 上一页传入 | 区块链地址格式 |
| 验证状态 | Boolean | 本地验证 | 有效/无效 |
| 网络类型 | String | 上下文 | ETH/BSC/TRON等 |

### 5.2 输入数据
| 输入字段 | 类型 | 验证规则 | 必填 |
|----------|------|----------|------|
| 收款地址 | String | 符合选定网络的地址格式 | 是 |

---

## 6. 验证规则

### 6.1 地址格式验证
- ERC-20地址：0x开头，42字符，十六进制
- TRC-20地址：T开头，34字符
- 其他网络：按各网络地址规则验证

### 6.2 错误处理
| 错误场景 | 处理方式 |
|----------|----------|
| 地址格式无效 | 显示"地址格式无效，请检查" |
| 地址为空 | 提示"请输入收款地址" |
| 网络不匹配 | 显示"地址与选择的网络不匹配" |

---

## 7. 技术考虑

### 7.1 地址验证
- 本地正则验证基本格式
- 可选：调用API进行链上验证
- 检查校验和（如EIP-55）

### 7.2 剪贴板访问
- 请求剪贴板读取权限
- 处理权限拒绝情况

### 7.3 扫码功能
- 请求相机权限
- 支持多种二维码格式
- 解析并提取地址

---

## 8. 验收标准汇总

- [ ] 可以手动输入地址
- [ ] 粘贴按钮正常工作
- [ ] 扫码功能正常打开
- [ ] 通讯录选择正常工作
- [ ] 地址格式实时验证
- [ ] 无效地址显示错误提示
- [ ] 有效地址可以确认使用
- [ ] 确认后正确返回并传递地址
- [ ] **新地址显示"保存到地址簿"选项**
- [ ] **网络不兼容时显示红色警告**
- [ ] **检测到自己地址时显示友好提示**
- [ ] **显示最近使用的地址历史**
- [ ] **网络不匹配继续操作时需要二次确认**

---

## 9. 无障碍访问要求

- [ ] 所有文本颜色对比度符合WCAG 2.1 AA标准（最低4.5:1）
- [ ] 按钮和可交互元素最小触摸目标为44x44pt
- [ ] 支持屏幕阅读器，所有UI元素有适当的无障碍标签
- [ ] 地址输入框有明确的aria-label描述
- [ ] 验证错误通过无障碍公告通知用户（aria-live="assertive"）
- [ ] 扫码、粘贴、通讯录按钮有明确的无障碍标签
- [ ] 警告信息使用role="alert"标记
- [ ] 历史地址列表项有role="option"和aria-selected标记
- [ ] 支持键盘导航（适用于平板/桌面设备）
