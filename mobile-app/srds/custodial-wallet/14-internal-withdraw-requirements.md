# 内部划转页面 - 软件需求规格说明书

## 1. 页面标识

| 属性 | 值 |
|------|-----|
| 页面ID | CW-014 |
| 页面名称 | 内部划转页面 |
| 版本 | 1.2 |
| 更新日期 | 2025-12-09 |
| 状态 | 草稿 |

### 功能描述
用户通过 UID、邮箱或手机号向平台内其他用户进行免手续费的内部划转，显示费用明细和重要提示。

> 相关规格: [COMMON-001 代币精度规则](../common/token-precision-rules.md) | [COMMON-002 验证方式规则](../common/verification-method-rules.md)

---

## 2. UI组件

### 2.1 组件详情

| 组件 | 类型 | 描述 | 位置 |
|------|------|------|------|
| 返回按钮 | 图标按钮 | 左箭头 | 左上角 |
| 页面标题 | 文本标签 | "内部划转" | 标题栏中央 |
| 收款方式Tab | Tab切换器 | "账户UID"、"邮箱"、"手机号"三个Tab | 上部 |
| 账户UID Tab | Tab按钮 | 绿色边框高亮状态 | Tab左侧 |
| 邮箱Tab | Tab按钮 | 深色背景未选中状态 | Tab中间 |
| 手机号Tab | Tab按钮 | 深色背景未选中状态 | Tab右侧 |
| 收款方标题 | 文本标签 | 根据Tab显示"账户UID"/"邮箱"/"手机号" | Tab下方 |
| 收款方输入框 | 文本输入框 | 占位符根据Tab动态变化，带粘贴和扫码图标 | 标题下方 |
| 划转数量标题 | 文本标签 | "划转数量" | 输入框下方左侧 |
| 可用余额 | 文本标签 | "可用: 96,666.00 USDT" | 转账数量标题右侧 |
| 数量输入框 | 数字输入框 | 占位符"请输入＞"，右侧显示"USDT"和"全部"按钮 | 可用余额下方 |
| 最小划转标签 | 文本标签 | "最小划转: 10 USDT 等值"灰色 | 数量输入框下方 |
| 费用明细 | 卡片区域 | "费用明细"标题 | 中部 |
| 划转数量行 | 信息行 | "划转数量: 1222.0567890 USDT" | 费用明细内 |
| 手续费行 | 信息行 | "手续费: 0 USDT" | 划转数量行下方 |
| 实际到账行 | 信息行 | "实际到账: 1222.0567890 USDT"黄绿色 | 手续费行下方 |
| 划转说明卡片 | 提示卡片 | 带警告图标，深色背景 | 费用明细下方 |
| 说明标题 | 文本标签 | "划转说明" | 提示卡片顶部 |
| 说明文字 | 文本标签 | 多行说明文字 | 说明标题下方 |
| 最小划转金额 | 文本标签 | "最小划转金额: 10 USDT 等值"黄绿色 | 说明最后一行 |
| 下一步按钮 | 主按钮 | "下一步"，深色背景 | 底部 |

---

## 3. 功能需求

### FR-CW-014-01: 收款方式切换

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-014-01 |
| **描述** | 用户可以选择使用 UID、邮箱或手机号进行内部划转 |
| **验收标准** | 1. **假设** 用户点击"账户UID" Tab, **当** 触发, **则** 输入框占位符显示"请输入收款方 UID"<br>2. **假设** 用户点击"邮箱" Tab, **当** 触发, **则** 输入框占位符显示"请输入收款方邮箱"<br>3. **假设** 用户点击"手机号" Tab, **当** 触发, **则** 输入框占位符显示"请输入收款方手机号" |
| **优先级** | 必须 |

### FR-CW-014-02: 收款方输入

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-014-02 |
| **描述** | 用户输入收款方的 UID、邮箱或手机号 |
| **验收标准** | 1. **假设** 用户输入 UID, **当** 输入完成, **则** 验证 UID 格式是否正确（纯数字，6位以上）<br>2. **假设** 用户输入邮箱, **当** 输入完成, **则** 验证邮箱格式是否正确<br>3. **假设** 用户输入手机号, **当** 输入完成, **则** 验证国际手机号格式（+区号 + 号码）<br>4. **假设** 用户点击粘贴图标, **当** 触发, **则** 自动粘贴剪贴板内容<br>5. **假设** 用户点击扫码图标, **当** 触发, **则** 打开二维码扫描器 |
| **优先级** | 必须 |

### FR-CW-014-03: 划转数量输入

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-014-03 |
| **描述** | 用户输入划转数量 |
| **验收标准** | 1. **假设** 用户输入数量, **当** 输入, **则** 实时验证是否超过可用余额<br>2. **假设** 用户点击"全部", **当** 触发, **则** 自动填入所有可用余额<br>3. **假设** 输入数量低于最小划转额, **当** 验证, **则** 显示错误提示"最小金额不能低于 10 USDT 等值"<br>4. **假设** 非 USDT 代币, **当** 验证最小金额, **则** 通过实时汇率换算判断是否 >= 10 USDT 等值 |
| **优先级** | 必须 |

### FR-CW-014-04: 费用明细计算

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-014-04 |
| **描述** | 实时计算并显示费用明细 |
| **验收标准** | 1. **假设** 用户输入数量, **当** 数量改变, **则** 实时更新划转数量、手续费、实际到账<br>2. **假设** 内部划转, **当** 显示手续费, **则** 显示"0 USDT"<br>3. **假设** 实际到账, **当** 显示, **则** 使用黄绿色突出显示<br>4. **假设** 显示金额, **当** 渲染, **则** 代币数量精确到小数点后 7 位（参考 COMMON-001） |
| **优先级** | 必须 |

### FR-CW-014-05: 划转说明

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-014-05 |
| **描述** | 显示划转的重要说明和注意事项 |
| **验收标准** | 1. **假设** 显示说明, **当** 渲染, **则** 清晰展示划转流程和注意事项<br>2. **假设** 说明内容, **当** 显示, **则** 包含审核时间、确认时间、最小金额等关键信息 |
| **优先级** | 必须 |

### FR-CW-014-06: 表单验证

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-014-06 |
| **描述** | 验证表单输入的有效性 |
| **验收标准** | 1. **假设** 收款方 UID/邮箱/手机号为空, **当** 点击下一步, **则** 提示"请输入收款方信息"<br>2. **假设** 划转数量为空, **当** 点击下一步, **则** 提示"请输入划转数量"<br>3. **假设** 划转数量低于最小值, **当** 验证, **则** 提示"最小金额不能低于 10 USDT 等值"<br>4. **假设** 划转数量超过余额, **当** 验证, **则** 提示"余额不足" |
| **优先级** | 必须 |

### FR-CW-014-07: 提交划转

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-014-07 |
| **描述** | 用户提交划转申请 |
| **验收标准** | 1. **假设** 表单验证通过, **当** 点击"下一步", **则** 进入安全验证流程（参考 COMMON-002）<br>2. **假设** 安全验证通过, **当** 完成验证, **则** 进入确认页面，显示完整的划转信息供用户二次确认 |
| **优先级** | 必须 |

---

## 4. 用户交互

### 4.1 用户工作流
1. 用户从选择提币方式页面选择"内部划转"
2. 选择使用 UID、邮箱或手机号
3. 输入收款方信息（可粘贴或扫码）
4. 输入划转数量（可点击全部）
5. 查看费用明细和划转说明
6. 点击"下一步"进入安全验证
7. 完成安全验证后进入确认页面

### 4.2 导航流程
- 选择提币方式 → 内部划转页面
- 内部划转页面 → 安全验证 → 确认划转页面

### 4.3 手势与交互
- **Tab切换**：切换 UID/邮箱/手机号 输入模式
- **点击**：粘贴、扫码、全部按钮
- **输入**：UID/邮箱/手机号、数量输入

---

## 5. 数据需求

### 5.1 输入数据

| 字段名称 | 数据类型 | 必填 | 验证规则 |
|---------|---------|------|---------|
| 收款方 UID | String | 条件必填 | 纯数字，6位以上 |
| 收款方邮箱 | String | 条件必填 | 标准邮箱格式 |
| 收款方手机号 | String | 条件必填 | 国际手机号格式 (+区号 + 号码) |
| 划转数量 | Decimal | 是 | >= 10 USDT 等值，<= 可用余额 |

### 5.2 显示数据

| 数据项 | 数据类型 | 说明 |
|--------|---------|------|
| 可用余额 | Decimal | 当前币种的可用余额（7位小数） |
| 最小划转额 | String | "10 USDT 等值" |
| 手续费 | Decimal | 内部划转手续费（固定为 0） |
| USDT 等值 | Decimal | 非 USDT 代币时显示当前金额的 USDT 等值 |

---

## 6. 验证规则

### 6.1 UID 验证
- 格式：纯数字
- 长度：6 位以上

### 6.2 邮箱验证
- 格式：符合标准邮箱格式 (RFC 5322)

### 6.3 手机号验证
- 格式：国际手机号格式
- 示例：+86 13800138000, +1 2025551234

### 6.4 数量验证
- 必须大于等于 10 USDT 等值
- 不能超过可用余额
- 精度：小数点后 7 位（参考 COMMON-001）
- 非 USDT 代币通过实时汇率换算验证最小金额

---

## 7. 验收标准汇总

1. ✅ UID/邮箱/手机号 Tab 切换功能正常
2. ✅ 收款方输入验证正确（UID、邮箱、手机号三种格式）
3. ✅ 粘贴和扫码功能正常
4. ✅ 划转数量输入验证正确
5. ✅ 全部按钮功能正常
6. ✅ 费用明细实时计算准确
7. ✅ 手续费显示为 0
8. ✅ 划转说明清晰展示
9. ✅ 表单验证完整有效
10. ✅ 最小金额验证使用 10 USDT 等值规则
11. ✅ 代币数量显示精确到 7 位小数
12. ✅ 下一步按钮正确触发安全验证流程
13. ✅ UI 符合设计稿

---

## 8. 审核流程规格

### 8.1 审核流程概述

内部划转提交后进入审核流程，确保交易安全合规。

```
用户发起划转 → AML 验证 → 人工审核（条件触发）→ 结果反馈 → 交易执行
```

### 8.2 审核状态机

| 状态 | 状态码 | 说明 | 可转换至 |
|------|-------|------|---------|
| 已发起 | pending | 用户提交划转申请 | processing, rejected |
| 处理中 | processing | 等待审核 | approved, rejected |
| 已通过 | approved | 审核通过，待执行 | completed, failed |
| 已驳回 | rejected | 审核未通过 | - (终态) |
| 已完成 | completed | 划转成功 | - (终态) |
| 已失败 | failed | 执行失败 | - (终态) |

### 8.3 AML 验证规则

| 规则ID | 触发条件 | 处理方式 |
|--------|---------|---------|
| AML-001 | 单笔金额 ≥ 10,000 USDT | 触发人工审核 |
| AML-002 | 24小时累计 ≥ 50,000 USDT | 触发人工审核 |
| AML-003 | 收款方为新用户（注册 < 7天） | 触发人工审核 |
| AML-004 | 账户风险标记 | 触发人工审核 |
| AML-005 | 金额 < 10,000 USDT 且无风险标记 | 自动通过 |

### 8.4 免审批条件

| 条件 | 说明 |
|------|------|
| Web2 → 绑定的 Web3 地址 | 用户从 Web2 钱包划转至自己绑定的 Web3 钱包地址，免审核 |
| 白名单收款方 | 收款方在用户白名单中，且历史无异常 |
| 小额快速通道 | 单笔 < 1,000 USDT 且符合用户历史交易模式 |

### 8.5 审核超时处理

| 超时阶段 | 超时时间 | 处理方式 |
|---------|---------|---------|
| AML 自动验证 | 30 秒 | 自动进入人工审核 |
| 人工审核 | 24 小时 | 通知审核人员加急处理 |
| 人工审核 | 72 小时 | 升级至管理员处理 |

### 8.6 审核结果通知

| 事件 | 通知方式 | 通知内容 |
|------|---------|---------|
| 提交成功 | APP 推送 | "您的划转申请已提交，正在处理中" |
| 审核通过 | APP 推送 | "您的划转申请已通过，资金已到账" |
| 审核驳回 | APP 推送 | "您的划转申请已驳回，原因：{reason}" |
| 执行完成 | APP 推送 + 站内信 | "划转成功，{amount} {token} 已到达 {recipient}" |

### 8.7 审核功能需求

#### FR-CW-014-08: 审核状态查询

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-014-08 |
| **描述** | 用户可查询划转申请的审核状态 |
| **验收标准** | 1. **假设** 用户查看划转记录, **当** 点击详情, **则** 显示当前审核状态<br>2. **假设** 状态为处理中, **当** 显示, **则** 显示预计处理时间<br>3. **假设** 状态为已驳回, **当** 显示, **则** 显示驳回原因 |
| **优先级** | 必须 |

#### FR-CW-014-09: 审核结果接收

| 字段 | 内容 |
|------|------|
| **ID** | FR-CW-014-09 |
| **描述** | 用户接收审核结果推送通知 |
| **验收标准** | 1. **假设** 审核完成, **当** 结果生成, **则** 发送 APP 推送通知<br>2. **假设** 用户点击通知, **当** 触发, **则** 跳转至划转详情页<br>3. **假设** 审核通过, **当** 到账, **则** 更新余额并通知 |
| **优先级** | 必须 |

---

## 9. 无障碍访问要求

- [ ] 所有文本颜色对比度符合 WCAG 2.1 AA 标准
- [ ] Tab 切换支持键盘导航
- [ ] 输入框有清晰的标签和占位符
- [ ] 错误提示可被屏幕阅读器朗读
- [ ] 按钮最小触摸目标 44x44pt

---

## 10. 相关文档

- [COMMON-001 代币精度规则](../common/token-precision-rules.md)
- [COMMON-002 验证方式规则](../common/verification-method-rules.md)
- [COMMON-005 实时汇率集成](../common/price-feed-integration.md)
- [COMMON-006 术语表](../common/glossary.md)

---

*文档更新日期: 2025-12-09*
*变更说明: 新增第8章审核流程规格，补充 AML 验证、免审批条件、审核超时处理等内容*
