# 安全验证(错误) - 软件需求规格说明书

## 1. 页面标识

| 属性 | 值 |
|------|-----|
| 页面ID | CW-028 |
| 页面名称 | 安全验证(错误) |
| 版本 | 1.0 |
| 更新日期 | 2025-12-08 |
| 状态 | 草稿 |

### 功能描述
安全验证错误状态页面显示2FA验证码验证失败的反馈。输入框边框变为红色警示色，下方显示错误提示信息，引导用户重新输入正确的验证码。

---

## 2. UI组件

### 2.1 布局概述
页面延续2FA验证界面布局，输入框组的边框变为红色，下方新增红色错误提示文字。确认按钮可能变回禁用状态（如果自动清空了输入）。

### 2.2 组件详情

| 组件 | 类型 | 描述 | 位置 |
|------|------|------|------|
| 拖动指示条 | 视图 | 灰色横条 | 弹窗顶部 |
| 页面标题 | 标签 | "安全验证" | 拖动条下方 |
| 关闭按钮 | 图标按钮 | X图标 | 标题右侧 |
| 验证器图标 | 图片 | Google Authenticator图标 | 内容区顶部 |
| 说明文字 | 标签 | "请输入Google Authenticator验证码" | 图标下方 |
| 验证码输入框 | 输入组 | 6个输入框，红色边框（错误状态） | 说明下方 |
| 错误提示 | 标签 | 红色文字"验证码错误，请重试" | 输入框下方 |
| 确认按钮 | 主按钮 | 按钮（可能为禁用状态） | 底部 |

---

## 3. 功能需求

### FR-028-01: 显示验证错误状态

| 字段 | 内容 |
|------|------|
| **ID** | FR-028-01 |
| **描述** | 验证码验证失败时，系统应显示错误状态反馈 |
| **验收标准** | 1. **假设** 用户提交了错误的验证码，**当** 服务器返回错误，**则** 输入框边框变为红色<br>2. **假设** 错误状态显示，**当** 用户查看，**则** 红色边框清晰标识错误 |
| **优先级** | 必须 |

### FR-028-02: 显示错误提示信息

| 字段 | 内容 |
|------|------|
| **ID** | FR-028-02 |
| **描述** | 验证失败时应显示具体的错误提示文字 |
| **验收标准** | 1. **假设** 验证码错误，**当** 显示错误状态，**则** 输入框下方显示"验证码错误，请重试"<br>2. **假设** 验证码过期，**当** 显示错误状态，**则** 提示"验证码已过期" |
| **优先级** | 必须 |

### FR-028-03: 自动清空输入

| 字段 | 内容 |
|------|------|
| **ID** | FR-028-03 |
| **描述** | 验证失败后应自动清空已输入的验证码 |
| **验收标准** | 1. **假设** 验证失败，**当** 显示错误状态，**则** 清空所有输入框内容<br>2. **假设** 输入框清空，**当** 用户重新输入，**则** 光标定位到第一个输入框 |
| **优先级** | 应该 |

### FR-028-04: 允许重新输入

| 字段 | 内容 |
|------|------|
| **ID** | FR-028-04 |
| **描述** | 用户可以重新输入验证码进行再次验证 |
| **验收标准** | 1. **假设** 显示错误状态，**当** 用户开始输入新验证码，**则** 红色错误样式消失<br>2. **假设** 用户重新输入，**当** 输入第一位数字，**则** 恢复正常输入状态 |
| **优先级** | 必须 |

### FR-028-05: 错误次数限制

| 字段 | 内容 |
|------|------|
| **ID** | FR-028-05 |
| **描述** | 连续验证失败达到限制后应暂时锁定 |
| **验收标准** | 1. **假设** 连续验证失败5次，**当** 达到限制，**则** 显示"错误次数过多，请10分钟后重试"<br>2. **假设** 账户被锁定，**当** 用户尝试验证，**则** 提示剩余等待时间 |
| **优先级** | 应该 |

---

## 4. 用户交互

### 4.1 用户工作流
1. 用户提交验证码
2. 服务器返回验证失败
3. 界面显示错误状态
4. 输入框清空（可选）
5. 用户重新输入验证码
6. 错误样式消失，恢复正常状态

### 4.2 导航流程
- **来源状态**: 验证码提交中
- **目标状态**:
  - 重新输入: 恢复正常输入状态
  - 关闭弹窗: 取消验证
  - 多次失败: 显示锁定提示

### 4.3 手势与交互
| 手势 | 行为 |
|------|------|
| 开始输入 | 清除错误状态，恢复正常 |
| 点击关闭 | 关闭弹窗 |

---

## 5. 数据需求

### 5.1 显示数据
| 数据字段 | 类型 | 来源 | 格式 |
|----------|------|------|------|
| 错误提示 | String | 服务器响应 | 本地化文本 |
| 剩余重试次数 | Number | 服务器响应 | 整数（可选显示） |
| 锁定时间 | Number | 服务器响应 | 分钟/秒 |

### 5.2 输入数据
| 输入字段 | 类型 | 验证规则 | 必填 |
|----------|------|----------|------|
| 新验证码 | String | 6位纯数字 | 是 |

---

## 6. 验证规则

### 6.1 错误状态样式
- 输入框边框：红色 (#FF3B30 或类似)
- 错误提示文字：红色
- 抖动动画：可选

### 6.2 错误类型
| 错误代码 | 错误信息 |
|----------|----------|
| INVALID_CODE | 验证码错误，请重试 |
| CODE_EXPIRED | 验证码已过期，请重新获取 |
| TOO_MANY_ATTEMPTS | 错误次数过多，请稍后再试 |
| NETWORK_ERROR | 网络错误，请重试 |

### 6.3 重试规则
- 单次验证失败：允许立即重试
- 连续5次失败：锁定10分钟
- 锁定期间：显示倒计时

---

## 7. 技术考虑

### 7.1 错误反馈动画
- 输入框抖动动画（可选）
- 红色边框过渡动画
- 错误提示淡入效果

### 7.2 状态重置
- 用户开始输入时清除错误状态
- 错误提示在输入时消失

### 7.3 锁定机制
- 服务端控制锁定逻辑
- 客户端显示锁定状态
- 支持倒计时显示

---

## 8. 验收标准汇总

- [ ] 验证失败时输入框边框变红
- [ ] 显示具体错误提示信息
- [ ] 错误提示文字为红色
- [ ] 验证失败后清空输入（可选）
- [ ] 开始重新输入时错误状态消失
- [ ] 可以重新输入验证码
- [ ] 连续失败达到限制显示锁定提示
- [ ] 锁定期间显示剩余等待时间
