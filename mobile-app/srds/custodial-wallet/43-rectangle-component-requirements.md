# Rectangle组件 - 软件需求规格说明书

## 1. 页面标识

| 属性 | 值 |
|------|-----|
| 页面ID | CW-043 |
| 页面名称 | Rectangle组件（CAPTCHA验证） |
| 版本 | 1.0 |
| 更新日期 | 2025-12-08 |
| 状态 | 草稿 |

### 功能描述
Rectangle 376728317.png文件展示的是一个拖动滑块完成拼图的CAPTCHA验证组件。组件顶部显示"请拖动滑块完成拼图"提示文字，主区域显示一张带有城市街景的背景图片，左侧有一个拼图缺口，底部有一个滑块轨道，用户需要拖动滑块使拼图块对齐完成验证。组件左上角有关闭按钮，底部有刷新和关闭小图标。

---

## 2. UI组件

### 2.1 布局概述
圆角矩形容器，深灰色背景，包含提示文字、拼图图片、滑动轨道和操作按钮。

### 2.2 组件详情

| 组件 | 类型 | 描述 | 位置 |
|------|------|------|------|
| 容器 | 容器 | 圆角矩形，深灰色背景 | 屏幕中央 |
| 关闭按钮 | 按钮 | X图标 | 左上角 |
| 提示文字 | 文本 | "请拖动滑块完成拼图" | 顶部中央 |
| 拼图背景 | 图片 | 城市街景照片，左侧有拼图缺口 | 中部主区域 |
| 拼图块 | 图片 | 可拖动的拼图碎片 | 初始位置左侧 |
| 滑动轨道 | 轨道 | 灰色背景轨道 | 底部 |
| 滑块 | 按钮 | 可拖动的圆形或箭头按钮 | 滑动轨道左侧 |
| 刷新按钮 | 按钮 | 刷新图标 | 底部左下角 |
| 关闭按钮2 | 按钮 | 关闭图标 | 底部右下角 |

---

## 3. 功能需求

### FR-043-01: 拖动验证

| 字段 | 内容 |
|------|------|
| **ID** | FR-043-01 |
| **描述** | 用户拖动滑块完成拼图验证 |
| **验收标准** | 1. **假设** 验证组件显示, **当** 用户按住滑块, **则** 滑块可以沿轨道拖动<br>2. **假设** 拖动滑块, **当** 移动, **则** 拼图块同步移动<br>3. **假设** 拼图块对齐, **当** 位置正确（容差范围内）, **则** 验证成功<br>4. **假设** 验证成功, **当** 完成, **则** 显示成功提示并关闭验证组件 |
| **优先级** | 必须 |

### FR-043-02: 验证失败处理

| 字段 | 内容 |
|------|------|
| **ID** | FR-043-02 |
| **描述** | 拖动位置不正确时的处理 |
| **验收标准** | 1. **假设** 拖动位置不正确, **当** 松开滑块, **则** 滑块回弹到起始位置<br>2. **假设** 多次失败, **当** 连续3次错误, **则** 刷新拼图更换新图片<br>3. **假设** 验证失败, **当** 回弹, **则** 显示红色错误提示或抖动动画 |
| **优先级** | 必须 |

### FR-043-03: 刷新拼图

| 字段 | 内容 |
|------|------|
| **ID** | FR-043-03 |
| **描述** | 用户可以刷新获取新的拼图图片 |
| **验收标准** | 1. **假设** 用户点击刷新按钮, **当** 点击, **则** 加载新的拼图图片<br>2. **假设** 刷新进行中, **当** 加载, **则** 显示加载动画<br>3. **假设** 新图片加载完成, **当** 显示, **则** 滑块重置到起始位置 |
| **优先级** | 必须 |

### FR-043-04: 关闭验证组件

| 字段 | 内容 |
|------|------|
| **ID** | FR-043-04 |
| **描述** | 用户可以关闭验证组件 |
| **验收标准** | 1. **假设** 用户点击关闭按钮, **当** 点击, **则** 关闭验证组件返回上一页或取消操作<br>2. **假设** 关闭验证, **当** 取消, **则** 原操作不执行 |
| **优先级** | 必须 |

### FR-043-05: 验证安全性

| 字段 | 内容 |
|------|------|
| **ID** | FR-043-05 |
| **描述** | CAPTCHA验证的安全性要求 |
| **验收标准** | 1. **假设** 机器人尝试, **当** 验证, **则** 检测异常行为（如超快速度、精确对齐）<br>2. **假设** 检测到异常, **当** 识别, **则** 标记为可疑并要求额外验证<br>3. **假设** 验证通过, **当** 成功, **则** 生成验证令牌提交到服务器 |
| **优先级** | 必须 |

---

## 4. 用户交互

### 4.1 用户工作流

```
触发验证 → 显示CAPTCHA → 拖动滑块 → 对齐拼图 → 验证成功 → 继续原操作
                                   ↓ 对齐失败
                          回弹重试 → 多次失败 → 刷新拼图
```

### 4.2 导航流程

- **触发**: 敏感操作（登录、注册、转账等）时触发
- **显示**: 模态窗口覆盖在当前页面
- **完成**: 验证成功后关闭，继续原操作
- **取消**: 关闭验证，取消原操作

### 4.3 手势与交互

- **按住滑块**: 开始拖动
- **拖动**: 沿轨道移动滑块和拼图块
- **松开**: 验证位置是否正确
- **点击刷新**: 更换新拼图
- **点击关闭**: 取消验证

---

## 5. 数据需求

### 5.1 显示数据

| 数据项 | 类型 | 来源 | 说明 |
|--------|------|------|------|
| 拼图背景图 | 图片URL | 服务器 | 带缺口的背景图片 |
| 拼图块图 | 图片URL | 服务器 | 可拖动的拼图碎片 |
| 正确位置 | 整数 | 服务器 | 拼图块的正确X坐标 |
| 容差范围 | 整数 | 配置 | 允许的误差像素 |

### 5.2 输入数据

| 数据项 | 类型 | 必填 | 验证规则 | 说明 |
|--------|------|------|----------|------|
| 拖动位置 | 整数 | 是 | 0-最大轨道长度 | 用户拖动到的位置 |
| 拖动轨迹 | 数组 | 是 | 坐标点集合 | 拖动过程的完整轨迹 |
| 拖动时长 | 整数 | 是 | 毫秒 | 完成拖动的时间 |

### 5.3 输出数据

| 数据项 | 类型 | 目标 | 说明 |
|--------|------|------|------|
| 验证结果 | 对象 | 服务器 | 包含验证令牌和行为数据 |

---

## 6. 验证规则

### 6.1 位置验证规则

- 拖动位置在正确位置±5像素范围内视为成功
- 验证拖动轨迹的连续性
- 验证拖动速度的合理性

### 6.2 行为验证规则

- 拖动时长应在合理范围（0.5-10秒）
- 拖动轨迹应平滑连续
- 检测重放攻击和脚本行为

### 6.3 安全规则

- 验证令牌一次性使用
- 令牌有效期5分钟
- IP级别的验证频率限制

---

## 7. 技术考虑

### 7.1 CAPTCHA实现

- 使用Canvas或图片叠加实现拼图效果
- 服务端生成拼图图片和缺口位置
- 前端收集用户行为数据
- 后端验证位置和行为模式

### 7.2 拖动交互

- 监听touchstart/mousedown事件
- 监听touchmove/mousemove事件
- 监听touchend/mouseup事件
- 记录完整的拖动轨迹

### 7.3 安全性

- 图片动态生成防止缓存破解
- 验证行为特征（速度、轨迹、加速度）
- 检测自动化工具和脚本
- 服务端最终验证

### 7.4 用户体验

- 拖动流畅无延迟
- 视觉反馈清晰
- 成功/失败状态明显
- 支持刷新重试

### 7.5 可访问性

- 提供替代验证方式（如音频验证）
- 支持键盘操作（箭头键拖动）
- 屏幕阅读器支持

---

## 8. 验收标准汇总

### 8.1 功能验收

- [ ] 拖动验证功能正常
- [ ] 验证失败正确处理
- [ ] 刷新拼图功能正常
- [ ] 关闭操作正确执行
- [ ] 安全验证有效

### 8.2 交互验收

- [ ] 拖动流畅无卡顿
- [ ] 拼图块同步移动
- [ ] 回弹动画流畅
- [ ] 成功/失败反馈明确

### 8.3 安全验收

- [ ] 防机器人有效
- [ ] 行为检测准确
- [ ] 验证令牌安全
- [ ] 频率限制正常

### 8.4 用户体验验收

- [ ] 图片加载快速
- [ ] 提示文字清晰
- [ ] 操作符合直觉
- [ ] 成功率合理
