# 钱包切换逻辑 - 公共规格文档

## 1. 文档标识

| 属性 | 值 |
|------|-----|
| 文档ID | COMMON-004 |
| 文档名称 | 钱包切换逻辑 |
| 版本 | 1.0 |
| 更新日期 | 2025-12-08 |
| 适用范围 | 中心化钱包、去中心化钱包 |

---

## 2. 概述

企业内部钱包包含两种钱包类型：
- **平台账户 (Web2 钱包)**: 中心化托管钱包，需登录账户
- **Web3 钱包**: 去中心化非托管钱包，用户自持私钥

用户可在两种钱包之间无缝切换。

---

## 3. 切换按钮位置

### 3.1 底部导航栏

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│                    [钱包内容区域]                         │
│                                                         │
├─────────────────────────────────────────────────────────┤
│                                                         │
│     资产          [Web3钱包]          我的/设置          │
│      🏠              🔄               👤                │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 3.2 切换按钮样式

| 当前钱包 | 按钮文案 | 点击后 |
|----------|----------|--------|
| 平台账户 (Web2) | "Web3钱包" | 切换到 Web3 钱包 |
| Web3 钱包 | "平台账户" | 切换到平台账户 |

---

## 4. 切换流程

### 4.1 从平台账户切换到 Web3 钱包

```
┌─────────────────────────────────────────────────────────────┐
│                    点击 "Web3钱包"                           │
└─────────────────────────┬───────────────────────────────────┘
                          ▼
            ┌─────────────────────────────┐
            │ 用户是否已创建/导入 Web3 钱包? │
            └──────────────┬──────────────┘
                   是 │          │ 否
                      ▼          ▼
            ┌──────────────┐   ┌─────────────────────────┐
            │ 直接进入      │   │ 进入 Web3 钱包引导页     │
            │ Web3 钱包首页 │   │ (创建/导入选择)          │
            └──────────────┘   └─────────────────────────┘
```

### 4.2 从 Web3 钱包切换到平台账户

```
┌─────────────────────────────────────────────────────────────┐
│                    点击 "平台账户"                           │
└─────────────────────────┬───────────────────────────────────┘
                          ▼
            ┌─────────────────────────────┐
            │ 用户是否已登录平台账户?       │
            └──────────────┬──────────────┘
                   是 │          │ 否
                      ▼          ▼
            ┌──────────────┐   ┌─────────────────────────┐
            │ 直接进入      │   │ 进入登录页面             │
            │ 平台账户首页  │   │                         │
            └──────────────┘   └─────────────────────────┘
```

---

## 5. 状态检测逻辑

### 5.1 检测代码

```javascript
/**
 * 获取目标钱包状态
 * @param {string} targetWallet - 'web2' | 'web3'
 * @returns {Object} 状态信息
 */
function getWalletStatus(targetWallet) {
  if (targetWallet === 'web2') {
    return {
      exists: true, // 平台账户始终存在
      isLoggedIn: checkWeb2Login(),
      redirectTo: checkWeb2Login() ? '/web2/home' : '/login',
    };
  }

  if (targetWallet === 'web3') {
    const hasWallet = checkWeb3WalletExists();
    return {
      exists: hasWallet,
      isLoggedIn: hasWallet, // Web3 有钱包即视为"已登录"
      redirectTo: hasWallet ? '/web3/home' : '/web3/onboarding',
    };
  }
}

/**
 * 执行钱包切换
 * @param {string} targetWallet - 'web2' | 'web3'
 */
function switchWallet(targetWallet) {
  const status = getWalletStatus(targetWallet);

  // 保存当前钱包上下文（可选，用于返回）
  saveCurrentWalletContext();

  // 导航到目标页面
  navigateTo(status.redirectTo);
}
```

---

## 6. 用户体验要求

### 6.1 无缝切换

| 要求 | 说明 |
|------|------|
| 快速响应 | 切换动画不超过 300ms |
| 状态保持 | 返回时恢复之前的页面状态 |
| 无强制登录 | 从 Web2 未登录状态也可切换到 Web3 |

### 6.2 视觉反馈

| 场景 | 反馈 |
|------|------|
| 点击切换按钮 | 按钮短暂高亮 |
| 切换进行中 | 显示过渡动画 |
| 切换完成 | 底部导航高亮当前钱包 |

---

## 7. 底部导航差异

### 7.1 平台账户 (Web2) 导航

```
┌─────────────────────────────────────────────────────────┐
│     资产          Web3钱包           我的               │
│      🏠              🔄               👤                │
└─────────────────────────────────────────────────────────┘
```

### 7.2 Web3 钱包导航

```
┌─────────────────────────────────────────────────────────┐
│     资产          平台账户           设置               │
│      🏠              🔄               ⚙️                │
└─────────────────────────────────────────────────────────┘
```

### 7.3 差异说明

| 位置 | 平台账户 | Web3 钱包 |
|------|----------|-----------|
| 最右侧按钮 | "我的" (👤) | "设置" (⚙️) |
| 中间按钮 | "Web3钱包" | "平台账户" |

> 两种钱包的底部导航样式保持差异，体现不同产品形态。

---

## 8. 边界情况处理

### 8.1 Web3 钱包不存在时

```
┌────────────────────────────────────────┐
│                                        │
│           欢迎使用 Web3 钱包            │
│                                        │
│      安全、去中心化的数字资产管理        │
│                                        │
│   ┌────────────────────────────────┐  │
│   │         创建新钱包              │  │
│   └────────────────────────────────┘  │
│                                        │
│   ┌────────────────────────────────┐  │
│   │         导入已有钱包            │  │
│   └────────────────────────────────┘  │
│                                        │
└────────────────────────────────────────┘
```

### 8.2 平台账户未登录时

引导用户到登录页面，登录成功后自动跳转到平台账户首页。

### 8.3 网络异常

- Web2 切换需网络：显示"网络连接失败，请检查网络后重试"
- Web3 切换无需网络：可离线访问本地钱包

---

## 9. 验收标准

- [ ] 切换按钮在底部导航栏中间位置
- [ ] 点击切换按钮正确跳转到目标钱包
- [ ] Web3 钱包不存在时显示引导页
- [ ] 平台账户未登录时跳转登录页
- [ ] 切换过程流畅，无明显卡顿
- [ ] 两种钱包底部导航差异正确显示

---

*文档创建日期: 2025-12-08*
