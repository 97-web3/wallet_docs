# 发送代币(选择代币) - 软件需求规格说明书

## 1. 页面标识
- **页面名称**: 发送代币选择页
- **页面ID**: SEND_TOKEN_SELECT_001
- **页面描述/用途**: 用户发送代币前,选择要发送的代币类型

## 2. UI组件
### 2.1 布局概述
页面采用全屏弹窗形式,顶部为搜索栏,下方为代币列表。支持滚动浏览和搜索筛选。采用暗黑主题。

### 2.2 组件详情
| 组件名称 | 组件类型 | 位置 | 描述 |
|---------|---------|------|------|
| 导航栏 | 容器 | 顶部 | 深色背景 |
| 返回按钮 | 图标按钮 | 左上角 | 左箭头,返回上一页 |
| 页面标题 | 标题文本 | 顶部中心 | "选择代币" |
| 搜索框 | 输入框 | 标题下方 | 带放大镜图标的搜索框,"搜索..."占位符 |
| 代币列表 | 滚动列表 | 主体区域 | 显示所有可发送的代币 |
| BTC代币项 | 列表项 | 列表中 | Bitcoin图标+名称+余额 |
| 代币图标 | 图标 | 列表项左侧 | 代币logo |
| 代币名称 | 文本标签 | 列表项中 | "BTC/USD" |
| 代币余额 | 文本标签 | 名称下方 | "1.001272 BTC" |
| AVAX代币项 | 列表项 | 列表中 | Avalanche信息 |
| OP代币项 | 列表项 | 列表中 | Optimism信息 |
| BNB代币项 | 列表项 | 列表中 | Binance Coin信息 |
| LINK代币项 | 列表项 | 列表中 | Chainlink信息 |

## 3. 功能需求
### 3.1 主要功能
- 显示用户钱包中所有可发送的代币
- 提供搜索功能,支持按代币名称/符号搜索
- 显示每个代币的余额
- 点击代币进入发送流程
- 只显示余额>0的代币(可选)
- 支持多链代币混合显示

### 3.2 业务逻辑
- 代币列表:从用户钱包获取所有代币余额
- 余额显示:实时查询链上余额
- 搜索匹配:支持模糊搜索
- 代币排序:可按余额价值、名称等排序
- 过滤零余额:可选择是否显示零余额代币

## 4. 用户交互
### 4.1 用户操作
| 操作 | 触发条件 | 响应 |
|-----|---------|------|
| 点击返回按钮 | 单击 | 返回上一页(通常是首页) |
| 输入搜索关键字 | 文字输入 | 实时过滤代币列表 |
| 点击代币项 | 单击 | 进入发送流程,选定该代币 |
| 上下滑动 | 滑动手势 | 浏览代币列表 |
| 下拉刷新 | 下拉手势 | 刷新代币余额 |
| 清除搜索 | 点击清除按钮 | 显示完整代币列表 |

### 4.2 导航流程
- 首页 → 点击发送按钮 → 此页面(选择代币)
- 选择代币页 → 点击代币 → 输入收款地址页面
- 选择代币页 → 返回 → 首页

### 4.3 手势操作
- 单击:选择代币
- 滑动:浏览列表
- 下拉:刷新余额

## 5. 数据需求
### 5.1 数据展示
| 数据字段 | 数据类型 | 描述 |
|---------|---------|------|
| 代币符号 | String | 代币符号(BTC、ETH等) |
| 代币名称 | String | 代币全称 |
| 代币图标 | Image URL | 代币logo |
| 代币余额 | Decimal | 用户持有的代币数量 |
| 代币网络 | String | 所属区块链网络 |
| 合约地址 | String | 代币合约地址(如适用) |

### 5.2 数据输入
- 搜索关键字:用户输入的搜索文本

### 5.3 数据来源
- 本地钱包:代币余额查询
- 区块链节点:实时余额更新
- 代币注册表:代币元数据(名称、图标等)
- 价格API:计算代币价值用于排序

## 6. 验证规则
### 6.1 输入验证
- 搜索关键字:任意文本,无特殊限制
- 选择代币:必须余额>0才可发送

### 6.2 错误处理
- 余额查询失败:显示"余额加载失败"
- 搜索无结果:显示"未找到匹配的代币"
- 网络错误:显示缓存的余额数据,标注"数据可能不是最新"
- 空代币列表:显示"暂无可发送的代币"

## 7. 技术考量
### 7.1 状态管理
- 代币列表状态
- 代币余额状态
- 搜索关键字状态
- 过滤后的列表状态
- 加载状态
- 选中代币状态

### 7.2 API集成
- 区块链RPC节点:查询代币余额
  - ERC-20代币:eth_call调用balanceOf
  - 原生代币:eth_getBalance
  - 其他链的对应接口
- 代币列表服务:获取支持的代币列表
- 价格API:获取代币价格用于排序

### 7.3 安全考量
- 验证代币合约地址
- 防止恶意代币混入列表
- 余额数据验证
- 搜索输入防注入

## 8. 性能要求
### 8.1 响应时间
- 页面加载:< 1秒
- 搜索响应:< 200毫秒(防抖优化)
- 余额刷新:< 2秒
- 列表滚动:流畅无卡顿

### 8.2 优化策略
- 代币图标懒加载
- 余额缓存机制
- 搜索防抖(300ms)
- 虚拟列表(代币数量>100时)

## 9. 搜索功能
### 9.1 搜索范围
- 代币符号(如BTC、ETH)
- 代币名称(如Bitcoin、Ethereum)
- 合约地址(支持完整或部分匹配)

### 9.2 搜索特性
- 实时搜索:输入即过滤
- 大小写不敏感
- 支持部分匹配
- 高亮匹配部分(可选)

## 10. 验收标准
- [ ] 正确显示所有有余额的代币
- [ ] 代币图标正确渲染
- [ ] 余额显示准确
- [ ] 搜索功能正常工作
- [ ] 搜索结果准确
- [ ] 点击代币能进入发送流程
- [ ] 返回按钮功能正常
- [ ] 下拉刷新功能正常
- [ ] 余额刷新后数据更新
- [ ] 空列表状态显示友好
- [ ] 搜索无结果有提示
- [ ] 网络错误有适当提示
- [ ] 列表滚动流畅
- [ ] 搜索响应快速
- [ ] 在不同屏幕尺寸下正常显示
- [ ] 暗黑主题样式正确
