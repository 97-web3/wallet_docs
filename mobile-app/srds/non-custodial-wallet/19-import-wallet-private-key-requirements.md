# 导入钱包（私钥）- 软件需求规格说明书

## 1. 页面标识
- **页面名称**: 导入钱包（私钥）
- **页面ID**: import-wallet-private-key
- **页面描述/用途**: 允许用户通过输入私钥导入已存在的钱包账户，为高级用户提供另一种钱包导入方式

## 2. UI组件
### 2.1 布局概述
页面布局与助记词导入页面保持一致，采用垂直布局，顶部为导航栏，中间为导入方式选择和输入区域，底部为操作按钮区。整体采用深色主题，使用黑色背景和荧光绿色作为主要强调色。

### 2.2 组件详情
| 组件名称 | 组件类型 | 位置 | 描述 |
|---------|---------|------|------|
| 返回按钮 | 按钮（图标） | 顶部左侧 | 返回上一页面 |
| 页面标题 | 文本标签 | 顶部中央 | 显示"导入钱包" |
| 扫码按钮 | 按钮（图标） | 顶部右侧 | 扫描二维码导入钱包 |
| 助记词标签页 | 标签按钮 | 上方左侧 | 选择助记词导入方式 |
| 私钥标签页 | 标签按钮 | 上方右侧 | 选择私钥导入方式（当前激活） |
| 私钥输入框 | 多行文本输入框 | 中部 | 用于输入私钥，带提示文字 |
| 粘贴按钮 | 文本按钮 | 输入框右下角 | 从剪贴板粘贴私钥 |
| 钱包名称标签 | 文本标签 | 输入框下方 | 显示"钱包名称" |
| 钱包名称输入框 | 单行文本输入框 | 中下部 | 输入自定义钱包名称，默认值"ETH-3" |
| 服务协议复选框 | 复选框 | 底部上方 | 用户同意服务协议 |
| 服务协议链接 | 文本链接 | 复选框右侧 | 点击查看服务协议详情 |
| 确定导入按钮 | 主要操作按钮 | 底部 | 提交导入操作，荧光绿色背景 |

## 3. 功能需求
### 3.1 主要功能
- 支持通过私钥导入钱包
- 提供私钥格式验证功能
- 支持从剪贴板快速粘贴私钥
- 允许用户自定义钱包名称
- 提供二维码扫描导入选项
- 在助记词和私钥两种导入方式间切换
- 支持多种私钥格式（Hex、WIF等）

### 3.2 业务逻辑
1. **输入验证**：
   - 验证私钥格式的有效性
   - 检查私钥长度（通常为64个十六进制字符）
   - 支持带0x前缀和不带0x前缀的私钥
   - 验证私钥是否能生成有效的公钥和地址

2. **导入流程**：
   - 用户输入或粘贴私钥
   - 输入钱包名称（可选，有默认值）
   - 勾选同意服务协议
   - 点击"确定导入"按钮
   - 系统验证私钥有效性
   - 根据私钥生成钱包地址和公钥
   - 保存钱包信息到本地（加密存储）
   - 导航到钱包主页

3. **验证规则**：
   - 私钥不能为空
   - 私钥必须是有效的十六进制字符串
   - 必须勾选服务协议才能提交
   - 检查钱包是否已存在

## 4. 用户交互
### 4.1 用户操作
| 操作 | 触发条件 | 响应 |
|-----|---------|------|
| 点击返回按钮 | 用户点击左上角返回图标 | 返回到上一个页面 |
| 点击扫码按钮 | 用户点击右上角扫码图标 | 打开相机进行二维码扫描 |
| 点击助记词标签 | 用户点击"助记词"标签 | 切换到助记词导入界面 |
| 输入私钥 | 用户在输入框中输入文字 | 实时更新输入内容，隐藏显示 |
| 点击粘贴按钮 | 用户点击"粘贴"按钮 | 从剪贴板获取内容并填充到输入框 |
| 输入钱包名称 | 用户在钱包名称框中输入 | 更新钱包名称 |
| 勾选服务协议 | 用户点击复选框 | 切换复选框状态 |
| 点击服务协议链接 | 用户点击"服务协议"文字 | 打开服务协议详情页 |
| 点击确定导入 | 用户点击底部确定按钮 | 验证输入并执行导入操作 |

### 4.2 导航流程
```
导入钱包（私钥）页 → 点击返回 → 上一页面
导入钱包（私钥）页 → 点击扫码 → 二维码扫描页
导入钱包（私钥）页 → 切换助记词标签 → 助记词导入页
导入钱包（私钥）页 → 导入成功 → 钱包主页
导入钱包（私钥）页 → 点击服务协议 → 协议详情页
```

### 4.3 手势操作
- 支持在输入框内滑动查看已输入内容
- 支持长按输入框调出系统粘贴菜单
- 私钥输入时建议使用密码遮挡显示
- 支持双击切换私钥的显示/隐藏状态

## 5. 数据需求
### 5.1 数据展示
| 数据字段 | 数据类型 | 描述 |
|---------|---------|------|
| 页面标题 | 字符串 | 固定显示"导入钱包" |
| 私钥提示 | 字符串 | "请按顺序输入助记词，并使用空格分隔"（此处应为私钥相关提示） |
| 钱包名称标签 | 字符串 | "钱包名称" |
| 默认钱包名称 | 字符串 | "ETH-3"（示例） |
| 服务协议文本 | 字符串 | "我已阅读并同意 服务协议" |

### 5.2 数据输入
- **私钥**：单行或多行文本，64个十六进制字符，可选0x前缀
- **钱包名称**：单行文本，用户自定义名称
- **协议同意状态**：布尔值，是否勾选同意

### 5.3 数据来源
- 私钥：用户手动输入或从剪贴板粘贴
- 钱包名称：系统生成默认值，用户可修改
- 服务协议：从应用配置或服务器获取

## 6. 验证规则
### 6.1 输入验证
1. **私钥验证**：
   - 不能为空
   - 必须是有效的十六进制字符串
   - 长度必须为64个字符（不含0x前缀）或66个字符（含0x前缀）
   - 只能包含0-9、a-f、A-F字符（和可选的0x前缀）
   - 验证私钥能否生成有效的公钥地址

2. **钱包名称验证**：
   - 长度限制（建议1-20个字符）
   - 可以为空（使用默认值）
   - 不允许特殊字符（根据业务需求）

3. **服务协议验证**：
   - 必须勾选才能继续

### 6.2 错误处理
| 错误场景 | 错误信息 | 处理方式 |
|---------|---------|---------|
| 私钥为空 | "请输入私钥" | 显示提示消息，禁用提交按钮 |
| 私钥格式错误 | "私钥格式不正确，请检查" | 显示错误提示 |
| 私钥长度错误 | "私钥长度不正确，应为64位十六进制字符" | 显示提示消息 |
| 私钥字符无效 | "私钥包含无效字符" | 高亮显示错误位置 |
| 私钥无法生成地址 | "无效的私钥，无法生成钱包地址" | 显示错误对话框 |
| 未勾选协议 | "请先同意服务协议" | 显示提示消息 |
| 钱包已存在 | "该钱包已导入，请勿重复导入" | 显示警告对话框 |
| 网络错误 | "网络连接失败，请稍后重试" | 显示错误提示，允许重试 |

## 7. 技术考量
### 7.1 状态管理
需要管理的状态：
- 当前选中的导入方式（助记词/私钥）
- 私钥输入内容
- 私钥显示/隐藏状态
- 钱包名称输入内容
- 服务协议勾选状态
- 输入验证状态
- 加载状态（导入中）
- 错误状态信息

### 7.2 API集成
可能需要的API：
- **验证私钥**：本地加密库验证（如ethers.js、web3.js）
- **生成钱包**：基于私钥生成钱包地址和公钥
- **保存钱包**：将钱包信息加密保存到本地存储
- **检查钱包重复**：查询本地是否已存在相同地址的钱包
- **获取钱包余额**：通过区块链节点API获取账户余额

### 7.3 安全考量
1. **数据加密**：
   - 私钥在内存中的停留时间最小化
   - 导入后立即加密存储私钥
   - 使用安全的加密算法（如AES-256）
   - 使用硬件安全模块存储（Keychain/Keystore）

2. **输入安全**：
   - 私钥输入时使用密码遮挡显示（●●●●）
   - 防止屏幕截图（设置FLAG_SECURE）
   - 禁用输入法的自动纠正和建议功能
   - 清除剪贴板中的敏感信息（导入后）
   - 考虑使用安全键盘

3. **验证安全**：
   - 离线验证私钥有效性
   - 防止暴力破解尝试
   - 输入错误次数限制
   - 添加操作日志记录

4. **存储安全**：
   - 使用硬件安全模块（如Keychain/Keystore）
   - 多重加密保护私钥
   - 定期清理临时数据和内存
   - 不在日志中记录敏感信息

5. **传输安全**：
   - 私钥不应通过网络传输
   - 所有操作在本地完成
   - 仅在必要时查询区块链数据

6. **UI安全**：
   - 警告用户私钥的重要性
   - 提醒用户不要分享私钥
   - 在敏感操作前二次确认

## 8. 验收标准
- [ ] 页面布局符合设计稿，所有UI组件正确显示
- [ ] 助记词和私钥两个标签页可以正常切换
- [ ] 私钥输入框支持输入和密码遮挡显示
- [ ] 粘贴按钮能正确从剪贴板获取私钥内容
- [ ] 支持带0x前缀和不带0x前缀的私钥格式
- [ ] 钱包名称输入框显示默认值且可编辑
- [ ] 服务协议复选框和链接正常工作
- [ ] 私钥验证功能正常，能识别有效和无效的私钥
- [ ] 私钥长度和格式验证准确
- [ ] 未勾选服务协议时无法提交
- [ ] 输入无效私钥时显示明确的错误提示
- [ ] 导入成功后正确跳转到钱包主页
- [ ] 导入的钱包能正常显示余额和交易记录
- [ ] 重复导入相同钱包时给出提示
- [ ] 所有错误场景都有友好的提示信息
- [ ] 返回按钮能正确返回上一页
- [ ] 扫码功能能正常打开相机并识别二维码
- [ ] 私钥在导入后被安全加密存储
- [ ] 私钥导入后自动清除剪贴板内容
- [ ] 屏幕截图保护功能正常工作
- [ ] 页面在不同屏幕尺寸下显示正常
- [ ] 所有交互操作响应迅速，无明显延迟
- [ ] 私钥在界面上不以明文完整显示
