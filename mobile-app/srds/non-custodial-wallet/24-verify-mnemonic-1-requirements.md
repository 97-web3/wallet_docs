# 验证助记词页面 - 软件需求规格说明书

## 1. 页面标识

| 属性 | 值 |
|------|-----|
| 页面ID | verify-mnemonic-1 |
| 页面名称 | 验证助记词页面 |
| 版本 | 2.0 |
| 更新日期 | 2025-12-09 |
| 状态 | 更新 |

### 功能描述

通过随机抽查3个助记词位置，验证用户是否正确备份了助记词。用户需要输入对应位置的正确单词，确保能够在需要时恢复钱包。

> 相关规格: [COMMON-006 术语表](../common/glossary.md)

### 验证方式变更说明

| 版本 | 验证方式 | 说明 |
|------|---------|------|
| 1.0 | 全选12个单词 | 用户需按顺序选择全部12个助记词 |
| **2.0** | **抽查3个单词** | 系统随机抽取3个位置，用户输入对应单词 |

---

## 2. UI组件

### 2.1 布局概述

页面采用垂直布局，顶部为返回按钮和标题，中间为说明文字和3个助记词输入区域，底部为验证按钮。采用简洁的输入验证方式。

### 2.2 组件详情

| 组件名称 | 组件类型 | 位置 | 描述 |
|---------|---------|------|------|
| 返回按钮 | 按钮（图标） | 顶部左侧 | 返回上一页面 |
| 页面标题 | 文本标签 | 顶部中央 | "验证助记词" |
| 说明文字 | 文本段落 | 标题下方 | "请输入以下位置的助记词，以验证您已正确备份" |
| 验证卡片1 | 卡片组件 | 中上部 | 第1个待验证的助记词 |
| 位置标签1 | 文本标签 | 卡片内左上 | "第 X 个单词"（如"第 3 个单词"） |
| 输入框1 | 文本输入框 | 卡片内 | 输入对应位置的助记词 |
| 验证卡片2 | 卡片组件 | 中部 | 第2个待验证的助记词 |
| 位置标签2 | 文本标签 | 卡片内左上 | "第 X 个单词" |
| 输入框2 | 文本输入框 | 卡片内 | 输入对应位置的助记词 |
| 验证卡片3 | 卡片组件 | 中下部 | 第3个待验证的助记词 |
| 位置标签3 | 文本标签 | 卡片内左上 | "第 X 个单词" |
| 输入框3 | 文本输入框 | 卡片内 | 输入对应位置的助记词 |
| 提示文字 | 文本标签 | 输入区下方 | "助记词区分大小写，请准确输入" |
| 验证按钮 | 主要操作按钮 | 底部 | "验证"，荧光绿色背景 |

---

## 3. 功能需求

### FR-VM-01: 随机抽取验证位置

| 字段 | 内容 |
|------|------|
| **ID** | FR-VM-01 |
| **描述** | 系统随机抽取3个助记词位置供用户验证 |
| **验收标准** | 1. **假设** 用户进入验证页面, **当** 页面加载, **则** 系统从1-12中随机抽取3个不重复的位置<br>2. **假设** 抽取位置, **当** 生成, **则** 3个位置按从小到大顺序显示<br>3. **假设** 每次进入页面, **当** 加载, **则** 重新随机抽取（防止记忆作弊） |
| **优先级** | 必须 |

### FR-VM-02: 显示验证位置

| 字段 | 内容 |
|------|------|
| **ID** | FR-VM-02 |
| **描述** | 显示需要验证的助记词位置 |
| **验收标准** | 1. **假设** 位置已抽取, **当** 显示, **则** 每个卡片显示"第 X 个单词"标签<br>2. **假设** 位置显示, **当** 渲染, **则** 使用中文序数词（如"第 3 个"、"第 7 个"、"第 11 个"） |
| **优先级** | 必须 |

### FR-VM-03: 输入助记词

| 字段 | 内容 |
|------|------|
| **ID** | FR-VM-03 |
| **描述** | 用户在输入框中输入对应位置的助记词 |
| **验收标准** | 1. **假设** 用户点击输入框, **当** 聚焦, **则** 弹出英文键盘（小写优先）<br>2. **假设** 用户输入, **当** 输入变化, **则** 实时显示输入内容<br>3. **假设** 输入完成, **当** 点击下一个输入框或键盘完成, **则** 光标移至下一输入框 |
| **优先级** | 必须 |

### FR-VM-04: 验证助记词

| 字段 | 内容 |
|------|------|
| **ID** | FR-VM-04 |
| **描述** | 验证用户输入的3个助记词是否正确 |
| **验收标准** | 1. **假设** 用户点击验证按钮, **当** 触发, **则** 验证3个输入是否与对应位置的助记词匹配<br>2. **假设** 全部正确, **当** 验证通过, **则** 跳转至创建成功页面<br>3. **假设** 任一错误, **当** 验证失败, **则** 标记错误的输入框（红色边框）并显示"验证失败，请检查输入"<br>4. **假设** 验证比较, **当** 匹配, **则** 忽略大小写（均转为小写比较） |
| **优先级** | 必须 |

### FR-VM-05: 验证失败处理

| 字段 | 内容 |
|------|------|
| **ID** | FR-VM-05 |
| **描述** | 处理验证失败的情况 |
| **验收标准** | 1. **假设** 验证失败, **当** 发生, **则** 标记错误的输入框并显示错误提示<br>2. **假设** 验证失败, **当** 失败, **则** 允许用户修改后重新验证<br>3. **假设** 用户点击返回, **当** 触发, **则** 返回备份页面重新查看助记词 |
| **优先级** | 必须 |

---

## 4. 用户交互

### 4.1 用户工作流

1. 用户从备份助记词页面进入验证页面
2. 查看系统随机抽取的3个位置（如：第3个、第7个、第11个）
3. 依次在对应输入框中输入助记词
4. 点击"验证"按钮
5. 验证成功：跳转到创建成功页面
6. 验证失败：显示错误，可重试

### 4.2 导航流程

```
备份助记词页 → 验证助记词页 (verify-mnemonic-1)
                    ↓
         ┌─────────┴─────────┐
         ↓                   ↓
    验证成功              验证失败
         ↓                   ↓
    创建成功页          重试或返回备份页
```

### 4.3 手势操作

- 点击输入框弹出键盘
- 点击键盘"下一步"切换输入框
- 点击空白区域收起键盘

---

## 5. 数据需求

### 5.1 数据展示

| 数据字段 | 数据类型 | 描述 |
|---------|---------|------|
| 页面标题 | String | "验证助记词" |
| 说明文字 | String | "请输入以下位置的助记词，以验证您已正确备份" |
| 抽取的位置 | Array[3] | 随机抽取的3个位置（1-12） |
| 位置标签 | String | "第 X 个单词" |
| 验证按钮文字 | String | "验证" |

### 5.2 数据输入

| 字段名称 | 数据类型 | 必填 | 验证规则 |
|---------|---------|------|---------|
| 助记词1 | String | 是 | 非空，BIP39词库中的有效单词 |
| 助记词2 | String | 是 | 非空，BIP39词库中的有效单词 |
| 助记词3 | String | 是 | 非空，BIP39词库中的有效单词 |

### 5.3 数据来源

- 原始助记词：从备份页面传递或本地加密存储读取
- 随机位置：本地随机算法生成
- BIP39词库：内置词库用于输入提示（可选）

---

## 6. 验证规则

### 6.1 输入验证

| 规则 | 说明 |
|------|------|
| 非空验证 | 3个输入框都不能为空 |
| 格式验证 | 只允许英文字母，无空格 |
| 大小写 | 验证时忽略大小写 |
| 去空格 | 验证前去除首尾空格 |

### 6.2 业务验证

| 规则 | 说明 |
|------|------|
| 位置匹配 | 输入的单词必须与对应位置的助记词完全匹配 |
| 全部正确 | 3个单词都正确才算验证通过 |

### 6.3 错误处理

| 错误场景 | 错误信息 | 处理方式 |
|---------|---------|---------|
| 输入为空 | "请输入第 X 个助记词" | 标记对应输入框 |
| 单词错误 | "验证失败，请检查输入" | 标记错误的输入框（红色边框），允许重试 |
| 数据丢失 | "数据加载失败，请重新备份" | 返回备份页面 |

---

## 7. 技术考量

### 7.1 状态管理

需要管理的状态：
- 原始助记词数据（12个单词，加密存储）
- 随机抽取的3个位置
- 3个输入框的值
- 每个输入框的错误状态
- 验证按钮的启用/禁用状态

### 7.2 随机算法

```javascript
// 从1-12中随机抽取3个不重复的位置
function getRandomPositions() {
  const positions = [];
  while (positions.length < 3) {
    const pos = Math.floor(Math.random() * 12) + 1;
    if (!positions.includes(pos)) {
      positions.push(pos);
    }
  }
  return positions.sort((a, b) => a - b);
}
```

### 7.3 安全考量

1. **数据保护**：
   - 原始助记词在内存中加密存储
   - 验证过程在本地完成，不通过网络
   - 验证完成后立即清理敏感数据

2. **截图保护**：
   - 设置 FLAG_SECURE 防止截图
   - 输入框不显示自动补全建议

3. **防作弊**：
   - 每次进入页面重新随机抽取位置
   - 不在UI中暴露正确答案

4. **输入安全**：
   - 禁用输入框的自动完成
   - 考虑使用安全键盘

---

## 8. 验收标准汇总

1. ✅ 页面布局符合设计稿
2. ✅ 页面标题"验证助记词"正确显示
3. ✅ 说明文字清晰易懂
4. ✅ **随机抽取3个不重复的位置**
5. ✅ **位置按从小到大顺序显示**
6. ✅ **每次进入页面重新随机抽取**
7. ✅ 3个输入框正确显示对应位置标签
8. ✅ 输入框弹出英文键盘
9. ✅ 验证时忽略大小写
10. ✅ 全部正确时跳转成功页面
11. ✅ 任一错误时标记错误输入框，允许重试
12. ✅ 返回按钮功能正常
15. ✅ 截图保护功能正常
16. ✅ 页面在不同屏幕尺寸下显示正常

---

## 9. 无障碍访问要求

- [ ] 所有文本颜色对比度符合 WCAG 2.1 AA 标准（最低4.5:1）
- [ ] 输入框有清晰的标签和占位符
- [ ] 错误状态可被屏幕阅读器朗读
- [ ] 按钮最小触摸目标 44x44pt
- [ ] 支持键盘导航

---

*文档更新日期: 2025-12-09*
*变更说明: 验证方式从"全选12个单词"改为"抽查3个单词"，符合PRD规格*
