# 最近交易记录 - 软件需求规格说明书

## 1. 页面标识
- **页面名称**: 最近交易记录页
- **页面ID**: TRANSACTION_HISTORY_001
- **页面描述/用途**: 展示用户钱包的所有历史交易记录,包括接收、发送、兑换等各类操作记录

## 2. UI组件
### 2.1 布局概述
页面采用垂直列表布局,按时间倒序显示交易记录。使用日期分组,每个交易项显示为独立卡片。整体采用暗黑主题。

### 2.2 组件详情
| 组件名称 | 组件类型 | 位置 | 描述 |
|---------|---------|------|------|
| 状态栏 | 系统组件 | 顶部 | 显示时间(9:41)、信号、WiFi和电池状态 |
| 返回按钮 | 图标按钮 | 左上角 | 左箭头,返回上一页 |
| 页面标题 | 标题文本 | 顶部中心 | "最近交易记录" |
| 更多选项按钮 | 图标按钮 | 右上角 | 三点图标,筛选/导出等选项 |
| 日期分组头 | 文本标签 | 列表中 | 显示日期(如"Sep 25, 2025") |
| 交易卡片-兑换 | 列表项 | 交易列表 | 显示兑换交易信息 |
| 交易图标 | 图标 | 卡片左侧 | 根据交易类型显示不同图标(BNB、OP、USDT图标等) |
| 交易状态 | 文本标签 | 卡片左侧 | "已兑换"、"已发送"、"已接收"、"应用互动" |
| 交易详情 | 文本标签 | 状态下方 | 交易对方地址或其他详情 |
| 交易金额 | 数值文本 | 卡片右侧 | 显示金额和代币符号,绿色表示收入 |
| 交易副金额 | 数值文本 | 金额下方 | 显示支出的代币数量 |
| 交易卡片-发送 | 列表项 | 交易列表 | 显示发送交易信息 |
| 交易卡片-接收 | 列表项 | 交易列表 | 显示接收交易信息 |
| 交易卡片-应用互动 | 列表项 | 交易列表 | 显示智能合约交互记录 |

## 3. 功能需求
### 3.1 主要功能
- 按时间倒序显示所有交易记录
- 使用日期分组组织交易
- 显示不同类型的交易(发送、接收、兑换、合约互动)
- 每条交易显示图标、状态、金额、对方地址等关键信息
- 支持上拉加载更多历史记录
- 支持下拉刷新最新交易
- 提供筛选和导出功能(通过更多选项)
- 点击交易项查看详情

### 3.2 业务逻辑
- 交易类型识别:
  - 已兑换:Swap/DEX交易
  - 已发送:转出交易
  - 已接收:转入交易  
  - 应用互动:智能合约调用
- 金额显示规则:
  - 接收/兑换收入:显示绿色正数
  - 发送/兑换支出:显示负数
- 地址缩略显示:0x开头,显示前后几位
- 按区块链确认状态显示(待确认/已确认)
- 多链交易混合显示

## 4. 用户交互
### 4.1 用户操作
| 操作 | 触发条件 | 响应 |
|-----|---------|------|
| 点击返回按钮 | 单击 | 返回上一页(通常是首页) |
| 点击更多选项 | 单击 | 打开菜单(筛选、导出、设置) |
| 点击交易卡片 | 单击 | 打开交易详情页面 |
| 上拉列表 | 滑动到底部 | 加载更多历史交易 |
| 下拉列表 | 下拉手势 | 刷新最新交易记录 |
| 长按交易项 | 长按 | 显示快捷操作(复制哈希、查看区块链浏览器等) |

### 4.2 导航流程
- 交易记录页 → 交易详情页(点击交易项)
- 交易记录页 → 筛选页面(点击更多选项)
- 交易记录页 → 区块链浏览器(外部链接)
- 交易记录页 → 返回首页

### 4.3 手势操作
- 单击:选择交易查看详情
- 长按:显示快捷操作菜单
- 上拉:加载更多
- 下拉:刷新数据

## 5. 数据需求
### 5.1 数据展示
| 数据字段 | 数据类型 | 描述 |
|---------|---------|------|
| 交易哈希 | String | 区块链交易哈希 |
| 交易类型 | Enum | SEND/RECEIVE/SWAP/CONTRACT |
| 交易状态 | Enum | pending/completed/failed |
| 时间戳 | DateTime | 交易确认时间 |
| 代币名称 | String | 交易涉及的代币 |
| 交易金额 | Decimal | 交易数量 |
| 对方地址 | String | 交易对方钱包地址 |
| Gas费用 | Decimal | 网络手续费 |
| 区块号 | Integer | 交易所在区块 |
| 确认数 | Integer | 区块确认数 |
| 交易备注 | String | 用户自定义备注(如有) |

### 5.2 数据输入
- 筛选条件:交易类型、时间范围、代币类型
- 搜索关键字:地址、交易哈希
- 分页参数:页码、每页数量

### 5.3 数据来源
- 区块链节点:查询链上交易历史
- 本地数据库:缓存的交易记录
- 区块链浏览器API:补充交易详情
- 价格API:历史交易的法币价值

## 6. 验证规则
### 6.1 输入验证
- 筛选日期范围需合法
- 搜索地址需符合区块链地址格式
- 交易哈希格式验证

### 6.2 错误处理
- 网络错误:显示缓存的交易记录,提示连接失败
- 加载失败:显示重试按钮
- 空交易记录:显示"暂无交易记录"提示
- 交易详情获取失败:显示基本信息,标注"详情加载失败"
- 分页加载失败:提示用户重试

## 7. 技术考量
### 7.1 状态管理
- 交易列表状态(已加载的交易)
- 加载状态(loading/success/error)
- 分页状态(当前页、是否还有更多)
- 筛选条件状态
- 刷新状态(是否正在刷新)
- 选中交易状态(用于详情展示)

### 7.2 API集成
- 区块链RPC节点
  - eth_getTransactionReceipt
  - eth_getBlockByNumber
- 交易索引服务
  - 查询地址的所有交易
  - 支持分页和筛选
- 区块链浏览器API
  - Etherscan API
  - 其他链的浏览器API
- 价格历史API
  - 获取交易时刻的代币价格

### 7.3 安全考量
- 敏感地址部分隐藏
- 交易详情验证(防止伪造交易记录)
- 外部链接打开前确认
- 交易哈希校验
- 本地缓存数据加密存储

## 8. 性能要求
### 8.1 响应时间
- 页面初始加载:< 2秒
- 下拉刷新:< 1秒
- 加载更多:< 1秒
- 交易详情打开:< 500毫秒

### 8.2 数据加载策略
- 首次加载:显示最近20-50条交易
- 分页加载:每次加载20-50条
- 本地缓存:缓存最近1000条交易
- 后台同步:定期同步最新交易

### 8.3 列表优化
- 虚拟滚动:大量数据时使用虚拟列表
- 图片懒加载:代币图标按需加载
- 防抖节流:滚动事件优化

## 9. 可访问性
- 交易状态使用图标+文字双重表达
- 颜色编码同时提供文字说明
- 支持屏幕阅读器
- 足够的触摸目标大小

## 10. 验收标准
- [ ] 正确显示所有类型的交易记录
- [ ] 交易按时间倒序排列
- [ ] 日期分组功能正常
- [ ] 交易图标和状态显示正确
- [ ] 金额和代币符号显示准确
- [ ] 颜色编码正确(收入绿色,支出白色/灰色)
- [ ] 点击交易能查看详情
- [ ] 下拉刷新功能正常
- [ ] 上拉加载更多功能正常
- [ ] 更多选项菜单可用
- [ ] 地址缩略显示正确
- [ ] 空状态显示友好提示
- [ ] 网络错误有适当提示
- [ ] 加载动画流畅
- [ ] 列表滚动性能良好
- [ ] 多链交易正确标识
