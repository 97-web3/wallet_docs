# 导入钱包（助记词）- 软件需求规格说明书

## 1. 页面标识
- **页面名称**: 导入钱包（助记词）
- **页面ID**: import-wallet-mnemonic
- **页面描述/用途**: 允许用户通过输入 12 位助记词导入已存在的钱包账户，支持用户恢复之前创建的钱包
- **版本**: 1.1
- **更新日期**: 2025-12-08

> 相关规格: [COMMON-003 区块链网络规格](../common/blockchain-networks.md)

### 助记词规格
- **位数**: 仅支持 **12 位**助记词 (BIP39 标准)
- **分隔**: 单词之间用空格分隔
- **验证**: 每个单词必须在 BIP39 词库中

## 2. UI组件
### 2.1 布局概述
页面采用垂直布局，顶部为导航栏，中间为导入方式选择和输入区域，底部为操作按钮区。整体采用深色主题，使用黑色背景和荧光绿色作为主要强调色。

### 2.2 组件详情
| 组件名称 | 组件类型 | 位置 | 描述 |
|---------|---------|------|------|
| 返回按钮 | 按钮（图标） | 顶部左侧 | 返回上一页面 |
| 页面标题 | 文本标签 | 顶部中央 | 显示"导入钱包" |
| 扫码按钮 | 按钮（图标） | 顶部右侧 | 扫描二维码导入助记词（带安全警告） |
| 助记词标签页 | 标签按钮 | 上方左侧 | 选择助记词导入方式（当前激活） |
| 私钥标签页 | 标签按钮 | 上方右侧 | 选择私钥导入方式 |
| 助记词输入框 | 多行文本输入框 | 中部 | 用于输入助记词，带提示文字 |
| 粘贴按钮 | 文本按钮 | 输入框右下角 | 从剪贴板粘贴助记词 |
| 钱包名称标签 | 文本标签 | 输入框下方 | 显示"钱包名称" |
| 钱包名称输入框 | 单行文本输入框 | 中下部 | 输入自定义钱包名称，默认值"ETH-3" |
| 服务协议复选框 | 复选框 | 底部上方 | 用户同意服务协议 |
| 服务协议链接 | 文本链接 | 复选框右侧 | 点击查看服务协议详情 |
| 确定导入按钮 | 主要操作按钮 | 底部 | 提交导入操作，荧光绿色背景 |

## 3. 功能需求
### 3.1 主要功能
- 支持通过助记词导入钱包
- 提供助记词输入验证功能
- 支持从剪贴板快速粘贴助记词
- 允许用户自定义钱包名称
- 提供二维码扫描导入选项（带安全警告）
- 在助记词和私钥两种导入方式间切换

> **安全警告**：扫描二维码导入助记词存在安全风险，系统将在用户使用此功能前显示警告提示：
> - 仅扫描您信任的二维码
> - 不要扫描来源不明的二维码
> - 建议使用手动输入方式更安全

### 3.2 业务逻辑
1. **输入验证**：
   - 助记词必须按正确顺序输入，单词之间用空格分隔
   - 验证助记词的有效性（仅支持 12 个单词）
   - 检查助记词是否符合 BIP39 标准

2. **导入流程**：
   - 用户输入或粘贴助记词
   - 输入钱包名称（可选，有默认值）
   - 勾选同意服务协议
   - 点击"确定导入"按钮
   - 系统验证助记词有效性
   - 根据助记词生成钱包地址和私钥
   - 保存钱包信息到本地
   - 导航到钱包主页

3. **验证规则**：
   - 助记词不能为空
   - 助记词必须是有效的BIP39单词
   - 必须勾选服务协议才能提交

## 4. 用户交互
### 4.1 用户操作
| 操作 | 触发条件 | 响应 |
|-----|---------|------|
| 点击返回按钮 | 用户点击左上角返回图标 | 返回到上一个页面 |
| 点击扫码按钮 | 用户点击右上角扫码图标 | 显示安全警告弹窗，确认后打开相机扫描二维码 |
| 点击私钥标签 | 用户点击"私钥"标签 | 切换到私钥导入界面 |
| 输入助记词 | 用户在输入框中输入文字 | 实时更新输入内容 |
| 点击粘贴按钮 | 用户点击"粘贴"按钮 | 从剪贴板获取内容并填充到输入框 |
| 输入钱包名称 | 用户在钱包名称框中输入 | 更新钱包名称 |
| 勾选服务协议 | 用户点击复选框 | 切换复选框状态 |
| 点击服务协议链接 | 用户点击"服务协议"文字 | 打开服务协议详情页 |
| 点击确定导入 | 用户点击底部确定按钮 | 验证输入并执行导入操作 |

### 4.2 导航流程
```
导入钱包页 → 点击返回 → 上一页面
导入钱包页 → 切换私钥标签 → 私钥导入页
导入钱包页 → 导入成功 → 钱包主页
导入钱包页 → 点击服务协议 → 协议详情页
```

### 4.3 手势操作
- 支持在输入框内滑动查看已输入内容
- 支持长按输入框调出系统粘贴菜单
- 支持下拉刷新（如果需要）

## 5. 数据需求
### 5.1 数据展示
| 数据字段 | 数据类型 | 描述 |
|---------|---------|------|
| 页面标题 | 字符串 | 固定显示"导入钱包" |
| 助记词提示 | 字符串 | "请按顺序输入助记词，并使用空格分隔" |
| 钱包名称标签 | 字符串 | "钱包名称" |
| 默认钱包名称 | 字符串 | "ETH-3"（示例） |
| 服务协议文本 | 字符串 | "我已阅读并同意 服务协议" |

### 5.2 数据输入
- **助记词**：多行文本，12 个 BIP39 单词，空格分隔
- **钱包名称**：单行文本，用户自定义名称
- **协议同意状态**：布尔值，是否勾选同意

### 5.3 数据来源
- 助记词：用户手动输入或从剪贴板粘贴
- 钱包名称：系统生成默认值，用户可修改
- 服务协议：从应用配置或服务器获取

## 6. 验证规则
### 6.1 输入验证
1. **助记词验证**：
   - 不能为空
   - 必须包含 **12 个**单词（不支持 24 位）
   - 每个单词必须在 BIP39 词库中
   - 单词间必须用空格分隔
   - 验证助记词的校验和是否正确

2. **钱包名称验证**：
   - 长度限制（建议1-20个字符）
   - 可以为空（使用默认值）
   - 不允许特殊字符（根据业务需求）

3. **服务协议验证**：
   - 必须勾选才能继续

### 6.2 错误处理
| 错误场景 | 错误信息 | 处理方式 |
|---------|---------|---------|
| 助记词为空 | "请输入助记词" | 显示提示消息，禁用提交按钮 |
| 助记词格式错误 | "助记词格式不正确，请检查" | 显示错误提示 |
| 助记词单词无效 | "助记词包含无效单词" | **内联高亮显示无效单词**（红色下划线标注具体哪个单词无效） |
| 助记词数量错误 | "助记词必须为 12 个单词" | 显示提示消息 |
| 未勾选协议 | "请先同意服务协议" | 显示提示消息 |
| 钱包已存在 | "该钱包已导入，请勿重复导入" | 显示警告对话框 |
| 网络错误 | "网络连接失败，请稍后重试" | 显示错误提示，允许重试 |

## 7. 技术考量
### 7.1 状态管理
需要管理的状态：
- 当前选中的导入方式（助记词/私钥）
- 助记词输入内容
- 钱包名称输入内容
- 服务协议勾选状态
- 输入验证状态
- 加载状态（导入中）
- 错误状态信息

### 7.2 API集成
可能需要的API：
- **验证助记词**：本地BIP39库验证
- **生成钱包**：基于助记词生成钱包地址和私钥
- **保存钱包**：将钱包信息加密保存到本地存储
- **检查钱包重复**：查询本地是否已存在相同地址的钱包

### 7.3 安全考量
1. **数据加密**：
   - 助记词在内存中的停留时间最小化
   - 导入后立即加密存储私钥
   - 使用安全的密钥派生函数（如PBKDF2）

2. **输入安全**：
   - 考虑使用安全键盘输入
   - 防止屏幕截图（可选）
   - 清除剪贴板中的敏感信息

3. **验证安全**：
   - 离线验证助记词有效性
   - 防止暴力破解尝试
   - 输入错误次数限制

4. **存储安全**：
   - 使用硬件安全模块（如Keychain/Keystore）
   - 加密存储所有敏感信息
   - 定期清理临时数据

5. **传输安全**：
   - 助记词不应通过网络传输
   - 所有本地操作，不依赖服务器

## 8. 验收标准
- [ ] 页面布局符合设计稿，所有UI组件正确显示
- [ ] **扫码按钮功能正常，点击后显示安全警告**
- [ ] **确认安全警告后正确打开相机扫描二维码**
- [ ] **扫描成功后正确填充助记词到输入框**
- [ ] 助记词和私钥两个标签页可以正常切换
- [ ] 助记词输入框支持多行输入和显示
- [ ] 粘贴按钮能正确从剪贴板获取内容
- [ ] 钱包名称输入框显示默认值且可编辑
- [ ] 服务协议复选框和链接正常工作
- [ ] 助记词验证功能正常，能识别有效和无效的助记词
- [ ] **无效单词以红色下划线内联高亮显示**
- [ ] 未勾选服务协议时无法提交
- [ ] 输入无效助记词时显示明确的错误提示
- [ ] 导入成功后正确跳转到钱包主页
- [ ] 导入的钱包能正常显示余额和交易记录
- [ ] 重复导入相同钱包时给出提示
- [ ] 所有错误场景都有友好的提示信息
- [ ] 返回按钮能正确返回上一页
- [ ] 助记词在导入后被安全加密存储
- [ ] 页面在不同屏幕尺寸下显示正常
- [ ] 所有交互操作响应迅速，无明显延迟

## 9. 无障碍访问要求
- [ ] 所有文本颜色对比度符合WCAG 2.1 AA标准（最低4.5:1）
- [ ] 按钮和可交互元素最小触摸目标为44x44pt
- [ ] 支持屏幕阅读器，所有UI元素有适当的无障碍标签
- [ ] 错误提示可被屏幕阅读器正确朗读
- [ ] 输入框有清晰的标签和占位符文本
- [ ] 支持键盘导航（适用于平板/桌面设备）
