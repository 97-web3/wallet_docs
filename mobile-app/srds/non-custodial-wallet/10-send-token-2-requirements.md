# 发送代币_2(输入金额) - 软件需求规格说明书

## 1. 页面标识
- **页面名称**: 发送代币-输入金额页
- **页面ID**: SEND_AMOUNT_INPUT_001
- **页面描述/用途**: 用户输入要发送的代币数量,选择发送金额

## 2. UI组件
### 2.1 布局概述
页面顶部显示可用余额,中部为大尺寸金额输入区,下方显示法币等值金额和币种切换,底部为自定义数字键盘。采用暗黑主题。

### 2.2 组件详情
| 组件名称 | 组件类型 | 位置 | 描述 |
|---------|---------|------|------|
| 状态栏 | 系统组件 | 顶部 | 显示时间(9:41)、信号、WiFi和电池状态 |
| 返回按钮 | 图标按钮 | 左上角 | 左箭头,返回上一页 |
| 页面标题 | 标题文本 | 顶部中心 | "输入金额" |
| 可用余额标签 | 文本标签 | 标题下方 | "可用: 0.001447ETH" |
| 最大按钮 | 文本按钮 | 余额旁 | "最大"按钮,黄色高亮 |
| 金额输入显示 | 大文本 | 中上部 | "0.ETH",大号字体显示输入的金额 |
| 小数点光标 | 光标 | 金额中 | 绿色光标指示输入位置 |
| 法币等值 | 文本标签 | 金额下方 | "0.00 USDT",灰色小字 |
| 币种切换按钮 | 下拉按钮 | 法币等值旁 | 下拉箭头,可切换显示币种 |
| 自定义键盘 | 数字键盘 | 底部 | 3x4布局的自定义数字键盘 |
| 数字键1-9 | 按键 | 键盘区 | 数字按键1-9 |
| 数字键0 | 按键 | 键盘底部中 | 数字0 |
| 小数点键 | 按键 | 键盘左下 | "."小数点按键 |
| 删除键 | 按键 | 键盘右下 | 删除图标(退格) |
| 下一步按钮 | 主要按钮 | 键盘上方 | 亮绿色按钮,"下一步" |

## 3. 功能需求
### 3.1 主要功能
- 支持输入代币发送数量
- 显示可用余额
- 提供"最大"快捷按钮(扣除Gas费后的最大可发送金额)
- 实时显示法币等值金额
- 支持法币和代币金额切换输入
- 自定义数字键盘输入
- 实时验证输入金额合法性
- 防止超额发送

### 3.2 业务逻辑
- 金额精度:根据代币类型限制小数位数
- 余额检查:输入金额+Gas费不能超过余额
- 最大金额计算:可用余额-预估Gas费
- 法币换算:实时根据代币价格计算等值法币金额
- 输入模式切换:代币金额<->法币金额互相切换
- Gas费预估:根据网络状况预估交易费用

## 4. 用户交互
### 4.1 用户操作
| 操作 | 触发条件 | 响应 |
|-----|---------|------|
| 点击返回按钮 | 单击 | 返回输入地址页面 |
| 点击最大按钮 | 单击 | 自动填入最大可发送金额 |
| 点击数字键 | 单击 | 在光标位置输入数字 |
| 点击小数点键 | 单击 | 输入小数点(如果尚未输入) |
| 点击删除键 | 单击 | 删除最后一位数字 |
| 长按删除键 | 长按 | 清空所有输入 |
| 点击币种切换 | 单击 | 切换代币/法币输入模式 |
| 点击下一步 | 单击 | 进入交易确认页面 |

### 4.2 导航流程
- 输入地址页 → 此页面(输入金额)
- 输入金额页 → 交易确认页面
- 输入金额页 → 返回输入地址页

### 4.3 手势操作
- 单击:输入和操作
- 长按删除键:快速清空

## 5. 数据需求
### 5.1 数据展示
| 数据字段 | 数据类型 | 描述 |
|---------|---------|------|
| 可用余额 | Decimal | 用户可用的代币余额 |
| 输入金额 | Decimal | 用户输入的发送金额 |
| 法币等值 | Decimal | 对应的法币价值 |
| 代币价格 | Decimal | 当前代币法币价格 |
| 预估Gas费 | Decimal | 预估的交易手续费 |
| 最大可发金额 | Decimal | 扣除Gas后的最大金额 |
| 代币符号 | String | 代币符号(ETH、BTC等) |
| 法币符号 | String | 法币符号(USD、CNY等) |

### 5.2 数据输入
- 发送金额:用户通过键盘输入的数量

### 5.3 数据来源
- 本地钱包:可用余额查询
- 区块链节点:实时余额
- Gas预估API:预估交易费用
- 价格API:代币法币汇率
- 用户输入:金额数值

## 6. 验证规则
### 6.1 输入验证
- 金额>0
- 金额<=可用余额-Gas费
- 小数位数不超过代币精度(如ETH最多18位)
- 不允许输入多个小数点
- 最小转账金额检查(避免dust攻击)
- 金额格式验证

### 6.2 错误处理
- 金额为0:禁用下一步按钮或提示"请输入金额"
- 余额不足:显示"余额不足"错误提示
- 超过最大金额:显示"超过最大可发送金额"
- Gas费查询失败:显示"网络拥堵,请稍后重试"
- 价格获取失败:法币等值显示为"--"
- 小数位过多:自动截断或提示

## 7. 技术考量
### 7.1 状态管理
- 输入金额状态
- 可用余额状态
- Gas费估算状态
- 代币价格状态
- 输入模式状态(代币/法币)
- 验证状态(valid/invalid)
- 错误信息状态

### 7.2 API集成
- 区块链RPC节点
  - 查询余额
  - 估算Gas费(eth_estimateGas)
- 价格API
  - 实时代币价格查询
- Gas价格API
  - 当前Gas价格(Gwei)
  - 不同速度的Gas费选项

### 7.3 安全考量
- 精度处理:使用Big Number库避免浮点误差
- 余额验证:二次验证余额充足
- Gas费预留:确保有足够Gas费
- 输入清理:防止注入攻击
- 金额上限:防止输入异常大数字

## 8. 金额精度
### 8.1 不同代币精度
- Bitcoin: 8位小数(Satoshi)
- Ethereum: 18位小数(Wei)
- USDT/USDC: 6位小数
- 其他代币:根据decimals属性

### 8.2 显示精度
- 输入时:允许完整精度
- 显示时:智能截断(如显示6-8位小数)
- 法币等值:通常2位小数

## 9. 自定义键盘
### 9.1 布局设计
```
1  2  3
4  5  6
7  8  9
.  0  ⌫
```

### 9.2 键盘特性
- 大尺寸按键(易点击)
- 按键反馈(触觉/视觉)
- 暗黑主题适配
- 数字和小数点按键
- 删除键(退格功能)

## 10. Gas费处理
### 10.1 预估策略
- 快速:高Gas价格
- 标准:中等Gas价格
- 慢速:低Gas价格
- 默认使用标准速度

### 10.2 最大金额计算
- 原生代币(如ETH):余额 - Gas费
- ERC-20代币:余额(Gas费从ETH扣除)
- 确保预留足够的原生代币作为Gas费

## 11. 验收标准
- [ ] 可用余额正确显示
- [ ] 数字键盘正常输入
- [ ] 金额显示实时更新
- [ ] 法币等值实时计算
- [ ] 最大按钮功能正常
- [ ] 最大金额计算准确
- [ ] 小数点输入限制正确
- [ ] 删除键功能正常
- [ ] 长按删除可清空
- [ ] 余额不足有提示
- [ ] 超额输入有提示
- [ ] 下一步按钮状态正确
- [ ] 金额为0时禁用下一步
- [ ] 返回按钮功能正常
- [ ] Gas费预估准确
- [ ] 币种切换功能正常
- [ ] 精度处理正确
- [ ] 在不同屏幕尺寸下正常显示
- [ ] 暗黑主题样式正确
- [ ] 键盘按压反馈良好
