# 发送代币_1(输入收款地址) - 软件需求规格说明书

## 1. 页面标识
- **页面名称**: 发送代币-输入收款地址页
- **页面ID**: SEND_ADDRESS_INPUT_001
- **页面描述/用途**: 用户输入或选择收款人的钱包地址或域名

## 2. UI组件
### 2.1 布局概述
页面顶部为标题和输入区域,中部显示"我的钱包"地址选择区,底部为键盘输入区(iOS原生键盘)。采用暗黑主题。

### 2.2 组件详情
| 组件名称 | 组件类型 | 位置 | 描述 |
|---------|---------|------|------|
| 状态栏 | 系统组件 | 顶部 | 显示时间(9:41)、信号、WiFi和电池状态 |
| 返回按钮 | 图标按钮 | 左上角 | 左箭头,返回上一页 |
| 扫码按钮 | 图标按钮 | 右上角 | 二维码扫描图标 |
| 页面标题 | 标题文本 | 上部 | "收款地址" |
| 副标题 | 文本标签 | 标题下方 | "输入钱包地址或域名" |
| 粘贴按钮 | 文本按钮 | 输入区右上角 | "粘贴"按钮 |
| 输入区域 | 文本输入框 | 标题下方 | 深色背景的输入框,显示光标 |
| 分组标题 | 文本标签 | 中部 | "我的钱包" |
| 交易所账户项 | 列表项 | 我的钱包区 | Bitcoin图标+账户名+地址 |
| 账户图标 | 图标 | 列表项左侧 | 代币/链图标 |
| 账户标识 | 文本标签 | 列表项中 | "****694"(部分隐藏) |
| 完整地址 | 文本标签 | 账户标识下 | 完整地址"0Fee5MO559odo034939Z0Mt95407" |
| 钱包B账户项 | 列表项 | 我的钱包区 | AVAX图标+钱包B |
| 钱包C账户项 | 列表项 | 我的钱包区 | OP图标+钱包C |
| 系统键盘 | 输入组件 | 底部 | iOS/Android系统键盘 |

## 3. 功能需求
### 3.1 主要功能
- 支持手动输入收款地址
- 支持粘贴剪贴板地址
- 支持扫描二维码获取地址
- 显示用户自己的钱包地址列表(快速选择)
- 支持域名解析(ENS、SNS等)
- 实时验证地址格式
- 支持地址别名显示

### 3.2 业务逻辑
- 地址格式验证:根据选定的代币验证地址格式
- 域名解析:如果输入域名,解析为实际地址
- 我的钱包列表:显示同一钱包的其他账户地址
- 粘贴智能识别:自动识别剪贴板中的地址
- 防止自转:检测是否转给自己的地址并提示

## 4. 用户交互
### 4.1 用户操作
| 操作 | 触发条件 | 响应 |
|-----|---------|------|
| 点击返回按钮 | 单击 | 返回选择代币页面 |
| 点击扫码按钮 | 单击 | 打开相机扫描二维码 |
| 点击粘贴按钮 | 单击 | 从剪贴板粘贴地址到输入框 |
| 输入地址 | 键盘输入 | 实时验证格式,显示验证状态 |
| 点击我的钱包项 | 单击 | 自动填充该地址到输入框 |
| 输入完成 | 输入完整地址 | 自动进入下一步或显示确认按钮 |

### 4.2 导航流程
- 选择代币页 → 此页面(输入地址)
- 输入地址页 → 扫码页面
- 输入地址页 → 输入金额页面(地址验证通过后)
- 输入地址页 → 返回选择代币页

### 4.3 手势操作
- 单击:选择和输入
- 键盘输入:地址输入
- 滑动:浏览我的钱包列表(如有更多)

## 5. 数据需求
### 5.1 数据展示
| 数据字段 | 数据类型 | 描述 |
|---------|---------|------|
| 收款地址 | String | 用户输入或选择的地址 |
| 地址类型 | Enum | 钱包地址/域名/合约 |
| 我的钱包列表 | Array | 同一钱包的其他账户 |
| 账户别名 | String | 地址的自定义别名 |
| 剪贴板内容 | String | 系统剪贴板中的文本 |

### 5.2 数据输入
- 收款地址:钱包地址或域名
- 来源:手动输入/粘贴/扫码/选择

### 5.3 数据来源
- 用户输入:键盘输入
- 系统剪贴板:粘贴功能
- 二维码扫描:相机识别
- 本地钱包:我的钱包列表
- 域名解析服务:ENS/SNS解析

## 6. 验证规则
### 6.1 输入验证
- 地址格式验证:
  - Ethereum:0x开头,42字符(含0x),十六进制
  - Bitcoin:1/3/bc1开头,符合Base58/Bech32格式
  - Solana:Base58编码,44字符左右
  - 其他链:对应的地址格式
- 域名验证:
  - ENS:.eth结尾
  - SNS:.sol结尾
  - 其他域名服务
- Checksum验证:EIP-55校验和验证(Ethereum)
- 防自转:检测是否为自己的地址

### 6.2 错误处理
- 格式错误:显示"地址格式不正确"
- 域名解析失败:显示"域名解析失败,请检查"
- 粘贴失败:显示"剪贴板为空或无效"
- 扫码失败:显示"未识别到有效地址"
- 自转警告:显示"不能转账给自己"
- 网络错误:影响域名解析

## 7. 技术考量
### 7.1 状态管理
- 输入地址状态
- 验证状态(validating/valid/invalid)
- 域名解析状态
- 我的钱包列表状态
- 剪贴板监听状态
- 扫码结果状态

### 7.2 API集成
- 域名解析服务
  - ENS Resolver (Ethereum)
  - SNS SDK (Solana)
  - 其他域名服务
- 地址验证库
  - web3.js/ethers.js (Ethereum)
  - bitcoinjs-lib (Bitcoin)
  - @solana/web3.js (Solana)
- 二维码扫描库
  - react-native-camera
  - react-native-qrcode-scanner
- 剪贴板API
  - Clipboard API

### 7.3 安全考量
- 地址格式验证防止错误转账
- Checksum验证防止地址篡改
- 域名解析验证防止钓鱼
- 剪贴板内容清理(防止恶意注入)
- 二维码验证(防止恶意二维码)
- 防自转保护
- 相机权限请求

## 8. 地址输入辅助
### 8.1 智能识别
- 自动检测剪贴板中的地址
- 自动去除地址前后空格
- 识别不同链的地址格式
- 支持大小写混合输入

### 8.2 用户体验优化
- 输入时显示字符计数
- 验证成功显示绿色勾
- 验证失败显示红色提示
- 域名解析显示加载状态
- 粘贴后自动验证

## 9. 相机权限
### 9.1 权限请求
- 首次扫码:请求相机权限
- 权限说明:解释为何需要相机权限
- 权限被拒:显示引导到设置

### 9.2 扫码功能
- 支持扫描QR码
- 自动识别地址格式
- 扫描成功自动填充
- 支持相册选择二维码图片

## 10. 验收标准
- [ ] 可以正常输入地址
- [ ] 粘贴按钮功能正常
- [ ] 粘贴的地址自动填充
- [ ] 扫码按钮可打开扫描页
- [ ] 扫码结果自动填充
- [ ] 地址格式验证准确
- [ ] 无效地址有明确提示
- [ ] 域名可正确解析
- [ ] 我的钱包列表正确显示
- [ ] 点击钱包项可自动填充
- [ ] 防自转检测正常
- [ ] 自转时有警告提示
- [ ] 验证成功可进入下一步
- [ ] 返回按钮功能正常
- [ ] 键盘弹出和收起流畅
- [ ] 在不同屏幕尺寸下正常显示
- [ ] 暗黑主题样式正确
