# Myles Internal-Wallet 代码审查报告（2025-12-14）

## 一、审查范围

- 仓库：Internal-Wallet
- 分支：main
- 时间范围：2025-12-07 ~ 2025-12-14 期间 Myles（Git Author）相关提交
- 主要模块：
  - 业务服务（business service）核心功能：
    - 资产逻辑
    - 充值逻辑
    - 提现逻辑
    - 交易记录逻辑
    - 币种/资产详情逻辑
  - 协议（Proto）与数据库 Schema 定义
  - 用户“我的”及账号信息管理

---

## 二、主要工作概览

### 2.1 业务逻辑模块

- 代表性提交：`4b83797` 等
- 代码变化量：
  - 新增约 16,476 行，删除约 2,133 行，净增约 14,000+ 行（体量较大）
- 完成内容：
  - 开发资产相关 RPC：资产概览、资产详情、可用币种列表等；
  - 充值相关 RPC：创建充值、查询充值信息、充值记录列表、充值详情；
  - 提现相关 RPC：创建提现、提现信息与详情、审核状态查询等；
  - 交易记录逻辑：交易记录列表与详情查询；
  - 币种详情/资产详情逻辑等。
- 新增的典型逻辑文件（节选）：
  - `add_wallet_address_logic.go`
  - `create_deposit_logic.go`
  - `create_withdraw_logic.go`
  - `get_asset_detail_logic.go`
  - `get_asset_overview_logic.go`
  - `list_deposit_records_logic.go`
  - `list_transaction_records_logic.go`
  - `validate_wallet_address_logic.go`

### 2.2 协议与数据库定义

- 代表性提交：`f1e339f` 等
- 完成内容：
  - 按 SRDS 文档定义 business 模块全部 Proto 协议；
  - 按 SRDS 文档定义全部核心库表结构；
  - 调整业务服务代码结构以匹配新的协议与表定义；
  - 开发通知接口并接入 gRPC → Swagger 的自动生成链路。

### 2.3 用户与账号信息模块

- 代表性提交：`20ea33d` 等
- 完成内容：
  - “我的”相关接口实现；
  - 邮箱绑定/修改接口；
  - 手机绑定/修改接口；
  - 个人信息查询与更新；
  - 配套数据模型与 DAO 层支持。

---

## 三、功能与设计评价

> 注：详细的逐文件代码审查需按照现有《业务服务代码审查计划》执行，这里基于当前提交与文档先给出功能与结构层面的评价。

### 3.1 模块覆盖度

- 基于当前代码提交与业务文档的描述：
  - 资产、充值、提现、交易记录、币种详情等 5 大核心模块均已具备完整的接口与基础业务逻辑；
  - 通知系统也已具备完整 CRUD 接口（列表、标记已读、全部已读、删除、清空）；
  - Proto 与 DB 结构与 SRDS 文档已有系统性对齐工作。
- 评价：
  - 从功能面看，Myles 已基本搭建起“业务服务”的主干骨架，覆盖大部分用户侧和资金流的关键接口。

### 3.2 结构与可维护性

- 优点：
  - 使用 `logic/repository/model` 的分层结构，清晰分离业务逻辑、数据访问与数据结构；
  - Proto 与 SQL Schema 有集中管理，方便进行 SRDS 合规性审查；
  - 结合通知系统、用户信息模块，整体业务域较为完整。
- 风险：
  - 单次提交体量极大（1 万行级别），不利于逐步 Code Review 与问题定位；
  - 需要结合 myles.md 中的细致审查计划，对每个模块进行分批次代码走查与测试验证。

---

## 四、风险与待办

根据现有“业务服务代码审查计划”预估，当前仍可能存在以下风险点（需通过后续详细审查确认）：

1. 链监听服务缺失或未完全对接（充值相关）
   - 风险：无法自动从链上识别充值交易并入账；
   - 建议：
     - 明确与 chainsync/chainrpc 服务的对接方式；
     - 完成从“链上确认 → 数据入账 → 通知”的端到端流程。

2. 链广播服务缺失或未完全对接（提现相关）
   - 风险：提现申请无法真正广播上链；
   - 建议：
     - 与 signer / chainrpc 的交易签名与广播接口对齐；
     - 明确状态机和错误码映射（pending/review/approved/broadcasting/completed/failed）。

3. 审核与余额计算细节
   - 风险：
     - 提现审核流程、资产冻结/解冻、拒绝后的回滚等逻辑可能还存在占位实现；
     - 资产余额、可用余额、冻结余额等字段是否统一使用高精度 decimal 仍需确认。
   - 建议：
     - 按 myles.md 计划逐项核对业务状态机与金额字段处理；
     - 为关键流程补齐单元测试与集成测试。

---

## 五、总体评价

- 完成度：
  - 在业务服务层面，Myles 已完成从协议、表结构到主要 RPC 实现的“全栈式”搭建，覆盖资产/充值/提现/交易记录/通知/用户信息等核心域，工作量巨大且价值高；
- 质量：
  - 从结构与模块划分看，整体架构合理；
  - 现阶段的短板不在“有没有”，而在“是否完全按 SRDS 与实际链服务闭环打通”。

> 建议后续以 myles.md 中的详细审查计划为蓝本，分阶段对 5 大模块做深入代码走查与联调测试，以便从“功能就绪”进一步提升到“可上线”。