# 后台管理服务 (Admin Service) - 软件需求规格说明书

## 模块概述

### 用途

后台管理服务是 Internal-Wallet 系统的管理后台业务模块，为管理员和财务人员提供用户管理、财务审批、系统配置、报表分析等后台管理功能。

### 系统架构中的角色

```
┌─────────────────────────────────────────────────────────────────────┐
│                      Admin Web (管理后台前端)                        │
│  Vue/React SPA - Dashboard、用户管理、审批、报表、配置               │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    API 网关 (HTTP → gRPC)                           │
│  - JWT 认证    - RBAC 权限检查    - Admin 路由前缀                   │
│  - 速率限制    - 幂等性控制       - 审计日志                        │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
                    ▼               ▼               ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│  Admin       │ │   业务服务   │ │   链RPC服务  │ │  链同步服务  │
│  Service     │ │              │ │              │ │              │
│              │ │ - 用户数据   │ │ - 链上查询   │ │ - 余额监控   │
│ - 用户管理   │ │ - 资产数据   │ │ - 交易广播   │ │ - 区块同步   │
│ - 审批流程   │ │ - 交易记录   │ │ - Gas 估算   │ │ - 存款确认   │
│ - 报表统计   │ │              │ │              │ │              │
│ - 系统配置   │ │              │ │              │ │              │
└──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘
        │               │               │               │
        └───────────────┴───────┬───────┴───────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                          基础设施层                                 │
│  MariaDB │ Redis │ Kafka │ ETCD │ Prometheus │ Grafana │ Jaeger     │
└─────────────────────────────────────────────────────────────────────┘
```

### 服务依赖

| 依赖 | 类型 | 用途 |
|------|------|------|
| MariaDB | 数据库 | 管理员数据、审批记录、配置数据 |
| Redis | 缓存 | 会话管理、权限缓存、统计缓存 |
| ETCD | 服务发现 | 服务注册与发现 |
| Business Service | gRPC | 用户数据、资产数据、交易记录 |
| ChainRPC Service | gRPC | 链上余额查询、交易广播 |
| ChainSync Service | gRPC | 网络状态、同步状态 |
| Kafka | 消息队列 | 审计日志、通知消息 |

---

## 文档目录

| 文档 | 描述 | 功能数量 |
|------|------|----------|
| [01-登录与认证.md](./01-登录与认证.md) | 管理员登录、2FA、Token 管理 | 4 |
| [02-Dashboard.md](./02-Dashboard.md) | 统计数据、趋势图表、告警阈值 | 11 |
| [03-用户管理.md](./03-用户管理.md) | Web2 用户列表、冻结/解冻、角色管理 | 8 |
| [04-提现审批.md](./04-提现审批.md) | 提现审批队列、批量操作、风险评估 | 6 |
| [05-账本与交易.md](./05-账本与交易.md) | 交易历史、资金流水、对账 | 8 |
| [06-Swap配置.md](./06-Swap配置.md) | DEX 管理、滑点配置、汇率 | 6 |
| [07-系统设置.md](./07-系统设置.md) | 管理员管理、角色权限、系统配置 | 12 |
| [08-报表与导出.md](./08-报表与导出.md) | 交易报表、对账报表、定时任务 | 15 |
| [09-Web3用户管理.md](./09-Web3用户管理.md) | Web3 钱包用户、设备管理、地址黑名单 | 7 |
| [10-Vault资金管理.md](./10-Vault资金管理.md) | 多链钱包、余额监控、资金调整 | 6 |
| [11-转账管理.md](./11-转账管理.md) | 批量转账、Excel 导入、执行追踪 | 8 |
| [12-黑名单地址管理.md](./12-黑名单地址管理.md) | 风险地址、批量导入、监测管理 | 11 |
| [13-币种管理.md](./13-币种管理.md) | 币种配置、功能开关、上下架 | 7 |
| [14-系统状态监控.md](./14-系统状态监控.md) | 网络健康、RPC 监控、故障转移 | 9 |
| [99-数据模型与配置.md](./99-数据模型与配置.md) | 数据库表、枚举、配置、安全 | - |

**总功能数**: 118 个 API 接口

---

## API 端点概览

### 路由前缀

所有 Admin API 使用统一前缀: `/api/v1/admin/`

### 认证要求

- **认证方式**: JWT Token (HttpOnly Cookie)
- **权限控制**: RBAC (Role-Based Access Control)
- **2FA 要求**: 敏感操作需二次验证

### 端点分类统计

| 模块 | 端点数量 | 主要功能 |
|------|----------|----------|
| Dashboard | 11 | 统计、趋势、告警 |
| 用户管理 | 8 | 列表、冻结、角色 |
| 提现审批 | 6 | 审批、批量、风险 |
| 账本交易 | 8 | 流水、对账、导出 |
| Swap 配置 | 6 | DEX、滑点、代币 |
| 系统设置 | 12 | 管理员、角色、配置 |
| 报表导出 | 15 | 报表、定时、下载 |
| Web3 用户 | 7 | 设备、钱包、黑名单 |
| Vault 管理 | 6 | 余额、调整、审批 |
| 转账管理 | 8 | 批次、导入、执行 |
| 黑名单 | 11 | 地址、导入、监测 |
| 币种管理 | 7 | 配置、功能、上下架 |
| 系统状态 | 9 | 网络、RPC、故障转移 |

---

## 权限矩阵

### 角色定义

| 角色 | 代码 | 描述 |
|------|------|------|
| SuperAdmin | `super_admin` | 超级管理员，全部权限 |
| Admin | `admin` | 系统管理员，管理权限 |
| Finance | `finance` | 财务人员，财务相关权限 |

### 功能权限对照

| 功能模块 | SuperAdmin | Admin | Finance |
|----------|------------|-------|---------|
| Dashboard 查看 | ✓ | ✓ | ✓ |
| 用户管理 | ✓ | ✓ | - |
| Web3 用户管理 | ✓ | ✓ | - |
| 提现审批 | ✓ | ✓ | ✓ |
| 转账管理 | ✓ | ✓ | ✓ |
| Vault 余额调整 | ✓ | ✓ | ✓ |
| Vault 调整审批 | ✓ | - | - |
| 黑名单管理 | ✓ | ✓ | 只读 |
| 币种管理 | ✓ | ✓ | - |
| Swap 配置 | ✓ | ✓ | - |
| 系统设置 | ✓ | ✓ | - |
| 管理员管理 | ✓ | - | - |
| 报表查看 | ✓ | ✓ | ✓ |
| 报表导出 | ✓ | ✓ | ✓ |
| 对账操作 | ✓ | ✓ | - |
| 审计日志 | ✓ | ✓ | 只读 |
| 网络状态 | ✓ | ✓ | 只读 |
| RPC 故障转移 | ✓ | ✓ | - |

---

## 页面路由映射

| 前端路由 | 后端 API 前缀 | 文档 |
|----------|---------------|------|
| `/login` | `/api/v1/auth/` | [01-登录与认证](./01-登录与认证.md) |
| `/admin/dashboard` | `/api/v1/admin/dashboard/` | [02-Dashboard](./02-Dashboard.md) |
| `/admin/users` | `/api/v1/admin/users/` | [03-用户管理](./03-用户管理.md) |
| `/admin/withdrawals` | `/api/v1/admin/withdraw/` | [04-提现审批](./04-提现审批.md) |
| `/admin/ledger` | `/api/v1/admin/ledger/` | [05-账本与交易](./05-账本与交易.md) |
| `/admin/swap` | `/api/v1/admin/swap/` | [06-Swap配置](./06-Swap配置.md) |
| `/admin/settings` | `/api/v1/admin/settings/` | [07-系统设置](./07-系统设置.md) |
| `/admin/reports` | `/api/v1/admin/reports/` | [08-报表与导出](./08-报表与导出.md) |
| `/admin/web3users` | `/api/v1/admin/web3users/` | [09-Web3用户管理](./09-Web3用户管理.md) |
| `/admin/vault` | `/api/v1/admin/vault/` | [10-Vault资金管理](./10-Vault资金管理.md) |
| `/admin/transfer` | `/api/v1/admin/payroll/` | [11-转账管理](./11-转账管理.md) |
| `/admin/blacklist` | `/api/v1/admin/blacklist/` | [12-黑名单地址管理](./12-黑名单地址管理.md) |
| `/admin/currencies` | `/api/v1/admin/currencies/` | [13-币种管理](./13-币种管理.md) |
| `/admin/status` | `/api/v1/admin/status/` | [14-系统状态监控](./14-系统状态监控.md) |

---

## 技术规范

### HTTP 状态码

| 状态码 | 说明 | 使用场景 |
|--------|------|----------|
| 200 | OK | GET 请求成功 |
| 201 | Created | POST 创建资源成功 |
| 204 | No Content | DELETE 删除成功 |
| 400 | Bad Request | 请求参数格式错误 |
| 401 | Unauthorized | Token 无效或已过期 |
| 403 | Forbidden | 无权限执行该操作 |
| 404 | Not Found | 资源不存在 |
| 409 | Conflict | 资源冲突、重复操作 |
| 422 | Unprocessable Entity | 业务规则校验失败 |
| 429 | Too Many Requests | 触发限流 |
| 500 | Internal Server Error | 服务端未知错误 |

### 统一响应格式

**成功响应**:
```json
{
  "success": true,
  "message": "操作成功",
  "data": { ... },
  "request_id": "req-20251210-abc123",
  "timestamp": "2025-12-10T10:00:00Z"
}
```

**错误响应**:
```json
{
  "success": false,
  "code": 10001,
  "message": "参数错误",
  "details": {
    "field": "amount",
    "reason": "金额必须大于 0"
  },
  "request_id": "req-20251210-abc123",
  "timestamp": "2025-12-10T10:00:00Z"
}
```

### 分页规范

**请求参数**:
```json
{
  "page": 1,
  "page_size": 20
}
```

**响应格式**:
```json
{
  "success": true,
  "data": [...],
  "pagination": {
    "page": 1,
    "page_size": 20,
    "total": 100,
    "total_pages": 5,
    "has_next": true,
    "has_prev": false
  }
}
```

### 幂等性控制

敏感操作需要传递幂等键:

**请求头**:
```
Idempotency-Key: <UUID>
```

**适用接口**:
- `POST /api/v1/admin/vault/adjust`
- `POST /api/v1/admin/withdraw/{id}/approve`
- `POST /api/v1/admin/payroll/{batch_id}/process`

---

## 快速导航

- 返回 [项目总目录](../../wallet-core/srds/README.md)
- 前端文档: [Admin Web](../../admin-web/README.md)
- 上游服务: [API Gateway](../../wallet-core/srds/01-api-gateway/)
- 依赖服务: [Business Service](../../wallet-core/srds/02-business-service/)
