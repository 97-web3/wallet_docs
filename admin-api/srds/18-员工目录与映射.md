# 员工目录与映射（Employee Directory & Wallet UID Mapping）

> 返回 [Admin 服务目录](./README.md)
>
> 关联页面：`/admin/employees`（Admin Web 文档见 `wallet_docs/admin-web/18-员工目录与映射.md`）

---

该模块为“薪资发放（payroll）”提供可治理的员工主数据与 `employee_id → wallet_uid` 映射，减少长期仅依赖 Excel 造成的部门漂移、映射漂移与重复发放风险。

## 数据模型（建议）

```typescript
type EmployeeStatus = 'active' | 'on_leave' | 'terminated';

interface Employee {
  employee_id: string;
  name: string;
  department_id: string;
  department_name: string;
  status: EmployeeStatus;
  wallet_uid?: string | null;
  preferred_currency?: string | null;
  effective_from?: string | null;
  effective_to?: string | null;
  created_at: string;
  created_by: string;
  updated_at: string;
  updated_by: string;
}
```

---

## F-ADMIN-127: 获取员工列表

**描述**: 获取员工目录列表，支持筛选与分页。

**HTTP 方法**: `GET /api/v1/admin/employees`

**请求参数**:
```
?page=1
&page_size=20
&department_id=
&status=                     // active, on_leave, terminated
&bound=                      // true/false（是否已绑定 wallet_uid）
&keyword=                    // employee_id/name/wallet_uid
```

**响应 Schema**:
```json
{
  "success": true,
  "data": {
    "employees": [
      {
        "employee_id": "E000123",
        "name": "张三",
        "department_id": "dept-hr",
        "department_name": "人力资源部",
        "status": "active",
        "wallet_uid": "10001",
        "preferred_currency": "USDT",
        "created_at": "2025-12-01T00:00:00Z",
        "created_by": "hr@company.com",
        "updated_at": "2025-12-10T10:00:00Z",
        "updated_by": "hr@company.com"
      }
    ]
  },
  "pagination": {
    "page": 1,
    "page_size": 20,
    "total": 350,
    "total_pages": 18
  }
}
```

**权限要求**:
- 角色: HR（读写）, Admin（读写）, Finance（只读）, Auditor（只读+导出）

---

## F-ADMIN-128: 创建员工

**描述**: 新增员工记录（最小闭环可仅支持导入；若支持手工新增，需审计）。

**HTTP 方法**: `POST /api/v1/admin/employees`

**请求 Schema**:
```json
{
  "employee_id": "E000124",
  "name": "李四",
  "department_id": "dept-finance",
  "status": "active",
  "wallet_uid": null,
  "preferred_currency": "USDT",
  "reason": "新增员工"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "员工已创建",
  "data": {
    "employee_id": "E000124",
    "created_at": "2025-12-10T10:00:00Z",
    "created_by": "hr@company.com"
  }
}
```

**权限要求**:
- 角色: HR, Admin

---

## F-ADMIN-129: 更新员工

**描述**: 更新员工基础信息或状态。

**HTTP 方法**: `PUT /api/v1/admin/employees/{employee_id}`

**路径参数**:
- `employee_id`: 员工工号

**请求 Schema**:
```json
{
  "department_id": "dept-hr",
  "status": "on_leave",
  "preferred_currency": "USDT",
  "reason": "组织调整/请假"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "员工已更新",
  "data": {
    "employee_id": "E000124",
    "updated_at": "2025-12-10T10:30:00Z",
    "updated_by": "hr@company.com"
  }
}
```

**业务规则**:
- `terminated` 员工默认不允许出现在“薪资批次导入有效名单”（策略可配置）
- 记录审计日志（含 reason 与 diff）

**权限要求**:
- 角色: HR, Admin

---

## F-ADMIN-130: 绑定/解绑钱包 UID

**描述**: 为员工绑定或解绑 `wallet_uid`（必须二次确认并写入审计）。

**HTTP 方法**: `POST /api/v1/admin/employees/{employee_id}/bind`

**路径参数**:
- `employee_id`: 员工工号

**请求 Schema**:
```json
{
  "wallet_uid": "10001",
  "action": "bind",           // bind, unbind
  "reason": "完成开户绑定"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "绑定关系已更新",
  "data": {
    "employee_id": "E000123",
    "wallet_uid": "10001",
    "updated_at": "2025-12-10T10:40:00Z",
    "updated_by": "hr@company.com"
  }
}
```

**业务规则**:
- 同一 `wallet_uid` 不能绑定到多个 `employee_id`（冲突需阻断）
- 解绑需要 reason，并落审计

**权限要求**:
- 角色: HR, Admin

---

## F-ADMIN-131: 导入员工目录

**描述**: 通过 Excel 导入员工目录与映射（支持校验、错误回执与审计）。

**HTTP 方法**: `POST /api/v1/admin/employees/import`

**请求**: `multipart/form-data`
```
file: <Excel 文件>
mode: upsert                // upsert, dry_run
reason: "月度员工同步"
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "导入任务已提交",
  "data": {
    "task_id": "emp-import-20251210-001",
    "mode": "upsert",
    "status": "completed",
    "summary": {
      "total_rows": 350,
      "created": 12,
      "updated": 18,
      "skipped": 310,
      "failed": 10
    }
  }
}
```

**权限要求**:
- 角色: HR, Admin

---

> 返回 [Admin 服务目录](./README.md)

