# 告警中心（Alert Center）

> 返回 [Admin 服务目录](./README.md)
>
> 关联页面：`/admin/alerts`（Admin Web 文档见 `wallet_docs/admin-web/19-告警中心.md`）

---

该模块用于实现“告警触发 → 通知 → 认领(Ack) → 处理 → 恢复/关闭”的后台可执行闭环。

> 告警规则配置入口参见：`wallet_docs/admin-api/srds/settings/07-04-告警设置.md`。

## 数据模型（建议）

```typescript
type AlertSeverity = 'warning' | 'critical';
type AlertStatus = 'open' | 'acknowledged' | 'resolved' | 'closed';

interface Alert {
  alert_id: string;
  type: string;                // low_balance, sync_delay, rpc_error_rate, ...
  severity: AlertSeverity;
  status: AlertStatus;
  title: string;
  message: string;
  scope?: Record<string, any>; // chain_id/currency/vault_id 等
  threshold?: string | null;
  trigger_value?: string | null;
  owner_admin_id?: string | null;
  ack_by?: string | null;
  ack_at?: string | null;
  triggered_at: string;
  last_seen_at: string;
}
```

---

## F-ADMIN-132: 获取告警列表

**描述**: 获取告警中心列表，支持筛选与分页。

**HTTP 方法**: `GET /api/v1/admin/alerts`

**请求参数**:
```
?page=1
&page_size=20
&severity=                   // warning, critical
&status=                     // open, acknowledged, resolved, closed
&type=
&owner_admin_id=
&chain_id=
&currency=
&date_from=
&date_to=
```

**响应 Schema**:
```json
{
  "success": true,
  "data": {
    "alerts": [
      {
        "alert_id": "alert-20251210-001",
        "type": "sync_delay",
        "severity": "critical",
        "status": "open",
        "title": "Tron 同步延迟",
        "message": "同步延迟超过 2 分钟",
        "scope": {"chain_id": -1},
        "threshold": "120s",
        "trigger_value": "180s",
        "owner_admin_id": null,
        "ack_by": null,
        "ack_at": null,
        "triggered_at": "2025-12-10T09:58:00Z",
        "last_seen_at": "2025-12-10T10:05:00Z"
      }
    ]
  },
  "pagination": {
    "page": 1,
    "page_size": 20,
    "total": 12,
    "total_pages": 1
  }
}
```

**权限要求**:
- 角色: Admin, Finance, Ops（按策略可细分）

---

## F-ADMIN-133: 获取告警详情

**描述**: 获取告警详情与操作历史。

**HTTP 方法**: `GET /api/v1/admin/alerts/{alert_id}`

**路径参数**:
- `alert_id`: 告警 ID

**响应 Schema**:
```json
{
  "success": true,
  "data": {
    "alert": {
      "alert_id": "alert-20251210-001",
      "type": "sync_delay",
      "severity": "critical",
      "status": "open",
      "title": "Tron 同步延迟",
      "message": "同步延迟超过 2 分钟",
      "scope": {"chain_id": -1},
      "threshold": "120s",
      "trigger_value": "180s",
      "triggered_at": "2025-12-10T09:58:00Z",
      "last_seen_at": "2025-12-10T10:05:00Z"
    },
    "history": [
      {
        "action": "triggered",
        "by": "system",
        "at": "2025-12-10T09:58:00Z",
        "note": null
      }
    ]
  }
}
```

**权限要求**:
- 角色: Admin, Finance, Ops

---

## F-ADMIN-134: Ack（认领）告警

**描述**: 认领/确认告警进入处理态，要求备注并写入审计。

**HTTP 方法**: `POST /api/v1/admin/alerts/{alert_id}/ack`

**路径参数**:
- `alert_id`: 告警 ID

**请求 Schema**:
```json
{
  "note": "已定位为 RPC 波动，处理中"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "告警已认领",
  "data": {
    "alert_id": "alert-20251210-001",
    "status": "acknowledged",
    "ack_at": "2025-12-10T10:06:00Z",
    "ack_by": "admin-10001"
  }
}
```

**权限要求**:
- 角色: Admin, Ops

---

## F-ADMIN-135: 指派告警处理人

**描述**: 将告警指派给指定处理人（owner）。

**HTTP 方法**: `POST /api/v1/admin/alerts/{alert_id}/assign`

**请求 Schema**:
```json
{
  "owner_admin_id": "admin-10002",
  "note": "请跟进处理"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "告警已指派",
  "data": {
    "alert_id": "alert-20251210-001",
    "owner_admin_id": "admin-10002"
  }
}
```

**权限要求**:
- 角色: Admin, Ops

---

## F-ADMIN-136: 静默/关闭/恢复告警

**描述**: 静默或关闭告警（静默仍记录事件但不外发通知）。

**HTTP 方法**: `POST /api/v1/admin/alerts/{alert_id}/actions`

**请求 Schema**:
```json
{
  "action": "mute",           // mute, unmute, close, reopen
  "mute_until": "2025-12-11T00:00:00Z",
  "note": "计划维护窗口，先静默"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "操作已生效",
  "data": {
    "alert_id": "alert-20251210-001",
    "status": "acknowledged"
  }
}
```

**权限要求**:
- 角色: Admin, Ops

---

> 返回 [Admin 服务目录](./README.md)

