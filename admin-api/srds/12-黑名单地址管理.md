# 黑名单地址管理

> 返回 [Admin 服务目录](./README.md)

---

## F-ADMIN-096: 获取黑名单列表

**描述**: 获取黑名单地址列表，支持多条件筛选。

**HTTP 方法**: `GET /api/v1/admin/blacklist`

**请求参数**:
```
?page=1
&page_size=20
&risk_level=                 // high, medium, low
&network=                    // Ethereum, BSC, Tron, Polygon
&is_monitoring=              // true, false
&source=                     // manual, user_report, third_party, auto_detect, association, user_management
&keyword=                    // 地址搜索
&added_from=
&added_to=
&sort_by=added_at            // added_at, match_count, last_match_time
&sort_order=desc
```

**响应 Schema**:
```json
{
  "success": true,
  "data": {
    "addresses": [
      {
        "id": "bl-001",
        "address": "0x1234567890abcdef1234567890abcdef12345678",
        "network": "Ethereum",
        "risk_level": "high",
        "reason": "涉及洗钱活动",
        "source": "third_party",
        "source_detail": "Chainalysis",
        "is_monitoring": true,
        "match_count": 15,
        "last_match_time": "2025-12-10T09:00:00Z",
        "added_by": "admin@company.com",
        "added_at": "2025-10-01T00:00:00Z",
        "tags": ["洗钱", "混币器"]
      },
      {
        "id": "bl-002",
        "address": "TBlacklist...Address",
        "network": "Tron",
        "risk_level": "medium",
        "reason": "用户举报诈骗",
        "source": "user_report",
        "source_detail": "用户 10256 举报",
        "is_monitoring": true,
        "match_count": 3,
        "last_match_time": "2025-12-08T15:00:00Z",
        "added_by": "admin@company.com",
        "added_at": "2025-11-15T00:00:00Z",
        "tags": ["诈骗"]
      }
    ],
    "summary": {
      "total": 458,
      "high_risk": 125,
      "medium_risk": 203,
      "low_risk": 130,
      "monitoring_count": 350,
      "total_matches_today": 8
    }
  },
  "pagination": {
    "page": 1,
    "page_size": 20,
    "total": 458,
    "total_pages": 23
  }
}
```

**权限要求**:
- 角色: Admin, Finance (只读)

---

## F-ADMIN-097: 添加黑名单地址

**描述**: 添加单个地址到黑名单。

**HTTP 方法**: `POST /api/v1/admin/blacklist`

**请求 Schema**:
```json
{
  "address": "0x1234567890abcdef1234567890abcdef12345678",
  "network": "Ethereum",
  "risk_level": "high",
  "reason": "涉及洗钱活动",
  "source": "manual",
  "tags": ["洗钱", "可疑"],
  "is_monitoring": true,
  "notes": "来自执法部门通报"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "地址已添加到黑名单",
  "data": {
    "id": "bl-003",
    "address": "0x1234567890abcdef1234567890abcdef12345678",
    "network": "Ethereum",
    "risk_level": "high",
    "added_at": "2025-12-10T10:00:00Z",
    "added_by": "admin@company.com"
  }
}
```

**业务规则**:
- 自动识别地址所属网络（如未指定）
- 自动校验地址格式
- 同一地址不同网络可分别添加
- 记录操作日志

**权限要求**:
- 角色: Admin

**错误码**:
| 错误码 | HTTP 状态 | 描述 |
|--------|-----------|------|
| INVALID_ADDRESS | 400 | 地址格式无效 |
| ADDRESS_EXISTS | 409 | 地址已在黑名单中 |
| INVALID_NETWORK | 400 | 无效的网络 |

---

## F-ADMIN-098: 获取黑名单地址详情

**描述**: 获取黑名单地址的详细信息和匹配历史。

**HTTP 方法**: `GET /api/v1/admin/blacklist/{address_id}`

**路径参数**:
- `address_id`: 黑名单记录 ID

**响应 Schema**:
```json
{
  "success": true,
  "data": {
    "id": "bl-001",
    "address": "0x1234567890abcdef1234567890abcdef12345678",
    "network": "Ethereum",
    "risk_level": "high",
    "reason": "涉及洗钱活动",
    "source": "third_party",
    "source_detail": "Chainalysis 风险数据库",
    "tags": ["洗钱", "混币器"],
    "is_monitoring": true,
    "notes": "来自执法部门通报",
    "statistics": {
      "match_count": 15,
      "blocked_amount_usd": "125000.00",
      "affected_users": 8
    },
    "match_history": [
      {
        "id": "match-001",
        "type": "withdrawal_blocked",
        "user_id": "10256",
        "user_email": "user@example.com",
        "amount": "5000.00 USDT",
        "matched_at": "2025-12-10T09:00:00Z"
      },
      {
        "id": "match-002",
        "type": "deposit_flagged",
        "user_id": "10189",
        "user_email": "user2@example.com",
        "amount": "10000.00 USDT",
        "matched_at": "2025-12-08T15:00:00Z"
      }
    ],
    "chain_info": {
      "first_seen": "2023-05-15T00:00:00Z",
      "last_activity": "2025-12-05T00:00:00Z",
      "total_transactions": 1256,
      "total_volume_usd": "5800000.00",
      "is_contract": false,
      "contract_name": null
    },
    "added_by": "admin@company.com",
    "added_at": "2025-10-01T00:00:00Z",
    "updated_by": "admin@company.com",
    "updated_at": "2025-11-15T00:00:00Z"
  }
}
```

**权限要求**:
- 角色: Admin, Finance (只读)

---

## F-ADMIN-099: 更新黑名单地址

**描述**: 更新黑名单地址信息。

**HTTP 方法**: `PUT /api/v1/admin/blacklist/{address_id}`

**路径参数**:
- `address_id`: 黑名单记录 ID

**请求 Schema**:
```json
{
  "risk_level": "high",
  "reason": "更新：确认涉及多起洗钱案件",
  "tags": ["洗钱", "混币器", "高优先级"],
  "is_monitoring": true,
  "notes": "追加执法部门最新通报信息"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "黑名单信息已更新",
  "data": {
    "id": "bl-001",
    "updated_at": "2025-12-10T10:00:00Z",
    "updated_by": "admin@company.com"
  }
}
```

**权限要求**:
- 角色: Admin

---

## F-ADMIN-100: 移除黑名单地址

**描述**: 从黑名单中移除地址。

**HTTP 方法**: `DELETE /api/v1/admin/blacklist/{address_id}`

**路径参数**:
- `address_id`: 黑名单记录 ID

**请求 Schema**:
```json
{
  "reason": "误判，经核实该地址安全",
  "archive": true              // 是否归档保留记录
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "地址已从黑名单移除",
  "data": {
    "id": "bl-001",
    "address": "0x1234...5678",
    "removed_at": "2025-12-10T10:00:00Z",
    "removed_by": "admin@company.com",
    "archived": true
  }
}
```

**权限要求**:
- 角色: Admin

---

## F-ADMIN-101: 批量导入黑名单

**描述**: 批量导入黑名单地址（文本或文件）。

**HTTP 方法**: `POST /api/v1/admin/blacklist/import`

**请求 Schema** (文本导入):
```json
{
  "import_type": "text",
  "addresses": [
    {
      "address": "0x1234...5678",
      "network": "Ethereum",
      "risk_level": "high",
      "reason": "批量导入"
    },
    {
      "address": "0xabcd...efgh",
      "network": "Ethereum",
      "risk_level": "medium"
    }
  ],
  "default_risk_level": "high",
  "default_reason": "批量导入 - Chainalysis 数据",
  "is_monitoring": true
}
```

**请求** (文件导入): `multipart/form-data`
```
file: <Excel/CSV 文件>
default_risk_level: high
default_reason: 批量导入
is_monitoring: true
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "批量导入完成",
  "data": {
    "import_id": "imp-bl-20251210-001",
    "total": 100,
    "succeeded": 95,
    "failed": 3,
    "duplicates": 2,
    "errors": [
      {"address": "invalid-address", "error": "地址格式无效"},
      {"address": "0xaaa...bbb", "error": "网络不匹配"},
      {"address": "0xccc...ddd", "error": "地址格式无效"}
    ]
  }
}
```

**权限要求**:
- 角色: Admin

---

## F-ADMIN-102: 切换监控状态

**描述**: 开启或关闭地址的实时监控。

**HTTP 方法**: `PUT /api/v1/admin/blacklist/{address_id}/monitoring`

**路径参数**:
- `address_id`: 黑名单记录 ID

**请求 Schema**:
```json
{
  "is_monitoring": false,
  "reason": "地址已无活动，停止监控"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "监控状态已更新",
  "data": {
    "id": "bl-001",
    "is_monitoring": false,
    "updated_at": "2025-12-10T10:00:00Z"
  }
}
```

**权限要求**:
- 角色: Admin

---

## F-ADMIN-103: 导出黑名单

**描述**: 导出黑名单数据。

**HTTP 方法**: `GET /api/v1/admin/blacklist/export`

**请求参数**:
```
?format=xlsx                 // xlsx, csv
&risk_level=high             // 筛选条件
&network=Ethereum
```

**响应**: 文件流下载

**权限要求**:
- 角色: Admin

---

## F-ADMIN-104: 获取黑名单统计

**描述**: 获取黑名单相关统计数据。

**HTTP 方法**: `GET /api/v1/admin/blacklist/statistics`

**请求参数**:
```
?period=30d                  // 时间范围
```

**响应 Schema**:
```json
{
  "success": true,
  "data": {
    "overview": {
      "total_addresses": 458,
      "high_risk": 125,
      "medium_risk": 203,
      "low_risk": 130,
      "monitoring_active": 350
    },
    "by_network": [
      {"network": "Ethereum", "count": 185, "percentage": "40.4%"},
      {"network": "BSC", "count": 120, "percentage": "26.2%"},
      {"network": "Tron", "count": 98, "percentage": "21.4%"},
      {"network": "Polygon", "count": 55, "percentage": "12.0%"}
    ],
    "by_source": [
      {"source": "third_party", "count": 180, "percentage": "39.3%"},
      {"source": "manual", "count": 150, "percentage": "32.8%"},
      {"source": "auto_detect", "count": 68, "percentage": "14.8%"},
      {"source": "user_report", "count": 45, "percentage": "9.8%"},
      {"source": "association", "count": 15, "percentage": "3.3%"}
    ],
    "match_statistics": {
      "total_matches": 1256,
      "matches_today": 8,
      "matches_this_week": 45,
      "blocked_amount_usd": "2500000.00"
    },
    "trend": [
      {"date": "2025-11-11", "new_addresses": 12, "matches": 5}
    ]
  }
}
```

**权限要求**:
- 角色: Admin, Finance

---

## F-ADMIN-105: 批量删除黑名单

**描述**: 批量删除选中的黑名单地址。

**HTTP 方法**: `DELETE /api/v1/admin/blacklist/batch`

**请求 Schema**:
```json
{
  "ids": ["bl-001", "bl-002", "bl-003"],
  "reason": "批量清理过期数据",
  "archive": true
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "批量删除完成",
  "data": {
    "total": 3,
    "succeeded": 3,
    "failed": 0
  }
}
```

**权限要求**:
- 角色: Admin

---

## F-ADMIN-106: 批量更新监控状态

**描述**: 批量开启或关闭监控。

**HTTP 方法**: `PUT /api/v1/admin/blacklist/batch/monitoring`

**请求 Schema**:
```json
{
  "ids": ["bl-001", "bl-002", "bl-003"],
  "is_monitoring": false,
  "reason": "批量停止监控非活跃地址"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "批量更新完成",
  "data": {
    "total": 3,
    "succeeded": 3,
    "failed": 0
  }
}
```

**权限要求**:
- 角色: Admin

---

## 风险等级枚举

| 等级 | 代码 | 描述 |
|------|------|------|
| 高风险 | high | 确认恶意地址 |
| 中风险 | medium | 疑似风险 |
| 低风险 | low | 轻微风险 |

## 来源枚举

| 来源 | 代码 | 描述 |
|------|------|------|
| 手动添加 | manual | 管理员手动添加 |
| 用户举报 | user_report | 用户举报 |
| 第三方数据源 | third_party | Chainalysis 等 |
| 系统自动检测 | auto_detect | 风控系统检测 |
| 关联分析 | association | 关联地址分析 |
| 用户管理标记 | user_management | 用户管理模块标记 |

## 匹配类型枚举

| 类型 | 代码 | 描述 |
|------|------|------|
| 提现拦截 | withdrawal_blocked | 提现到黑名单地址被拦截 |
| 充值标记 | deposit_flagged | 从黑名单地址充值被标记 |
| 转账拦截 | transfer_blocked | 转账被拦截 |

---

> 返回 [Admin 服务目录](./README.md)
