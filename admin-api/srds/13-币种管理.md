# 币种管理

> 返回 [Admin 服务目录](./README.md)

---

## F-ADMIN-107: 获取币种列表

**描述**: 获取系统支持的币种列表。

**HTTP 方法**: `GET /api/v1/admin/currencies`

**请求参数**:
```
?page=1
&page_size=50
&network=                    // 网络筛选: Ethereum, BSC, Tron, Polygon
&status=                     // 状态: active, inactive
&type=                       // 类型: native, token
&keyword=                    // 搜索 (符号、名称、合约地址)
```

**响应 Schema**:
```json
{
  "success": true,
  "data": {
    "currencies": [
      {
        "id": "eth-ethereum",
        "symbol": "ETH",
        "name": "Ethereum",
        "network": "Ethereum",
        "chain_id": 1,
        "type": "native",
        "contract_address": null,
        "decimals": 18,
        "icon_url": "https://cdn.example.com/tokens/eth.png",
        "status": "active",
        "features": {
          "deposit_enabled": true,
          "withdraw_enabled": true,
          "swap_enabled": true
        },
        "limits": {
          "min_deposit": "0.001",
          "min_withdraw": "0.01",
          "max_withdraw": "100.000000",
          "daily_withdraw_limit": "1000.000000"
        },
        "fees": {
          "withdraw_fee": "0.005",
          "withdraw_fee_type": "fixed"
        },
        "price_usd": "2500.00",
        "total_balance": "500.000000",
        "total_balance_usd": "1250000.00",
        "created_at": "2025-01-01T00:00:00Z",
        "updated_at": "2025-12-01T00:00:00Z"
      },
      {
        "id": "usdt-ethereum",
        "symbol": "USDT",
        "name": "Tether USD",
        "network": "Ethereum",
        "chain_id": 1,
        "type": "token",
        "contract_address": "0xdAC17F958D2ee523a2206206994597C13D831ec7",
        "decimals": 6,
        "icon_url": "https://cdn.example.com/tokens/usdt.png",
        "status": "active",
        "features": {
          "deposit_enabled": true,
          "withdraw_enabled": true,
          "swap_enabled": true
        },
        "limits": {
          "min_deposit": "10",
          "min_withdraw": "50",
          "max_withdraw": "100000.000000",
          "daily_withdraw_limit": "500000.000000"
        },
        "fees": {
          "withdraw_fee": "5",
          "withdraw_fee_type": "fixed"
        },
        "price_usd": "1.00",
        "total_balance": "4500000.000000",
        "total_balance_usd": "4500000.00"
      }
    ],
    "summary": {
      "total_currencies": 25,
      "active_currencies": 22,
      "total_balance_usd": "15800000.00"
    }
  },
  "pagination": {
    "page": 1,
    "page_size": 50,
    "total": 25,
    "total_pages": 1
  }
}
```

**权限要求**:
- 角色: Admin

---

## F-ADMIN-108: 添加币种

**描述**: 添加新的币种支持。

**HTTP 方法**: `POST /api/v1/admin/currencies`

**请求 Schema**:
```json
{
  "symbol": "WETH",
  "name": "Wrapped Ether",
  "network": "Ethereum",
  "chain_id": 1,
  "type": "token",
  "contract_address": "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
  "decimals": 18,
  "icon_url": "https://cdn.example.com/tokens/weth.png",
  "features": {
    "deposit_enabled": true,
    "withdraw_enabled": true,
    "swap_enabled": true
  },
  "limits": {
    "min_deposit": "0.001",
    "min_withdraw": "0.01",
    "max_withdraw": "100.000000",
    "daily_withdraw_limit": "1000.000000"
  },
  "fees": {
    "withdraw_fee": "0.005",
    "withdraw_fee_type": "fixed"
  }
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "币种已添加",
  "data": {
    "id": "weth-ethereum",
    "symbol": "WETH",
    "network": "Ethereum",
    "status": "inactive",
    "created_at": "2025-12-10T10:00:00Z",
    "created_by": "admin@company.com"
  }
}
```

**业务规则**:
- 新添加的币种默认为 inactive 状态
- 自动验证合约地址有效性
- Token 类型必须提供合约地址

**权限要求**:
- 角色: Admin

**错误码**:
| 错误码 | HTTP 状态 | 描述 |
|--------|-----------|------|
| CURRENCY_EXISTS | 409 | 该网络已存在此币种 |
| INVALID_CONTRACT | 400 | 合约地址无效 |
| INVALID_NETWORK | 400 | 无效的网络 |

---

## F-ADMIN-109: 获取币种详情

**描述**: 获取指定币种的详细信息。

**HTTP 方法**: `GET /api/v1/admin/currencies/{currency_id}`

**路径参数**:
- `currency_id`: 币种 ID

**响应 Schema**:
```json
{
  "success": true,
  "data": {
    "id": "usdt-ethereum",
    "symbol": "USDT",
    "name": "Tether USD",
    "network": "Ethereum",
    "chain_id": 1,
    "type": "token",
    "contract_address": "0xdAC17F958D2ee523a2206206994597C13D831ec7",
    "decimals": 6,
    "icon_url": "https://cdn.example.com/tokens/usdt.png",
    "status": "active",
    "features": {
      "deposit_enabled": true,
      "withdraw_enabled": true,
      "swap_enabled": true
    },
    "limits": {
      "min_deposit": "10",
      "min_withdraw": "50",
      "max_withdraw": "100000.000000",
      "daily_withdraw_limit": "500000.000000"
    },
    "fees": {
      "withdraw_fee": "5",
      "withdraw_fee_type": "fixed"
    },
    "price_info": {
      "price_usd": "1.00",
      "price_change_24h": "0.01%",
      "last_updated": "2025-12-10T10:00:00Z"
    },
    "balance_info": {
      "total_balance": "4500000.000000",
      "vault_balance": "3500000.000000",
      "user_balance": "1000000.000000",
      "total_balance_usd": "4500000.00"
    },
    "statistics": {
      "total_deposits": 5680,
      "total_deposit_amount": "15000000.000000",
      "total_withdrawals": 3200,
      "total_withdrawal_amount": "12000000.000000",
      "active_users": 2560
    },
    "history": [
      {
        "action": "feature_updated",
        "detail": "禁用提现功能",
        "operator": "admin@company.com",
        "timestamp": "2025-11-15T00:00:00Z"
      },
      {
        "action": "feature_updated",
        "detail": "启用提现功能",
        "operator": "admin@company.com",
        "timestamp": "2025-11-16T00:00:00Z"
      }
    ],
    "created_at": "2025-01-01T00:00:00Z",
    "created_by": "admin@company.com",
    "updated_at": "2025-12-01T00:00:00Z",
    "updated_by": "admin@company.com"
  }
}
```

**权限要求**:
- 角色: Admin

---

## F-ADMIN-110: 更新币种信息

**描述**: 更新币种的基本信息和配置。

**HTTP 方法**: `PUT /api/v1/admin/currencies/{currency_id}`

**路径参数**:
- `currency_id`: 币种 ID

**请求 Schema**:
```json
{
  "name": "Tether USD (Updated)",
  "icon_url": "https://cdn.example.com/tokens/usdt-v2.png",
  "limits": {
    "min_deposit": "20",
    "min_withdraw": "100",
    "max_withdraw": "50000.000000",
    "daily_withdraw_limit": "200000.000000"
  },
  "fees": {
    "withdraw_fee": "10",
    "withdraw_fee_type": "fixed"
  },
  "reason": "调整提现限额"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "币种信息已更新",
  "data": {
    "id": "usdt-ethereum",
    "updated_at": "2025-12-10T10:00:00Z",
    "updated_by": "admin@company.com",
    "changes": [
      {"field": "limits.max_withdraw", "old": "100000.000000", "new": "50000.000000"},
      {"field": "fees.withdraw_fee", "old": "5", "new": "10"}
    ]
  }
}
```

**权限要求**:
- 角色: Admin

---

## F-ADMIN-111: 删除币种

**描述**: 删除（下架）指定币种。

**HTTP 方法**: `DELETE /api/v1/admin/currencies/{currency_id}`

**路径参数**:
- `currency_id`: 币种 ID

**请求 Schema**:
```json
{
  "reason": "业务调整，停止支持",
  "force": false               // 是否强制删除（有余额时）
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "币种已删除",
  "data": {
    "id": "weth-ethereum",
    "deleted_at": "2025-12-10T10:00:00Z",
    "deleted_by": "admin@company.com"
  }
}
```

**业务规则**:
- 有用户余额时默认不允许删除
- 强制删除需要先处理用户余额
- 删除后保留历史记录

**权限要求**:
- 角色: Admin

**错误码**:
| 错误码 | HTTP 状态 | 描述 |
|--------|-----------|------|
| CURRENCY_NOT_FOUND | 404 | 币种不存在 |
| CURRENCY_HAS_BALANCE | 400 | 币种有用户余额，无法删除 |
| CURRENCY_IS_NATIVE | 400 | 原生代币不能删除 |

---

## F-ADMIN-112: 切换币种状态

**描述**: 上架或下架币种。

**HTTP 方法**: `POST /api/v1/admin/currencies/{currency_id}/toggle-status`

**路径参数**:
- `currency_id`: 币种 ID

**请求 Schema**:
```json
{
  "status": "active",           // active, inactive
  "reason": "完成测试，正式上架"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "币种状态已更新",
  "data": {
    "id": "weth-ethereum",
    "status": "active",
    "updated_at": "2025-12-10T10:00:00Z",
    "updated_by": "admin@company.com"
  }
}
```

**业务规则**:
- 下架后用户无法进行该币种的新交易
- 现有余额可以提现
- 状态变更记录审计日志

**权限要求**:
- 角色: Admin

---

## F-ADMIN-113: 更新功能开关

**描述**: 更新币种的功能开关（充值/提现/兑换）。

**HTTP 方法**: `PUT /api/v1/admin/currencies/{currency_id}/features`

**路径参数**:
- `currency_id`: 币种 ID

**请求 Schema**:
```json
{
  "deposit_enabled": true,
  "withdraw_enabled": false,
  "swap_enabled": true,
  "reason": "暂停提现，系统维护"
}
```

**响应 Schema**:
```json
{
  "success": true,
  "message": "功能开关已更新",
  "data": {
    "id": "usdt-ethereum",
    "features": {
      "deposit_enabled": true,
      "withdraw_enabled": false,
      "swap_enabled": true
    },
    "updated_at": "2025-12-10T10:00:00Z",
    "updated_by": "admin@company.com"
  }
}
```

**业务规则**:
- 禁用功能立即生效
- 进行中的交易不受影响
- 记录功能变更日志

**权限要求**:
- 角色: Admin

---

## 币种类型枚举

| 类型 | 代码 | 描述 |
|------|------|------|
| 原生代币 | native | 链的原生代币（ETH、BNB、TRX） |
| 代币 | token | ERC20/BEP20/TRC20 代币 |

## 币种状态枚举

| 状态 | 代码 | 描述 |
|------|------|------|
| 上架 | active | 正常可用 |
| 下架 | inactive | 已下架 |

## 手续费类型枚举

| 类型 | 代码 | 描述 |
|------|------|------|
| 固定 | fixed | 固定金额手续费 |
| 百分比 | percentage | 按金额百分比 |

---

> 返回 [Admin 服务目录](./README.md)
