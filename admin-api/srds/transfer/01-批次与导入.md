# 转账管理 - 批次与导入

> 返回 [转账管理索引](../11-转账管理.md)

---

## F-ADMIN-087: 获取转账批次列表

**描述**: 获取批量转账批次列表。

**HTTP 方法**: `GET /api/v1/admin/transfer/batches`

**请求参数**:
```
?page=1
&page_size=20
&status=                     // draft, pending, approved, processing, completed, failed, cancelled
&network=
&currency=
&date_from=
&date_to=
&keyword=                    // 搜索批次名称、ID
```

**响应 Schema**:
```json
{
  "success": true,
  "data": {
    "batches": [
      {
        "batch_id": "batch-20251210-001",
        "name": "12月工资发放",
        "network": "Ethereum",
        "currency": "USDT",
        "total_recipients": 125,
        "total_amount": "625000.000000",
        "total_amount_usd": "625000.00",
        "status": "completed",
        "success_count": 125,
        "failed_count": 0,
        "success_rate": "100%",
        "created_by": "finance@company.com",
        "created_at": "2025-12-10T08:00:00Z",
        "processed_at": "2025-12-10T09:00:00Z",
        "completed_at": "2025-12-10T09:30:00Z"
      },
      {
        "batch_id": "batch-20251209-001",
        "name": "供应商结算",
        "network": "BSC",
        "currency": "USDT",
        "total_recipients": 45,
        "total_amount": "180000.000000",
        "total_amount_usd": "180000.00",
        "status": "processing",
        "success_count": 38,
        "failed_count": 2,
        "pending_count": 5,
        "success_rate": "84.4%",
        "created_by": "finance@company.com",
        "created_at": "2025-12-09T14:00:00Z",
        "processed_at": "2025-12-09T15:00:00Z"
      }
    ],
    "summary": {
      "total_batches": 156,
      "processing_batches": 2,
      "total_transferred_usd": "8500000.00"
    }
  },
  "pagination": {
    "page": 1,
    "page_size": 20,
    "total": 156,
    "total_pages": 8
  }
}
```

**权限要求**:
- 角色: Admin, Finance

---

## F-ADMIN-088: 导入转账批次

**描述**: 通过 Excel 文件导入批量转账数据。

**HTTP 方法**: `POST /api/v1/admin/transfer/import`

**请求**: `multipart/form-data`
```
file: <Excel 文件>
name: "12月工资发放"
network: "Ethereum"
currency: "USDT"
description: "2025年12月员工工资"
```

**Excel 模板格式**:
| 收款地址 | 金额 | 备注 |
|----------|------|------|
| 0x1234...5678 | 5000.00 | 张三工资 |
| 0xabcd...efgh | 4500.00 | 李四工资 |

**响应 Schema**:
```json
{
  "success": true,
  "message": "批次导入成功",
  "data": {
    "batch_id": "batch-20251210-002",
    "name": "12月工资发放",
    "network": "Ethereum",
    "currency": "USDT",
    "status": "draft",
    "import_result": {
      "total_rows": 130,
      "valid_rows": 125,
      "invalid_rows": 5,
      "total_amount": "625000.000000",
      "errors": [
        {"row": 15, "error": "地址格式无效"},
        {"row": 28, "error": "金额必须大于 0"},
        {"row": 45, "error": "地址在黑名单中"},
        {"row": 89, "error": "重复的收款地址"},
        {"row": 102, "error": "地址格式无效"}
      ]
    },
    "created_at": "2025-12-10T10:00:00Z"
  }
}
```

**业务规则**:
- 支持 xlsx、xls、csv 格式
- 单批次最多 1000 条记录
- 自动校验地址格式和黑名单
- 自动去除重复地址

**权限要求**:
- 角色: Admin, Finance

**错误码**:
| 错误码 | HTTP 状态 | 描述 |
|--------|-----------|------|
| INVALID_FILE_FORMAT | 400 | 文件格式不支持 |
| FILE_TOO_LARGE | 400 | 文件超过大小限制 |
| EMPTY_FILE | 400 | 文件内容为空 |
| TOO_MANY_ROWS | 400 | 记录数超过限制 |

---

> 返回 [转账管理索引](../11-转账管理.md)

