# 后台管理服务 (Admin Service)

> 返回 [文档目录](../README.md)

---

## 模块概述

后台管理服务为管理员和财务角色提供系统管理功能，包括数据统计、用户管理、薪资发放、提现审批、配置管理等。

### 核心功能

- **Dashboard 数据统计**: 充值/提现统计、Vault 余额、阈值预警
- **用户管理**: 用户列表、冻结/解冻、离职处理、角色管理
- **薪资发放**: 批量导入、审批、发放、报表导出
- **提现审批**: AML 审核、人工审批、批量处理
- **Swap 配置**: DEX 管理、滑点规则、汇率接口配置
- **角色与权限**: RBAC 权限矩阵、角色分配
- **账本与 Vault**: 账本查询、Vault 余额调整、操作记录

---

## 文档列表

| 文档 | 描述 | 功能数量 |
|------|------|----------|
| [01-Dashboard统计](./01-Dashboard统计.md) | Dashboard 统计数据接口 | 4 RPC |
| [02-用户管理](./02-用户管理.md) | 用户冻结/解冻/离职 | 5 RPC |
| [03-薪资发放](./03-薪资发放.md) | 批量薪资导入/处理/导出 | 4 RPC |
| [04-提现审批](./04-提现审批.md) | 提现审批/驳回接口 | 3 RPC |
| [05-Swap配置](./05-Swap配置.md) | DEX/滑点配置管理 | 2 RPC |
| [06-角色与权限](./06-角色与权限.md) | RBAC 权限矩阵 | 3 RPC |
| [07-账本与Vault](./07-账本与Vault.md) | 账本查询/Vault调整 | 4 RPC |
| [99-数据模型与配置](./99-数据模型与配置.md) | 数据库模型与配置 | - |

---

## 权限要求

所有 Admin Service 接口需要 Admin 或 Finance 角色权限，通过 JWT Token 中的 `role` 字段进行验证。

### 角色定义

| 角色 | 描述 | 权限范围 |
|------|------|----------|
| admin | 系统管理员 | 全部功能 |
| finance | 财务人员 | 财务相关功能（薪资、审批、账本） |
| employee | 普通员工 | 无 Admin 权限 |

详细权限矩阵见 [06-角色与权限](./06-角色与权限.md)。

---

## 服务架构

```
┌─────────────────────────────────────────────────────────────┐
│                      Admin Dashboard                         │
│  (Web 管理后台)                                              │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      API Gateway                             │
│  - Admin 路由前缀: /api/v1/admin/*                          │
│  - RBAC 中间件校验                                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Admin Service (gRPC)                      │
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │  Dashboard   │  │    User      │  │   Payroll    │       │
│  │   统计模块   │  │   管理模块   │  │   薪资模块   │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │  Withdraw    │  │    Swap      │  │   Ledger     │       │
│  │   审批模块   │  │   配置模块   │  │   账本模块   │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     Business Service                         │
│  (复用用户、资产、提现等基础数据)                            │
└─────────────────────────────────────────────────────────────┘
```

---

## API 路由前缀

所有 Admin Service 路由使用统一前缀：

```
/api/v1/admin/
```

详细路由列表见 [01-api-gateway/09-路由列表](../01-api-gateway/09-路由列表.md)。

---

## 错误码范围

Admin Service 使用独立的错误码范围：

| 范围 | 模块 | 说明 |
|------|------|------|
| 80000-80999 | Payroll | 薪资发放相关错误 |
| 81000-81999 | Admin | 通用管理错误 |

详见 [99-数据模型与配置](./99-数据模型与配置.md)。

---

## 审计日志

所有 Admin 操作均记录审计日志，包括：

- 操作人 (operator_id)
- 操作时间 (operated_at)
- 操作类型 (action_type)
- 操作对象 (target_type, target_id)
- 操作前后值 (before_value, after_value)
- 操作 IP (client_ip)

审计日志保留期限：永久（合规要求）。
