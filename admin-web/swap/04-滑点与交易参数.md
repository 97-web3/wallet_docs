# Swap / 滑点与交易参数

> 返回 [Swap 配置索引](../06-Swap配置.md)

---

## 定位

本部分描述 Swap 执行过程中与用户成交保护相关的参数：
- 默认滑点、预设选项、自定义范围
- 交易截止时间（deadline）
- Gas 策略（仅 EVM 为主，Tron 模型不同）
- 价格影响告警阈值

---

## 1. 滑点配置

### 1.1 UI 结构（迁移自原 06 文档）

```
┌──────────────────────────────────────────────────────────────────┐
│ 滑点配置                                              [保存配置] │
├──────────────────────────────────────────────────────────────────┤
│ 默认滑点设置                                                     │
│ 预设选项(用户可选): [0.5%] [1%] [3%] [自定义]                    │
│ 默认值: 0.5%                                                     │
│ 用户自定义范围: 最小 0.1%  最大 5.0%                              │
│ (建议) 滑点过高会放大损失风险                                     │
├──────────────────────────────────────────────────────────────────┤
│ 交易截止时间: 默认 20 分钟；用户可选范围 1-60 分钟                │
├──────────────────────────────────────────────────────────────────┤
│ 高级设置: Gas 价格策略(标准/快速/自定义)；价格影响警告阈值 5%      │
└──────────────────────────────────────────────────────────────────┘
```

> 关键对齐：Admin API SRD 示例中 `max_slippage` 为 5.0%。为避免文档与后端不一致，本规范默认将最大滑点上限写为 **5.0%**。如业务确需更高上限，应先统一后端校验范围再更新文档。

#### 1.1.1 SRD 字段对齐（来源：`GET/PUT /api/v1/admin/swap/config`）

| UI/文档字段 | SRD 路径 | 备注 |
|---|---|---|
| 默认滑点 | slippage_settings.default_slippage | 与 SRD 一致 |
| 最大滑点 | slippage_settings.max_slippage | SRD 示例为 5.0% |
| 滑点告警阈值 | slippage_settings.slippage_warning_threshold | 超过阈值提示风险 |

#### 1.3 变更流程（避免“前端可配、后端拒绝”）

当需要调整滑点范围（最小/最大）、默认值或告警阈值时，建议按以下顺序更新：

1. 先确认后端校验范围与错误码（SRD/实现）
2. 再更新 Admin 配置页面的输入范围与提示文案
3. 最后更新本规范文档与变更记录（原因、影响范围、回滚策略）

### 1.2 滑点预设管理

| 预设值 | 显示标签 | 推荐场景 | 是否默认 |
|---|---|---|---|
| 0.5% | 0.5% | 稳定币/大盘资产 | ✓ |
| 1% | 1% | 常规交易 |  |
| 3% | 3% | 波动较大的代币 |  |

---

## 2. 交易截止时间（Deadline）

- 默认值：20 分钟
- 可选范围：1–60 分钟
- 说明：deadline 过短会增加失败率；过长会增加价格偏离风险。

> 说明：deadline 未在当前 Swap 配置 SRD 中定义；若需要后台可配，应在后端 SRD/API 中补齐字段与校验范围。

---

## 3. Gas 策略（多链差异）

- EVM：可配置标准/快速/自定义（例如 gas price gwei）
- Tron：能量/带宽模型与 EVM 不同，前端展示与配置项应区分网络类型

> 文档要求：如 UI 继续使用统一“Gas 策略”组件，需在说明中明确 Tron 的展示口径（例如只展示预估手续费，不提供 gas price 选项）。

> 说明：Gas 策略未在当前 Swap 配置 SRD 中定义；若需要后台可配，应在后端 SRD/API 中补齐字段与校验范围。

---

## 4. 价格影响（Price Impact）告警阈值

- 作用：当预估价格影响超过阈值时，向用户展示风险提示
- 建议：将“告警阈值”与“硬性禁止阈值”区分（若后端有硬性限制）

---

## 5. 对应后端接口（参考）

- `GET /api/v1/admin/swap/config`（slippage_settings）
- `PUT /api/v1/admin/swap/config`

（详见 `wallet_docs/admin-api/srds/06-Swap配置.md`）

---

> 返回 [Swap 配置索引](../06-Swap配置.md)
