# 角色权限管理

> 返回 [Admin Web 文档](./README.md) · 上至 [系统设置索引](./07-系统设置.md)

---

## 页面概览

- **路由 (UI)**: `/admin/settings/roles`
- **受众**: 管理 Admin Web 授权的安全管理员/租户管理员。
- **主要目标**: 为 Admin Web 模块提供可治理的 RBAC（基于角色的访问控制）系统，包括可审计性和最小权限原则的实施。

> 注意：遗留的单体文档在 UI 中建议“每位管理员拥有多个角色”，而当前的 Admin API SRD (`wallet_docs/admin-api/srds/07-系统设置.md`) 建模为每位管理员拥有一个单一的 `role`。请将此视为文档对齐项（参见 `wallet_docs/admin-web/07-01-人员管理.md` 中的“差距”）。

---

## 概念与范围

### RBAC 层级

- **角色 (Role)**: 权限的命名集合（例如 `finance`（财务）、`auditor`（审计员））。
- **权限 (Permission)**: 表示为 `资源.动作` 的原子能力（例如 `withdraw.approve`（提款审批）、`ledger.export`（账本导出））。
- **数据范围 (Data Scope) (推荐)**: 限制权限适用的数据范围（例如，仅限于某些金库或某些租户）。
- **职责分离 (SoD) 控制 (推荐)**: 防止角色组合冲突（例如，“创建转账批次”+“批准转账执行”）。

---

## UI / UX 规范

### 角色列表

**表格列**（推荐的最小配置）：

| 列名 | 字段 | 备注 |
|---|---|---|
| 角色代码 | `code` | 唯一、稳定的标识符；用于 API |
| 显示名称 | `name` | 对用户友好的标签 |
| 描述 | `description` | 业务含义 |
| 类型 | `is_system` | 系统角色 vs. 自定义角色 |
| 状态 | `status` | 激活 / 已禁用 |
| 已分配管理员 | `admin_count` | 治理指标 |
| 操作 | - | 查看、编辑、复制、禁用/删除 |

### 权限矩阵

使用矩阵来最大限度地减少角色配置错误。为规模化考虑，支持：

- **模块分组**和可折叠部分
- **权限内搜索**
- **批量选择**（行、列、部分）
- **保存前的变更摘要**（差异视图）
- **强制性的“原因”字段** 用于变更（审计）

---

## 权限目录（参考）

遗留的 Admin Web 文档列出了 11 个功能模块；使用它作为 UI 分组的分类法，但保持规范的权限名称与 Admin API SRD 对齐。

示例 UI 分组：

| 模块 ID | 模块名称 | 示例权限（说明性） |
|---|---|---|
| `dashboard` | 仪表板 | `dashboard.view`（查看）、`dashboard.export`（导出） |
| `vault` | 金库 | `vault.read`（读取）、`vault.adjust`（调整） |
| `transfer` | 转账 | `transfer.read`（读取）、`transfer.execute`（执行） |
| `user` | Web2 用户 | `user.read`（读取）、`user.write`（写入）、`user.freeze`（冻结） |
| `web3users` | Web3 用户 | `web3user.read`（读取）、`web3user.write`（写入） |
| `swap` | 兑换配置 | `swap.read`（读取）、`swap.config`（配置） |
| `withdraw` | 提款审批 | `withdraw.read`（读取）、`withdraw.approve`（批准）、`withdraw.reject`（拒绝） |
| `settings` | 系统设置 | `settings.read`（读取）、`settings.write`（写入） |
| `report` | 报告 | `report.read`（读取）、`report.export`（导出） |

---

## 业务规则（企业基线）

- **最小权限原则**: 角色应围绕工作职能设计；避免“除 X 之外的一切”的模式。
- **角色爆炸预防**:
  - 优先使用**范围 (scopes)**，而不是为每个团队创建角色。
  - 提供**角色模板**和**角色挖掘**报告（推荐）。
- **变更治理**:
  - 变更需要**原因**。
  - 支持对敏感角色变更进行**双重控制/审批**（推荐）。
- **SoD 执行**（推荐）：
  - 定义冲突矩阵；在分配冲突角色时进行阻止或要求批准。

---

## API 映射（当前）

参见 `wallet_docs/admin-api/srds/07-系统设置.md`：

- `GET /api/v1/admin/roles`（带权限的角色列表）
- `POST /api/v1/admin/roles/assign`（将角色分配给管理员）
- `GET /api/v1/admin/users/{uid}/permissions`（生效权限）

---

> 返回 [Admin Web 文档](./README.md)