# 系统设置

> 返回 [后台管理前端目录](./README.md)

---

## 页面概述

- **页面路径**: `/admin/settings`
- **权限要求**: Admin 角色
- **主要功能**: 角色权限管理、系统配置、告警设置、审计日志、费率与限额配置

---

## 页面布局

### 系统设置主页面结构

```
┌──────────────────────────────────────────────────────────────────────────┐
│  Header                                                                   │
├──────────┬───────────────────────────────────────────────────────────────┤
│          │  Breadcrumb: 首页 / 系统设置                                   │
│  Sidebar ├───────────────────────────────────────────────────────────────┤
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ 左侧菜单                                                  │ │
│          │  │ ├─ 角色权限                                               │ │
│          │  │ ├─ Token 与链配置                                         │ │
│          │  │ ├─ 告警设置                                               │ │
│          │  │ ├─ 手续费配置                                             │ │
│          │  │ ├─ 限额配置                                               │ │
│          │  │ └─ 审计日志                                               │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  [角色权限] 子页面:                                           │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ 角色列表                                    [添加角色]    │ │
│          │  ├──────────────────────────────────────────────────────────┤ │
│          │  │ │角色名称  │描述              │用户数│状态  │操作       │ │
│          │  │ ├──────────┼──────────────────┼──────┼──────┼───────────┤ │
│          │  │ │admin     │系统管理员        │2     │系统  │[查看]     │ │
│          │  │ │finance   │财务人员          │5     │系统  │[查看]     │ │
│          │  │ │auditor   │审计员            │1     │自定义│[编辑][删除│ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
└──────────┴───────────────────────────────────────────────────────────────┘
```

---

## 功能模块

### 1. 角色权限管理

**功能描述**: 管理系统角色和权限配置

**用户角色**: Admin

**页面路径**: `/admin/settings/roles`

#### 1.1 角色列表

**UI 组件**:
- **Table**: 角色列表表格
- **Tag**: 角色类型标签
- **Button**: 添加、编辑按钮

**表格列**:
| 列名 | 字段 | 说明 |
|------|------|------|
| 角色名称 | name | 角色标识 |
| 显示名称 | display_name | 中文名称 |
| 描述 | description | 角色说明 |
| 用户数 | user_count | 关联用户数量 |
| 类型 | type | 系统/自定义 |
| 状态 | status | 启用/禁用 |
| 操作 | - | 查看、编辑、删除 |

**系统预设角色**:
| 角色 | 说明 | 可修改 |
|------|------|--------|
| admin | 系统管理员，拥有全部权限 | 不可删除，权限不可修改 |
| finance | 财务人员，财务相关权限 | 不可删除，权限可调整 |

#### 1.2 权限矩阵

**UI 组件**:
- **Table**: 权限矩阵表格
- **Checkbox**: 权限勾选框

**权限矩阵展示**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 角色权限配置 - finance                                 [保存]    │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ │ 功能模块        │ 查看 │ 创建 │ 编辑 │ 删除 │ 审批 │ 导出 │    │
│ ├─────────────────┼──────┼──────┼──────┼──────┼──────┼──────┤    │
│ │ Dashboard       │ [✓]  │  -   │  -   │  -   │  -   │  -   │    │
│ │ 用户管理        │ [✓]  │  -   │  -   │  -   │  -   │  -   │    │
│ │ 提现审批        │ [✓]  │  -   │  -   │  -   │ [✓]  │ [✓]  │    │
│ │ 薪资发放        │ [✓]  │ [✓]  │  -   │  -   │ [✓]  │ [✓]  │    │
│ │ 账本与交易      │ [✓]  │  -   │  -   │  -   │  -   │ [✓]  │    │
│ │ Vault 管理      │ [✓]  │  -   │ [✓]  │  -   │  -   │  -   │    │
│ │ 系统设置        │  -   │  -   │  -   │  -   │  -   │  -   │    │
│ │ 审计日志        │ [✓]  │  -   │  -   │  -   │  -   │  -   │    │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

#### 1.3 添加/编辑角色

**角色配置对话框**:
```
┌────────────────────────────────────────┐
│  添加角色                         [×]  │
├────────────────────────────────────────┤
│                                        │
│  角色标识 *                            │
│  [________________________]            │
│  (字母数字下划线，如: custom_role)     │
│                                        │
│  显示名称 *                            │
│  [________________________]            │
│                                        │
│  描述                                  │
│  [________________________]            │
│                                        │
│  基于角色复制权限                      │
│  [无             ▼]                   │
│                                        │
│  状态                                  │
│  [○ 启用]  [○ 禁用]                   │
│                                        │
│         [取消]    [下一步: 配置权限]   │
│                                        │
└────────────────────────────────────────┘
```

---

### 2. Token 与链配置

**功能描述**: 管理支持的代币和区块链网络

**用户角色**: Admin

**页面路径**: `/admin/settings` → Token 与链配置

#### 2.1 Token 配置

**UI 组件**:
- **Table**: Token 列表
- **Switch**: 启用/禁用开关
- **Modal**: 配置对话框

**Token 列表**:
| 列名 | 字段 | 说明 |
|------|------|------|
| Token | symbol | 代币符号 |
| 名称 | name | 代币全称 |
| 链 | chains | 支持的链 |
| 合约地址 | contract | 合约地址 |
| 精度 | decimals | 小数位数 |
| 状态 | enabled | 启用/禁用 |

**Token 配置对话框**:
```
┌────────────────────────────────────────┐
│  Token 配置 - USDT                [×]  │
├────────────────────────────────────────┤
│                                        │
│  基本信息                              │
│  Symbol: USDT                          │
│  名称:   Tether USD                    │
│  图标:   [上传]                        │
│                                        │
│  链配置                                │
│  ┌────────────────────────────────────┐│
│  │ 链   │ 合约地址        │ 精度 │状态││
│  │ TRX  │ TR7NHqje...     │ 6    │[✓] ││
│  │ ETH  │ 0xdac17f...     │ 6    │[✓] ││
│  │ BSC  │ 0x55d398...     │ 18   │[✓] ││
│  └────────────────────────────────────┘│
│                                        │
│         [取消]    [保存]               │
│                                        │
└────────────────────────────────────────┘
```

#### 2.2 链配置

**链配置列表**:
| 列名 | 字段 | 说明 |
|------|------|------|
| 链名称 | name | TRX/ETH/BSC |
| Chain ID | chain_id | 链 ID |
| RPC 节点 | rpc_url | 主 RPC 地址 |
| 备用节点 | backup_rpc | 备用 RPC |
| 浏览器 | explorer | 区块浏览器 URL |
| 确认数 | confirmations | 所需确认数 |
| 状态 | status | 启用/禁用 |

---

### 3. 告警设置

**功能描述**: 配置系统告警规则和通知方式

**用户角色**: Admin

**页面路径**: `/admin/settings` → 告警设置

#### 3.1 告警规则列表

**UI 组件**:
- **Table**: 告警规则表格
- **Switch**: 启用/禁用
- **Button**: 添加规则

**告警规则表**:
| 列名 | 字段 | 说明 |
|------|------|------|
| 规则名称 | name | 告警名称 |
| 类型 | type | 余额/交易/系统 |
| 条件 | condition | 触发条件 |
| 级别 | level | WARNING/CRITICAL |
| 通知方式 | channels | 邮件/推送/短信 |
| 状态 | enabled | 启用/禁用 |

#### 3.2 添加告警规则

**告警规则配置**:
```
┌────────────────────────────────────────┐
│  添加告警规则                     [×]  │
├────────────────────────────────────────┤
│                                        │
│  规则名称 *                            │
│  [________________________]            │
│                                        │
│  告警类型 *                            │
│  [○ 余额告警]  [○ 交易告警]  [○ 系统] │
│                                        │
│  ── 余额告警配置 ──                    │
│                                        │
│  监控对象 *                            │
│  [Vault         ▼] [TRX    ▼] [USDT▼]│
│                                        │
│  触发条件 *                            │
│  余额 [低于  ▼] [10000    ] USDT      │
│                                        │
│  告警级别 *                            │
│  [○ WARNING 警告]  [○ CRITICAL 紧急]  │
│                                        │
│  通知方式 *                            │
│  [✓] 邮件  [✓] 站内推送  [ ] 短信     │
│                                        │
│  通知角色 *                            │
│  [✓] admin  [✓] finance               │
│                                        │
│  静默时间窗口                          │
│  [02:00] - [06:00] (非紧急告警)       │
│                                        │
│         [取消]    [保存]               │
│                                        │
└────────────────────────────────────────┘
```

---

### 4. 手续费配置

**功能描述**: 配置提现手续费规则

**用户角色**: Admin

**页面路径**: `/admin/settings` → 手续费配置

#### 4.1 手续费规则

**UI 组件**:
- **Table**: 费率配置表
- **Form**: 费率表单

**手续费配置表**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 提现手续费配置                                         [保存]    │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ │ 链   │ 币种 │ 费率类型 │ 费率/金额    │ 最低 │ 最高 │ 状态  │  │
│ ├──────┼──────┼──────────┼──────────────┼──────┼──────┼───────┤  │
│ │ TRX  │ USDT │ 固定费用 │ 2 USDT      │ -    │ -    │ 启用  │  │
│ │ TRX  │ TRX  │ 固定费用 │ 10 TRX      │ -    │ -    │ 启用  │  │
│ │ ETH  │ USDT │ 百分比   │ 0.1%        │ 5    │ 100  │ 启用  │  │
│ │ ETH  │ ETH  │ 动态Gas  │ Gas * 1.5   │ -    │ -    │ 启用  │  │
│ │ BSC  │ USDT │ 固定费用 │ 1 USDT      │ -    │ -    │ 启用  │  │
│                                                                  │
│ [+ 添加费率规则]                                                 │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

**费率类型说明**:
| 类型 | 说明 | 计算方式 |
|------|------|----------|
| 固定费用 | 固定金额 | 手续费 = 固定值 |
| 百分比 | 按比例收取 | 手续费 = 金额 × 费率 |
| 动态Gas | 根据 Gas 计算 | 手续费 = Gas × 系数 |

---

### 5. 限额配置

**功能描述**: 配置交易限额规则

**用户角色**: Admin

**页面路径**: `/admin/settings` → 限额配置

#### 5.1 限额规则

**限额配置表**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 交易限额配置                                           [保存]    │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ 充值限额                                                        │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │ 最低充值金额: [10] USDT (或等值其他币种)                     │ │
│ │ 单笔最高:     [无限制  ]                                     │ │
│ │ 日限额:       [无限制  ]                                     │ │
│ └──────────────────────────────────────────────────────────────┘ │
│                                                                  │
│ 提现限额                                                        │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │ 最低提现金额: [10] USDT (或等值)                             │ │
│ │ 单笔最高:     [50000] USDT                                   │ │
│ │ 日限额:       [100000] USDT                                  │ │
│ │ 免审批阈值:   [1000] USDT (关联地址)                        │ │
│ └──────────────────────────────────────────────────────────────┘ │
│                                                                  │
│ 划转限额                                                        │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │ 最低转账金额: [1] USDT                                       │ │
│ │ 单笔最高:     [100000] USDT                                  │ │
│ │ 日限额:       [无限制  ]                                     │ │
│ └──────────────────────────────────────────────────────────────┘ │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

---

### 6. 审计日志

**功能描述**: 查看系统操作审计日志

**用户角色**: Admin（完整访问）/ Finance（只读）

**页面路径**: `/admin/settings` → 审计日志

#### 6.1 审计日志列表

**UI 组件**:
- **Table**: 日志列表
- **DatePicker**: 日期筛选
- **Select**: 操作类型筛选

**筛选条件**:
| 字段 | 组件 | 说明 |
|------|------|------|
| 日期范围 | RangePicker | 操作时间 |
| 操作人 | Select | 筛选操作人 |
| 操作类型 | Select | 用户管理/审批/配置... |
| 操作对象 | Input | 对象 ID 搜索 |

**审计日志表格**:
| 列名 | 字段 | 说明 |
|------|------|------|
| 时间 | created_at | 操作时间 |
| 操作人 | operator | 操作者信息 |
| 操作类型 | action_type | 操作分类 |
| 操作描述 | description | 操作说明 |
| 对象类型 | target_type | 操作对象类型 |
| 对象ID | target_id | 操作对象标识 |
| IP 地址 | client_ip | 客户端 IP |
| 详情 | - | 查看详情 |

**操作类型分类**:
| 类型 | 说明 |
|------|------|
| USER_FREEZE | 用户冻结 |
| USER_UNFREEZE | 用户解冻 |
| USER_TERMINATE | 离职处理 |
| WITHDRAWAL_APPROVE | 提现通过 |
| WITHDRAWAL_REJECT | 提现驳回 |
| PAYROLL_CREATE | 创建薪资批次 |
| PAYROLL_APPROVE | 审批薪资 |
| VAULT_ADJUST | Vault 调整 |
| CONFIG_UPDATE | 配置修改 |
| ROLE_UPDATE | 角色权限修改 |

#### 6.2 日志详情

**日志详情抽屉**:
```
┌────────────────────────────────────────┐
│  操作详情                         [×]  │
├────────────────────────────────────────┤
│                                        │
│  基本信息                              │
│  ┌──────────────────────────────────┐  │
│  │ 操作时间:   2025-12-10 14:30:00  │  │
│  │ 操作人:     admin@company.com    │  │
│  │ 操作类型:   USER_FREEZE          │  │
│  │ 操作描述:   冻结用户账户          │  │
│  │ IP 地址:    192.168.1.100        │  │
│  │ User Agent: Chrome/120.0         │  │
│  └──────────────────────────────────┘  │
│                                        │
│  操作对象                              │
│  ┌──────────────────────────────────┐  │
│  │ 对象类型:   用户                  │  │
│  │ 对象ID:     10001                │  │
│  │ 对象名称:   user@example.com     │  │
│  └──────────────────────────────────┘  │
│                                        │
│  变更内容                              │
│  ┌──────────────────────────────────┐  │
│  │ 字段        │ 变更前  │ 变更后   │  │
│  │ status      │ active  │ frozen   │  │
│  │ freeze_reason│ -      │ 异常行为 │  │
│  └──────────────────────────────────┘  │
│                                        │
└────────────────────────────────────────┘
```

---

## UI 组件列表

| 组件名称 | 类型 | 功能说明 |
|----------|------|----------|
| SettingsMenu | Menu | 设置页面左侧菜单 |
| RoleTable | Table | 角色列表表格 |
| PermissionMatrix | Table | 权限矩阵表格 |
| RoleModal | Modal | 角色配置对话框 |
| TokenTable | Table | Token 配置表格 |
| ChainTable | Table | 链配置表格 |
| AlertRuleTable | Table | 告警规则表格 |
| AlertRuleModal | Modal | 告警规则配置对话框 |
| FeeConfigTable | Table | 手续费配置表格 |
| LimitConfigForm | Form | 限额配置表单 |
| AuditLogTable | Table | 审计日志表格 |
| AuditDetailDrawer | Drawer | 日志详情抽屉 |

---

## 状态与交互

### 用户操作响应

| 操作 | 成功响应 | 失败响应 |
|------|----------|----------|
| 保存角色 | Toast "角色保存成功" | Alert 显示错误 |
| 保存配置 | Toast "配置已保存" | Alert 显示错误 |
| 添加告警规则 | Toast "告警规则已添加" | Alert 显示错误 |

---

## 权限控制

| 功能 | Admin | Finance |
|------|-------|---------|
| 角色权限管理 | ✓ | - |
| Token/链配置 | ✓ | - |
| 告警设置 | ✓ | - |
| 手续费配置 | ✓ | - |
| 限额配置 | ✓ | - |
| 查看审计日志 | ✓ | ✓（只读） |

---

## 配置变更追踪

所有系统配置变更均记录审计日志：
- 变更时间
- 变更人
- 变更前后值对比
- 变更原因（可选）

---

> 返回 [后台管理前端目录](./README.md)
