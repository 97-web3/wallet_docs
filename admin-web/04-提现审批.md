# 出金审批

> 返回 [后台管理前端目录](./README.md)

---

## 页面概述

- **页面路径**: `/admin/withdrawals`
- **权限要求**: Admin 或 Finance 角色
- **主要功能**: 出金（提现/转账）申请审批、风险评估查看、批量处理、驳回管理、审批配置

---

## 页面布局

### 审批列表页面结构

```
┌──────────────────────────────────────────────────────────────────────────┐
│  Header                                                                   │
├──────────┬───────────────────────────────────────────────────────────────┤
│          │  Breadcrumb: 首页 / 出金审批                                    │
│  Sidebar ├───────────────────────────────────────────────────────────────┤
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ Tab 切换                                    [审批配置]    │ │
│          │  │ [提现审批 ●2] [转账审批 ●1]  (徽章显示待审核数量)         │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ 审核配置状态卡片（2列布局）                               │ │
│          │  │ ┌──────────────────────┐ ┌──────────────────────┐        │ │
│          │  │ │ 提现审核             │ │ 转账审核             │        │ │
│          │  │ │ 阈值: ≥10,000 USDT  │ │ 阈值: ≥5,000 USDT   │        │ │
│          │  │ │ [已启用] 蓝色渐变   │ │ [已启用] 紫色渐变   │        │ │
│          │  │ └──────────────────────┘ └──────────────────────┘        │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ 统计卡片                                                  │ │
│          │  │ [待审批: 15]  [今日通过: 32]  [今日驳回: 3]  [超时: 2]    │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ 筛选区域                                                  │ │
│          │  │ [状态▼] [链▼] [员工▼] [金额范围] [日期范围] [🔍] [重置]  │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ 操作栏                           [批量通过] [批量驳回]     │ │
│          │  ├──────────────────────────────────────────────────────────┤ │
│          │  │ □ │ID    │用户UID│身份│金额      │链 │状态  │风险│SLA│操作│ │
│          │  ├───┼──────┼───────┼────┼──────────┼───┼──────┼────┼───┼────┤ │
│          │  │ □ │W00123│10001  │员工│5,000 USDT│TRX│待审批│低  │2h │[审]│ │
│          │  │ □ │W00124│10002  │普通│50,000USDT│ETH│待审批│高  │12h│[审]│ │
│          │  │ □ │W00125│10003  │员工│1,000 USDT│BSC│已通过│-   │-  │[查]│ │
│          │  │ ...                                                       │ │
│          │  ├──────────────────────────────────────────────────────────┤ │
│          │  │                    < 1 2 3 4 5 ... 10 >                   │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
└──────────┴───────────────────────────────────────────────────────────────┘
```

### 审批详情抽屉结构

```
┌────────────────────────────────────────┐
│  提现审批详情                     [×]  │
├────────────────────────────────────────┤
│                                        │
│  申请信息                              │
│  ┌──────────────────────────────────┐  │
│  │ 申请ID:     W00123               │  │
│  │ 申请时间:   2025-12-10 10:30:00  │  │
│  │ 提现金额:   5,000.00 USDT        │  │
│  │ 手续费:     2.00 USDT            │  │
│  │ 实际到账:   4,998.00 USDT        │  │
│  │ 链:         TRX                  │  │
│  │ 目标地址:   T9yD14N...Ww         │  │
│  │ SLA 状态:   正常 (剩余 22h)      │  │
│  └──────────────────────────────────┘  │
│                                        │
│  用户信息                              │
│  ┌──────────────────────────────────┐  │
│  │ UID:        10001                │  │
│  │ 手机号:     138****1234          │  │
│  │ 身份:       员工                  │  │
│  │ 账户状态:   正常                  │  │
│  │ Web2 余额:  10,000 USDT          │  │
│  │ 历史提现:   50 笔 / $200,000     │  │
│  └──────────────────────────────────┘  │
│                                        │
│  风险评估                              │
│  ┌──────────────────────────────────┐  │
│  │ 风险等级:   低风险 🟢            │  │
│  │                                  │  │
│  │ 地址检查:   非黑名单 ✓           │  │
│  │ 金额检查:   正常范围 ✓           │  │
│  │ 频率检查:   正常 ✓               │  │
│  │                                  │  │
│  │ 关联地址:   是 (免审批)          │  │
│  └──────────────────────────────────┘  │
│                                        │
│  审批操作                              │
│  ┌──────────────────────────────────┐  │
│  │ [驳 回]              [通 过]     │  │
│  └──────────────────────────────────┘  │
│                                        │
└────────────────────────────────────────┘
```

---

## 功能模块

### 1. 统计概览

**功能描述**: 显示提现审批相关的关键统计数据

**用户角色**: Admin / Finance

**UI 组件**:

- **StatisticCard**: 统计卡片组件

**统计项**:
| 统计项 | 说明 | 样式 |
|--------|------|------|
| 待审核 | 当前待处理的申请数量 | 黄色 |
| 已通过 | 已通过的申请数量 | 绿色 |
| 已拒绝 | 已拒绝的申请数量 | 红色 |
| 超时未处理 | 超过 SLA 时间的待审批数量 | 橙色 |

**交互说明**:

- 点击统计卡片可快速筛选对应状态的列表

---

### 2. 提现列表筛选

**功能描述**: 多条件筛选提现申请

**用户角色**: Admin / Finance

**UI 组件**:

- **Select**: 状态、链筛选
- **RangePicker**: 金额范围、日期范围
- **Input**: 申请 ID / 用户 UID 搜索
- **Button**: 搜索、重置

**筛选条件**:
| 字段 | 组件类型 | 选项/说明 |
|------|----------|-----------|
| 状态 | Select | 全部、待审批、已通过、已驳回、处理中 |
| 链 | Select | 全部、TRX、ETH、BSC、Polygon |
| 用户身份 | ButtonGroup | 全部、仅员工、非员工（按钮组高亮选中） |
| 金额范围 | InputNumber | 最小金额、最大金额 |
| 日期范围 | DatePicker.RangePicker | 申请时间范围 |
| 风险等级 | Select | 全部、低、中、高 |
| 首次使用地址 | Select | 全部、是（首次）、否 |
| 地址标签/来源 | Select | 全部、内部白名单、企业白名单、第三方高风险、用户关联 |
| KYC 状态 | Select | 全部、已通过、未通过、待验证 |
| 关键词 | Input | 申请 ID 或用户 UID |

**员工筛选按钮组样式**:
| 选项 | 选中颜色 |
|------|----------|
| 全部 | 蓝色 |
| 仅员工 | 绿色 |
| 非员工 | 灰色 |

**记录数量统计**:

- 位置：筛选区域右侧
- 格式：「共 X 条记录」
- 实时更新：筛选条件变化后自动更新

---

### 3. 提现列表展示

**功能描述**: 以表格形式展示提现申请列表

**用户角色**: Admin / Finance

**UI 组件**:

- **Table**: 数据表格
- **Tag**: 状态、风险标签
- **Progress**: SLA 进度条

**表格列定义**:
| 列名 | 字段 | 宽度 | 说明 |
|------|------|------|------|
| 选择 | - | 50px | 复选框（仅待审批状态可选） |
| 申请 ID | request_id | 100px | 提现申请唯一标识 |
| 用户 UID | user_id | 100px | 申请用户（如 U10001） |
| 姓名 | name | 80px | 用户姓名 |
| 手机号 | phone | 120px | 脱敏显示（如 138\*\*\*\*5678） |
| 是否员工 | is_employee | 80px | 是/否 |
| 币种 | currency | 80px | 币种（USDT/ETH 等，链接样式） |
| 金额 | amount | 100px | 提现金额 |
| 链 | chain | 60px | 区块链网络 |
| 目标地址 | to_address | 150px | 脱敏显示 |
| 申请时间 | created_at | 150px | 申请提交时间 |
| 状态 | status | 80px | 状态标签 |
| 风险等级 | risk_level | 80px | 风险标签 |
| SLA | sla_remaining | 80px | 剩余处理时间 |
| 操作 | - | 120px | 通过、拒绝按钮 |

**状态标签**:
| 状态 | 颜色 | 说明 |
|------|------|------|
| pending | 蓝色 | 待审批 |
| approved | 绿色 | 已通过 |
| rejected | 红色 | 已驳回 |
| processing | 黄色 | 处理中（链上确认中） |
| completed | 灰色 | 已完成 |
| failed | 红色 | 失败 |

**风险等级标签**:
| 等级 | 颜色 | 说明 |
|------|------|------|
| low | 绿色 | 低风险 |
| medium | 黄色 | 中风险 |
| high | 红色 | 高风险 |

**SLA 显示规则**:
| 状态 | 显示 |
|------|------|
| 剩余 > 12h | 绿色文字 |
| 剩余 4-12h | 黄色文字 |
| 剩余 < 4h | 红色文字 |
| 已超时 | 红色 "已超时" |

---

### 4. 提现审批详情

**功能描述**: 查看提现申请完整信息并进行审批操作

**用户角色**: Admin / Finance

**UI 组件**:

- **Drawer**: 抽屉容器
- **Descriptions**: 信息描述列表
- **Alert**: 风险提示
- **Button**: 审批操作按钮

#### 4.1 申请信息区

| 字段     | 说明                                                               |
| -------- | ------------------------------------------------------------------ |
| 申请 ID  | 提现申请唯一标识                                                   |
| 申请时间 | 用户提交申请的时间                                                 |
| 提现金额 | 用户申请的提现金额                                                 |
| 手续费   | 平台收取的手续费                                                   |
| 实际到账 | 用户实际收到的金额                                                 |
| 链       | 提现的区块链网络                                                   |
| 目标地址 | 接收地址（可点击复制）                                             |
| 地址校验 | 地址按网络规则校验（见《[地址与校验规范](./98-地址校验规范.md)》） |
| SLA 状态 | 处理时限状态                                                       |

#### 4.2 用户信息区

| 字段      | 说明               |
| --------- | ------------------ |
| UID       | 用户唯一标识       |
| 手机号    | 脱敏显示           |
| 身份      | 员工/非员工        |
| 账户状态  | 正常/冻结          |
| Web2 余额 | 当前 Web2 钱包余额 |
| 历史提现  | 历史提现统计       |

#### 4.3 风险评估区

**风险检查项**:
| 检查项 | 说明 | 结果显示 |
|--------|------|----------|
| 地址检查 | 目标地址黑名单检查 | ✓ 非黑名单 / ✗ 黑名单 |
| 金额检查 | 单笔金额限制检查 | ✓ 正常 / ⚠ 超限 |
| 频率检查 | 提现频率检查 | ✓ 正常 / ⚠ 频繁 |
| 关联地址 | 是否为用户关联的 Web3 地址 | 是（免审批）/ 否 |
| 首次使用地址 | 目标地址是否为该用户首次提现使用 | 是/否 |
| 地址标签/来源 | 地址标签和来源 | 显示标签（如：企业白名单、第三方高风险） |

**风险等级计算**:

- 低风险：所有检查通过
- 中风险：存在 1-2 项警告
- 高风险：存在未通过项或多项警告

---

### 5. 审批操作

**功能描述**: 对提现申请进行通过或驳回操作

**用户角色**: Admin / Finance

#### 5.1 通过审批

**触发方式**: 点击「通过」按钮

**确认对话框**:

```
┌────────────────────────────────────────┐
│  确认通过                         [×]  │
├────────────────────────────────────────┤
│                                        │
│  确定通过此提现申请吗？                │
│                                        │
│  申请ID:    W00123                     │
│  金额:      5,000.00 USDT              │
│  目标地址:  T9yD14N...Ww               │
│                                        │
│  通过后将立即执行链上转账操作          │
│                                        │
│         [取消]    [确认通过]           │
│                                        │
└────────────────────────────────────────┘
```

#### 5.2 驳回审批

**触发方式**: 点击「驳回」按钮

**驳回对话框**:

```
┌────────────────────────────────────────┐
│  驳回申请                         [×]  │
├────────────────────────────────────────┤
│                                        │
│  请选择驳回原因 *                      │
│                                        │
│  [○ 目标地址异常                      ]│
│  [○ 金额超出限制                      ]│
│  [○ 用户信息不符                      ]│
│  [○ 其他原因                          ]│
│                                        │
│  补充说明                              │
│  [________________________]            │
│  [________________________]            │
│                                        │
│  驳回后资金将退回用户 Web2 钱包        │
│                                        │
│         [取消]    [确认驳回]           │
│                                        │
└────────────────────────────────────────┘

---

### 5.3 Maker-Checker（审批人-执行人制度）

**目标**: 强制“发起人”和“审批人/执行人”角色分离，按风险/金额分级，降低单点误操作风险。

**规则**:
- 发起人不可审批或执行自己发起的提现/转账。
- 金额分级：
  - < $1,000：单人审批（审批人≠发起人）
  - $1,000 – $10,000：双人审批（两名不同审批人，均≠发起人）
  - > $10,000 或高风险/首次使用地址：双人审批 + 二次确认（输入一次性校验码）。
- 角色范围：Finance 可发起/初审；Admin 终审与执行。

**UI 体现**:
- 列表及详情显示“发起人”“已审批人”“待审批人名单”，以及“仍需审批数”。
- 通过按钮在审批不足时为灰色并显示缺少的审批条件提示。
- 已满足审批条件后，显示“执行转账”按钮（仅对执行角色可见）。

**审计**:
- 记录每一步审批的时间、审批人、备注、IP、User Agent。
- 导出审批链路（CSV/Excel）用于合规审计。

---

### 5.4 执行与链上控制（Gas/Nonce/加速/取消）

**执行前预检**:
- 估算 Gas 费用与成功率提示（依据当前 mempool 和链上费率）。
- 显示“预计手续费区间”“预计确认时间”。

**可控参数（在策略范围内）**:
- Gas 策略：标准/快速/自定义（不超过系统策略上限）。
- Gas Price/Gas Limit 调整（带边界提示）。
- Nonce 显示与冲突检测（仅显示、不可任意越序）。

**卡住交易处理（Stuck-TX）**:
- 支持“加速（Replace by Fee）”“取消（Replace with 0-value to self）”操作，受权限与策略约束。
- 显示当前交易状态：pending/打包失败/替换中，及替换历史。

**审计**:
- 记录执行参数（gas、nonce、策略）、操作者与时间。

---
```

**驳回原因码**:
| 原因码 | 说明 | 用户提示 |
|--------|------|----------|
| ADDRESS_RISK | 目标地址异常 | 提现地址存在风险，请更换地址后重试 |
| AMOUNT_EXCEEDED | 金额超出限制 | 提现金额超出当前限额 |
| USER_INFO_MISMATCH | 用户信息不符 | 请联系客服核实身份信息 |
| OTHER | 其他原因 | 根据补充说明显示 |

---

### 6. 批量审批

**功能描述**: 对多笔提现申请进行批量操作

**用户角色**: Admin / Finance

**UI 组件**:

- **Checkbox**: 列表选择
- **Button**: 批量通过、批量驳回

**操作流程**:

1. 勾选待审批的申请（仅 pending 状态可选）
2. 点击「批量通过」或「批量驳回」
3. 弹出确认对话框
4. 确认后批量处理
5. 显示处理结果（成功 X 笔，失败 X 笔）

**批量通过确认**:

```
┌────────────────────────────────────────┐
│  批量通过                         [×]  │
├────────────────────────────────────────┤
│                                        │
│  确定批量通过以下 5 笔提现申请吗？     │
│                                        │
│  总金额: 25,000.00 USDT               │
│                                        │
│  ⚠️ 其中 1 笔为高风险交易              │
│                                        │
│         [取消]    [确认通过]           │
│                                        │
└────────────────────────────────────────┘
```

**批量驳回**:

- 需选择统一的驳回原因
- 可添加批量驳回说明

---

## UI 组件列表

| 组件名称          | 类型   | 功能说明       |
| ----------------- | ------ | -------------- |
| WithdrawalStats   | Card   | 统计概览卡片   |
| WithdrawalFilter  | Form   | 筛选表单       |
| WithdrawalTable   | Table  | 提现列表表格   |
| WithdrawalDrawer  | Drawer | 审批详情抽屉   |
| RiskAssessment    | Card   | 风险评估展示   |
| ApproveModal      | Modal  | 通过确认对话框 |
| RejectModal       | Modal  | 驳回对话框     |
| BatchApproveModal | Modal  | 批量通过对话框 |
| BatchRejectModal  | Modal  | 批量驳回对话框 |
| SLAIndicator      | Custom | SLA 状态指示器 |
| RiskTag           | Tag    | 风险等级标签   |

---

## 状态与交互

### 页面状态

| 状态       | 描述       | UI 表现                        |
| ---------- | ---------- | ------------------------------ |
| Loading    | 列表加载中 | 显示表格骨架屏                 |
| Empty      | 无数据     | 显示空状态                     |
| Selected   | 已选择申请 | 显示选中数量，激活批量操作按钮 |
| Processing | 审批处理中 | 按钮显示 Loading               |

### 实时更新

- 新提现申请实时推送到列表
- SLA 倒计时实时更新
- 审批状态变更实时同步

### 用户操作响应

| 操作     | 成功响应                                 | 失败响应           |
| -------- | ---------------------------------------- | ------------------ |
| 通过审批 | Toast "审批通过，正在执行转账"，刷新列表 | Alert 显示错误原因 |
| 驳回审批 | Toast "已驳回，资金已退回"，刷新列表     | Alert 显示错误原因 |
| 批量通过 | Toast "批量通过完成，成功 X 笔"          | Alert 显示失败详情 |
| 批量驳回 | Toast "批量驳回完成"                     | Alert 显示失败详情 |

---

## 权限控制

| 功能          | Admin | Finance |
| ------------- | ----- | ------- |
| 查看提现列表  | ✓     | ✓       |
| 查看审批详情  | ✓     | ✓       |
| 通过/驳回审批 | ✓     | ✓       |
| 批量审批      | ✓     | ✓       |
| 修改审批阈值  | ✓     | -       |

---

## 审批规则提示

### 自动免审批条件

以下情况的提现申请自动通过，无需人工审批：

1. 目标地址为用户关联的 Web3 地址
2. 金额在自动审批阈值以下（可配置）

### 需人工审批条件

以下情况需要人工审批：

1. 高风险评级
2. 大额提现（超过自动审批阈值）
3. 目标地址首次使用

---

## 转账审批 Tab

**功能描述**: 审批用户间的内部转账申请

**触发方式**: 点击页面顶部的「转账审批」Tab

### 转账审批列表

与提现审批列表类似，但包含额外字段：

| 列名         | 字段   | 说明           |
| ------------ | ------ | -------------- |
| 转入用户 UID | toUid  | 接收转账的用户 |
| 转入用户     | toName | 接收用户名称   |

### 转账详情抽屉

**额外显示内容**:

```
┌──────────────────────────────────┐
│ 转入用户信息                     │
│ ┌──────────────────────────────┐ │
│ │ 用户UID:    10002            │ │
│ │ 用户名称:   张三              │ │
│ │ 手机号:     139****5678      │ │
│ │ 身份:       员工              │ │
│ └──────────────────────────────┘ │
└──────────────────────────────────┘
```

---

## 审批配置

**功能描述**: 配置提现和转账的审批规则

**触发方式**: 点击页面右上角的「审批配置」按钮

**权限要求**: 仅 Admin 角色可修改

### 审批配置对话框

```
┌────────────────────────────────────────────────────────────────┐
│  审批配置                                                  [×]  │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  提现审批设置                                                  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 审批开关                                                 │  │
│  │ [  开启  ●━━━━━━━○  关闭（紧急模式） ]                 │  │
│  │                                                          │  │
│  │ 审批阈值 (关闭审批时生效)                                │  │
│  │ 单笔金额超过 [________] USDT 时需要审批                  │  │
│  │                                                          │  │
│  │ ⚠️ 关闭审批（紧急模式）须满足：                         │  │
│  │ • 超级管理员身份 + 二次校验码                           │  │
│  │ • 至少两名不同管理员共同确认（多重批准）                │  │
│  │ • 自动设置短时限 TTL（默认 30 分钟）到期自动恢复        │  │
│  │ • 填写原因并生成不可修改的审计记录与系统横幅提醒        │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│  转账审批设置                                                  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 审批开关                                                 │  │
│  │ [  开启  ●━━━━━━━○  关闭  ]                             │  │
│  │                                                          │  │
│  │ 审批阈值 (关闭审批时生效)                                │  │
│  │ 单笔金额超过 [________] USDT 时需要审批                  │  │
│  │                                                          │  │
│  │ 员工免审批                                               │  │
│  │ [✓] 员工间转账免审批                                     │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│         [取消]    [保存配置]                                   │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### 审批配置字段

| 字段                        | 类型    | 说明                 |
| --------------------------- | ------- | -------------------- |
| withdrawalApprovalEnabled   | boolean | 提现审批开关         |
| withdrawalThreshold         | number  | 提现审批阈值(USDT)   |
| transferApprovalEnabled     | boolean | 转账审批开关         |
| transferThreshold           | number  | 转账审批阈值(USDT)   |
| employeeTransferExempt      | boolean | 员工间转账免审批     |
| breakGlassTTLMinutes        | number  | 紧急模式 TTL（分钟） |
| breakGlassRequiredApprovals | number  | 紧急模式最少批准数   |
| maxGasStrategy              | enum    | 允许的最大 Gas 策略  |

### 配置注意事项

| 注意事项     | 说明                                       |
| ------------ | ------------------------------------------ |
| 关闭审批开关 | 该类型的所有申请将自动通过，无需人工审核   |
| 阈值设置为 0 | 所有金额都需要审核                         |
| 金额换算     | 以实时汇率折合为 USDT 进行比较             |
| 紧急模式     | 仅限紧急处置，启用期间全局展示黄色横幅提示 |

---

## 审批数据导出

**导出范围**:

- 导出“筛选后的集合”（保持当前筛选条件与时间范围）。
- 导出“全部数据”（受最大导出条数限制）。

**导出字段（示例）**:

- 申请 ID、用户 UID、币种、金额、链、目标地址、创建时间、状态、风险等级、首用地址、地址标签/来源、审批链条（发起人/审批人/执行人/时间）、执行参数（gas/nonce）。

**权限**: Admin、Finance（可下载各自可见范围）。

---

## 排序与分页（表格统一规范）

**排序字段**: 申请时间、金额、状态、风险等级、SLA 剩余、UID。

**分页**: 支持总数显示、每页大小选择（20/50/100）、跨页选择批量操作、记住每用户偏好。

---

## 费用展示与一致性

- 审批详情显示当前生效的手续费方案（来源：系统设置 → 手续费配置）。
- 当策略允许时，可在限定范围内临时覆盖（需记录原因与审批）。
- 链接到设置页快速查看费率规则。

## 页面底部提示

**提现审核规则**:

列表底部显示当前生效的审核规则提示：

> 当提现金额（折合 USDT）≥ 10,000 时，需要管理员审核通过后才能完成提现。

---

> 返回 [后台管理前端目录](./README.md)
