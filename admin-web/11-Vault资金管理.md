# Vault 资金管理

> 返回 [后台管理前端目录](./README.md)

---

## 页面概述

- **页面路径**: `/admin/vault`
- **权限要求**: Admin 或 Finance 角色
- **主要功能**: 多网络钱包管理、币种余额监控、预警阈值配置、钱包地址启用/禁用

---

## 数据模型

### 钱包地址

```typescript
interface WalletAddress {
  id: string;                // 钱包ID
  address: string;           // 钱包地址
  isActive: boolean;         // 是否为活跃钱包（当前使用中）
  addedAt: string;           // 添加时间
}
```

### 币种余额

```typescript
interface CurrencyBalance {
  currency: string;          // 币种: ETH, USDT, USDC, BNB, TRX, MATIC
  balance: number;           // 当前余额
  threshold: number;         // 预警阈值
  alertRole: string;         // 预警通知角色: 管理员/财务
  usdtRate: number;          // USDT 汇率（用于价值换算）
}
```

### 网络钱包

```typescript
interface NetworkWallets {
  network: string;           // 网络: ETH, BSC, TRON, Polygon
  wallets: WalletAddress[];  // 钱包地址列表
  balances: CurrencyBalance[]; // 各币种余额
}
```

---

## 页面布局

### Vault 管理主页面结构

```
┌──────────────────────────────────────────────────────────────────────────┐
│  Header                                                                   │
├──────────┬───────────────────────────────────────────────────────────────┤
│          │  Breadcrumb: 首页 / Vault 资金管理                             │
│  Sidebar ├───────────────────────────────────────────────────────────────┤
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ 总资产统计                                                │ │
│          │  │ 总资产: $1,250,000 USDT          覆盖网络: 4              │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ 网络: Ethereum (ETH)                                      │ │
│          │  │ 钱包总额: 350,000 USDT                    [添加地址]      │ │
│          │  ├──────────────────────────────────────────────────────────┤ │
│          │  │ ✓ 0x1234...5678   2025-01-01   当前使用中                │ │
│          │  │ ▼ 未启用钱包 (2个)                                        │ │
│          │  │   ├ 0xabcd...efgh  2025-02-01  [启用] [删除]             │ │
│          │  │   └ 0x9876...5432  2025-03-01  [启用] [删除]             │ │
│          │  ├──────────────────────────────────────────────────────────┤ │
│          │  │ │币种 │余额        │预警阈值  │预警角色│状态    │操作   │ │
│          │  │ │ETH  │50.00       │10 ETH    │管理员  │正常    │[配置] │ │
│          │  │ │USDT │300,000.00  │50,000    │财务    │正常    │[配置] │ │
│          │  │ │USDC │50,000.00   │10,000    │财务    │正常    │[配置] │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ 网络: BNB Smart Chain (BSC)                               │ │
│          │  │ 钱包总额: 200,000 USDT                    [添加地址]      │ │
│          │  │ ...                                                       │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  (更多网络: TRON, Polygon...)                                 │
│          │                                                                │
└──────────┴───────────────────────────────────────────────────────────────┘
```

---

## 功能模块

### 1. 总资产统计

**功能描述**: 显示所有 Vault 的总资产概览

**用户角色**: Admin / Finance

**UI 组件**:
- **StatisticCard**: 统计卡片

**统计项**:

| 统计项 | 说明 |
|--------|------|
| 总资产 | 所有钱包总资产（USDT 计价） |
| 覆盖网络 | 支持的区块链网络数量 |

---

### 2. 多网络钱包管理

**功能描述**: 管理各网络的 Vault 钱包地址

**用户角色**: Admin / Finance

**UI 组件**:
- **Card**: 网络卡片容器
- **Table**: 钱包和余额表格
- **Collapse**: 可折叠的未启用钱包列表
- **Button**: 添加、启用、删除按钮

#### 2.1 网络卡片布局

每个支持的网络显示为一个独立卡片，包含：

| 区域 | 内容 |
|------|------|
| 标题行 | 网络名称、钱包总额（USDT 计价）、添加地址按钮 |
| 活跃钱包 | 当前使用中的钱包地址（绿色背景高亮） |
| 未启用钱包 | 可折叠的钱包列表，显示启用/删除操作 |
| 币种余额 | 各币种余额、预警阈值、状态 |

#### 2.2 钱包状态规则

| 状态 | 说明 | 背景色 |
|------|------|--------|
| 活跃 | 当前使用中的钱包 | 浅绿色 |
| 未启用 | 备用钱包 | 白色 |

**业务规则**:
- 同一网络只能有一个活跃钱包
- 启用钱包时自动禁用该网络下的其他钱包
- 不能删除当前活跃的钱包

---

### 3. 钱包地址操作

**功能描述**: 添加、启用、删除钱包地址

**用户角色**: Admin / Finance

#### 3.1 添加钱包地址

**触发方式**: 点击「添加地址」按钮

**添加钱包对话框**:
```
┌────────────────────────────────────────┐
│  添加钱包地址                      [×]  │
├────────────────────────────────────────┤
│                                        │
│  选择网络 *                            │
│  [Ethereum        ▼]                  │
│                                        │
│  钱包地址 *                            │
│  [0x________________________]         │
│                                        │
│  ⚠️ 提示:                              │
│  • 新添加的钱包默认处于不活跃状态      │
│  • 需要手动启用后才能使用              │
│  • 同一网络只能有一个活跃地址          │
│                                        │
│         [取消]    [添加]               │
│                                        │
└────────────────────────────────────────┘
```

#### 3.2 启用钱包

**触发方式**: 点击未启用钱包行的「启用」按钮

**确认对话框**:
```
┌────────────────────────────────────────┐
│  启用钱包                          [×]  │
├────────────────────────────────────────┤
│                                        │
│  确定要启用此钱包吗？                  │
│                                        │
│  网络:   Ethereum                      │
│  地址:   0xabcd...efgh                 │
│                                        │
│  ⚠️ 启用后：                           │
│  • 当前活跃钱包将被自动禁用            │
│  • 新的交易将使用此钱包                │
│                                        │
│         [取消]    [确认启用]           │
│                                        │
└────────────────────────────────────────┘
```

#### 3.3 删除钱包

**触发方式**: 点击未启用钱包行的「删除」按钮

**确认对话框**:
```
┌────────────────────────────────────────┐
│  删除钱包                          [×]  │
├────────────────────────────────────────┤
│                                        │
│  确定要删除此钱包吗？                  │
│                                        │
│  网络:   Ethereum                      │
│  地址:   0x9876...5432                 │
│                                        │
│  删除后无法恢复                        │
│                                        │
│         [取消]    [确认删除]           │
│                                        │
└────────────────────────────────────────┘
```

**删除限制**:
- 活跃钱包不可删除
- 删除前需确认钱包余额为 0

---

### 4. 币种余额管理

**功能描述**: 查看各币种余额并配置预警阈值

**用户角色**: Admin / Finance

**UI 组件**:
- **Table**: 余额表格
- **Badge**: 状态徽章
- **Modal**: 配置对话框

#### 4.1 余额表格

| 列名 | 字段 | 说明 |
|------|------|------|
| 币种 | currency | ETH, USDT, USDC 等 |
| 余额 | balance | 当前余额 |
| USDT 价值 | usdtValue | 换算后的 USDT 价值 |
| 预警阈值 | threshold | 低于此值触发预警 |
| 预警角色 | alertRole | 管理员/财务 |
| 状态 | status | 正常/余额不足 |
| 操作 | - | 配置按钮 |

#### 4.2 状态显示规则

| 状态 | 条件 | 标签颜色 |
|------|------|----------|
| 正常 | 余额 ≥ 预警阈值 | 绿色 |
| 余额不足 | 余额 < 预警阈值 | 红色 |

#### 4.3 预警配置

**触发方式**: 点击币种行的「配置」按钮

**配置对话框**:
```
┌────────────────────────────────────────┐
│  预警配置 - ETH (Ethereum)         [×]  │
├────────────────────────────────────────┤
│                                        │
│  当前余额: 50.00 ETH                   │
│                                        │
│  预警阈值 *                            │
│  [________________] ETH                │
│                                        │
│  预警通知角色 *                        │
│  [○ 管理员]  [○ 财务]  [○ 全部]       │
│                                        │
│  通知方式                              │
│  [✓] 站内消息  [✓] 邮件  [ ] 短信     │
│                                        │
│         [取消]    [保存]               │
│                                        │
└────────────────────────────────────────┘
```

---

## UI 组件列表

| 组件名称 | 类型 | 功能说明 |
|----------|------|----------|
| VaultStats | Card | 总资产统计卡片 |
| NetworkCard | Card | 网络 Vault 卡片 |
| ActiveWalletRow | Custom | 活跃钱包行（高亮） |
| InactiveWalletList | Collapse | 未启用钱包折叠列表 |
| BalanceTable | Table | 币种余额表格 |
| AddWalletModal | Modal | 添加钱包对话框 |
| EnableWalletModal | Modal | 启用钱包确认框 |
| DeleteWalletModal | Modal | 删除钱包确认框 |
| ThresholdConfigModal | Modal | 预警配置对话框 |
| StatusBadge | Badge | 状态徽章 |
| CopyAddress | Button | 地址复制按钮 |

---

## 状态与交互

### 页面状态

| 状态 | 描述 | UI 表现 |
|------|------|---------|
| Loading | 数据加载中 | 显示骨架屏 |
| Error | 加载失败 | 显示错误提示和重试按钮 |
| Warning | 存在余额不足 | 对应行显示红色警告 |
| Normal | 所有余额正常 | 正常显示 |

### 用户操作响应

| 操作 | 成功响应 | 失败响应 |
|------|----------|----------|
| 添加钱包 | Toast "钱包添加成功"，刷新列表 | Alert 显示错误原因 |
| 启用钱包 | Toast "钱包已启用"，刷新列表 | Alert 显示错误原因 |
| 删除钱包 | Toast "钱包已删除"，刷新列表 | Alert 显示错误原因 |
| 保存配置 | Toast "配置已保存" | Alert 显示错误原因 |

---

## 支持的网络和币种

### 支持网络

| 网络 | 标识 | 图标 |
|------|------|------|
| Ethereum | ETH | 🔷 |
| BNB Smart Chain | BSC | 🟡 |
| Tron | TRON | 🔴 |
| Polygon | MATIC | 🟣 |

### 支持币种

| 币种 | 说明 |
|------|------|
| ETH | 以太坊原生币 |
| USDT | Tether USD 稳定币 |
| USDC | USD Coin 稳定币 |
| BNB | BNB 原生币 |
| TRX | Tron 原生币 |
| MATIC | Polygon 原生币 |

---

## 权限控制

| 功能 | Admin | Finance |
|------|-------|---------|
| 查看 Vault 余额 | ✓ | ✓ |
| 添加钱包地址 | ✓ | ✓ |
| 启用/禁用钱包 | ✓ | ✓ |
| 删除钱包 | ✓ | - |
| 配置预警阈值 | ✓ | ✓ |
| 查看操作历史 | ✓ | ✓ |

---

## 安全注意事项

1. **钱包地址验证**: 添加钱包时验证地址格式有效性
2. **活跃钱包保护**: 活跃钱包不可删除，防止资金损失
3. **操作审计**: 所有钱包操作记录审计日志
4. **预警通知**: 余额不足时及时通知相关人员

---

> 返回 [后台管理前端目录](./README.md)
