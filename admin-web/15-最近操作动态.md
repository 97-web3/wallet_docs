# 最近操作动态

> 返回 [后台管理前端目录](./README.md)

---

## 页面概述

- **页面路径**: `/admin/activities`
- **权限要求**: Admin 或 Finance 角色
- **主要功能**: 以列表形式展示系统最近的操作记录，支持筛选、分页和跳转到相关业务详情页面。

该页面是对 Dashboard 中「最近操作动态」卡片的延展，提供更完整的历史记录与查询能力。

---

## 页面布局

### 整体结构

```
┌──────────────────────────────────────────────────────────┐
│  Header                                                   │
├──────────┬───────────────────────────────────────────────┤
│  Sidebar │  最近操作动态                                   │
│          │  系统操作记录总览 - 实时更新                     │
│          ├───────────────────────────────────────────────┤
│          │                                               │
│          │  筛选条件区                                    │
│          │  ┌─────────────────────────────────────────┐  │
│          │  │ 时间范围  操作类型  状态  关键字搜索      │  │
│          │  └─────────────────────────────────────────┘  │
│          │                                               │
│          │  列表区（可分页）                              │
│          │  ┌─────────────────────────────────────────┐  │
│          │  │ 最近操作动态列表                         │  │
│          │  │  每行展示图标、标题、详情、时间、状态标签  │  │
│          │  └─────────────────────────────────────────┘  │
│          │                                               │
└──────────┴───────────────────────────────────────────────┘
```

---

## 筛选与查询

### 筛选条件

- **时间范围**:
  - 支持快捷选项: 3d / 1week / 1mon / 3mon / 6mon
  - 支持自定义时间区间（日期选择器）
- **操作类型**:
  - transfer (转账批次)
  - withdrawal (出金审批)
  - user (用户相关)
  - vault (Vault 资金)
- **状态**:
  - success (成功)
  - error (失败)
  - info (信息)
- **关键字搜索**:
  - 按标题、详情、用户 ID、批次号、操作人、IP 等关键字模糊搜索

查询条件变化后，重新请求后端接口并刷新列表。

---

## 列表展示

**列表列头示例**:

| 列名     | 字段           | 说明                             |
| -------- | -------------- | -------------------------------- |
| 类型     | type           | 操作类型图标 + 文本              |
| 标题     | title          | 操作标题                         |
| 详情     | detail         | 操作详情描述                     |
| 操作人   | operatorName   | 触发该操作的管理员名称           |
| 操作时间 | operatedAt     | 精确操作时间（YYYY-MM-DD HH:mm） |
| IP 地址  | ip             | 操作来源 IP（可展示城市/地区）   |
| 状态     | status         | 成功/失败/信息状态标签           |
| 时间     | time           | 相对时间（如“5分钟前”等）       |
| 操作     | actions        | 查看详情等快捷操作               |

**行内布局**（与 Dashboard 中卡片样式保持一致）:

```
┌─────────────────────────────────────────────────────────────┐
│ ┌────────┐  标题                                   [状态标签] │
│ │  图标   │  详情描述                                         │
│ │ (10x10)│  时间（如：5分钟前 / 2025-12-14 10:23:11）          │
│ └────────┘                                                   │
└─────────────────────────────────────────────────────────────┘
```

### 分页

- 支持标准分页组件: 页码、上一页/下一页、每页条数选择
- 默认每页 20 条记录，可配置 20/50/100
- 翻页时保留当前筛选条件

---

## 数据结构

与 Dashboard 中的最近操作动态数据结构保持一致，增加必要的过滤字段：

```typescript
interface RecentActivity {
  id: number;
  type: 'transfer' | 'withdrawal' | 'user' | 'vault';
  title: string;      // 操作标题
  detail: string;     // 操作详情
  operatedAt: string; // 精确操作时间（ISO 字符串）
  time: string;       // 相对时间字符串（例如："5分钟前"）
  status: 'success' | 'error' | 'info';
  operatorId: string;   // 操作人 ID（如管理员 ID）
  operatorName: string; // 操作人名称
  operatorRole?: string; // 操作人角色（如 admin/finance）
  ip: string;           // 操作来源 IP
  userAgent?: string;   // 客户端 UA，便于审计（可选）
}
```

前端可根据实际需要扩展，例如增加 `location`（IP 解析出的城市/地区）、`bizId`（业务 ID）、`extra`（JSON 扩展信息）等字段用于跳转与审计。

---

## UI 组件

- **ActivityList**: 列表容器，支持空状态与加载状态
- **ActivityIcon**: 根据 `type` 显示不同图标及颜色
- **StatusTag**: 成功/失败/信息的状态标签组件
- **FilterBar**: 组合筛选条件（时间范围 + 类型 + 状态 + 搜索框）
- **Pagination**: 分页组件

图标与配色沿用 Dashboard 中最近操作动态模块：

| 类型       | 图标      | 背景色        | 图标颜色         |
| ---------- | --------- | ------------- | ---------------- |
| transfer   | Send      | bg-purple-50  | text-purple-600  |
| withdrawal | FileCheck | bg-orange-50  | text-orange-600  |
| user       | Users     | bg-blue-50    | text-blue-600    |
| vault      | Wallet    | bg-green-50   | text-green-600   |

| 状态    | 图标        | 颜色           |
| ------- | ----------- | -------------- |
| success | CheckCircle | text-green-600 |
| error   | XCircle     | text-red-600   |
| info    | Activity    | text-blue-600  |

---

## 交互与跳转

- 点击列表行或“查看详情”按钮：
  - 若 type = transfer: 跳转到 `/admin/transfer` 对应批次详情（可通过 query 参数携带批次 ID）
  - 若 type = withdrawal: 跳转到 `/admin/withdrawals/:id` 审批详情
  - 若 type = user: 跳转到 `/admin/users/:id` 用户详情
  - 若 type = vault: 跳转到 `/admin/vault` 并按币种/操作类型预过滤
- Dashboard 页面「最近操作动态」卡片中的“查看全部”按钮跳转到本页面 `/admin/activities`。

---

## API 接口

建议后端提供统一的分页查询接口，例如：

| 接口 | 方法 | 说明 |
|------|------|------|
| /api/v1/admin/activities | GET | 获取最近操作动态列表（可分页、可筛选） |

### 请求参数示例

```http
GET /api/v1/admin/activities?type=transfer&status=success&period=1week&page=1&pageSize=20
```

| 参数      | 类型   | 必填 | 说明                                      |
| --------- | ------ | ---- | ----------------------------------------- |
| type      | string | 否   | 操作类型过滤                              |
| status    | string | 否   | 状态过滤                                  |
| keyword   | string | 否   | 关键字搜索                                |
| period    | string | 否   | 时间周期: 3d/1week/1mon/3mon/6mon         |
| operator  | string | 否   | 操作人名称或 ID 过滤                       |
| ip        | string | 否   | 按 IP 地址前缀或完整 IP 过滤              |
| startTime | string | 否   | 自定义起始时间 (ISO 字符串)              |
| endTime   | string | 否   | 自定义结束时间 (ISO 字符串)              |
| page      | int    | 否   | 页码，默认 1                              |
| pageSize  | int    | 否   | 每页数量，默认 20                         |

### 响应数据示例

```json
{
  "list": [
    {
      "id": 1,
      "type": "transfer",
      "title": "转账批次执行完成",
      "detail": "春节红包批次，成功发放 115 人",
      "operatedAt": "2025-12-14 10:23:11",
      "time": "5分钟前",
      "status": "success",
      "operatorId": "admin_1001",
      "operatorName": "张三",
      "operatorRole": "admin",
      "ip": "203.0.113.10",
      "userAgent": "Mozilla/5.0 (...)"
    }
  ],
  "page": 1,
  "pageSize": 20,
  "total": 128
}
```

---

## 响应式与状态

- 小屏幕下（<768px）列表切为单列，筛选区域折叠为 Drawer 或折叠菜单
- Loading 状态：
  - 列表显示骨架屏或 loading 占位
- 空数据状态：
  - 显示“暂无最近操作记录”提示和返回 Dashboard 的快捷入口
- 错误状态：
  - 显示错误提示与“重试”按钮

---

> 返回 [后台管理前端目录](./README.md)
