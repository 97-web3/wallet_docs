# Personnel Management (人员管理)

> Back to [Admin Web Docs](./README.md) · Up to [System Settings Index](./07-系统设置.md)

---

## What “Personnel” Means Here

This module manages **internal staff identities** who can access **Admin Web** (operators, finance, auditors, tenant admins, platform super admins).

It is distinct from:

- Web2 end users: `wallet_docs/admin-web/03-用户管理.md`
- Web3 wallet users: `wallet_docs/admin-web/09-Web3用户管理.md`

---

## Enterprise Target State (IAM Baseline)

To support multi-tenant organizations with strict security/compliance requirements, Personnel Management should be specified as an **identity governance** capability:

- Multi-tenant scoping (org/tenant isolation + optional platform-level super-admin)
- Role-based access control (RBAC) + data-level scopes (vaults, wallets, accounts)
- Strong authentication policies (MFA, password policy, session controls)
- Lifecycle workflows (joiner/mover/leaver) with approvals and audit trails
- Segregation of duties (SoD) and privileged monitoring

This document includes:

1) **Current documented behavior** (extracted from the legacy `07-系统设置.md` and Admin API SRD), and  
2) **Recommended enterprise enhancements** to close gaps.

---

## Page Overview (Current)

- **Route (UI)**: `/admin/settings/admins`
- **Current SRD endpoints**: `wallet_docs/admin-api/srds/07-系统设置.md`
  - `GET /api/v1/admin/settings/admins`
  - `POST /api/v1/admin/settings/admins`
  - `PUT /api/v1/admin/settings/admins/{admin_id}`
  - `POST /api/v1/admin/settings/admins/{admin_id}/disable`
  - `POST /api/v1/admin/settings/admins/{admin_id}/reset-password`
  - `POST /api/v1/admin/settings/change-password`
- **Permissions (current SRD)**:
  - Admin management actions require `SuperAdmin`
  - Some read operations are permitted to `Admin`

---

## Current Behavior Summary (As Documented Today)

This section captures what is already defined by the Admin API SRD and the legacy Admin Web doc.

### Supported Admin Account Lifecycle (Current)

- Create admin with temporary password + optional forced password change
- Update admin profile fields (name, role, status)
- Disable admin (immediate session invalidation)
- Reset admin password (email delivery supported by SRD)
- Admin can change own password

### Key Guardrails (Current SRD)

- Cannot disable self (`CANNOT_DISABLE_SELF`)
- Cannot disable the last super admin (`LAST_SUPER_ADMIN`)
- Username must be a valid email; duplicates rejected (`USERNAME_EXISTS`, `INVALID_EMAIL`)

### Known Documentation Mismatches to Resolve

- **Single role vs multiple roles**:
  - Legacy UI doc implies `roles` (multi-select)
  - SRD uses `role` (single value)
- **Who can manage admins**:
  - Legacy UI doc says “Admin”
  - SRD requires `SuperAdmin` for create/disable/assign

These mismatches are treated as **documentation/requirements gaps**, not as implementation assumptions.

---

## API Reference (Current SRD, Condensed)

Authoritative details: `wallet_docs/admin-api/srds/07-系统设置.md`.

### List Admins

- `GET /api/v1/admin/settings/admins`
- Query params (examples): `page`, `page_size`, `role`, `status`, `keyword`
- Response includes: `admin_id`, `username`, `name`, `role`, `status`, `two_factor_enabled`, `last_login_at`, `last_login_ip`, `created_at`, `created_by`

### Create Admin

- `POST /api/v1/admin/settings/admins`
- Request (key fields): `username`, `name`, `role`, `password`, `require_password_change`, `two_factor_required`
- Permission: `SuperAdmin`
- Error codes: `USERNAME_EXISTS`, `INVALID_EMAIL`, `INVALID_ROLE`

### Update Admin

- `PUT /api/v1/admin/settings/admins/{admin_id}`
- Request (key fields): `name`, `role`, `status`
- Permission: `SuperAdmin`

### Disable Admin

- `POST /api/v1/admin/settings/admins/{admin_id}/disable`
- Request: `reason`
- Permission: `SuperAdmin`
- Error codes: `CANNOT_DISABLE_SELF`, `LAST_SUPER_ADMIN`

### Reset Admin Password

- `POST /api/v1/admin/settings/admins/{admin_id}/reset-password`
- Request: `send_email`, `require_change`
- Permission: `SuperAdmin`

### Change Own Password

- `POST /api/v1/admin/settings/change-password`
- Request: `current_password`, `new_password`, `confirm_password`
- Error codes: `WRONG_CURRENT_PASSWORD`, `PASSWORD_TOO_WEAK`, `PASSWORD_RECENTLY_USED`, `PASSWORD_MISMATCH`

---

## Data Model (Documentation Spec)

### 1) Tenant & Org Structure (Required for Multi-Tenant)

> If the platform is currently single-tenant, treat this section as a forward-compatible model; do not block documentation improvements that are tenant-agnostic.

**Tenant / Organization**

| Field | Type | Constraints / Notes |
|---|---|---|
| `tenant_id` | string | Immutable primary key |
| `tenant_name` | string | Display name |
| `status` | enum | `active`, `suspended`, `deactivated` |
| `created_at/by` | datetime/string | Audit |

**Department (Org Unit)**

| Field | Type | Constraints / Notes |
|---|---|---|
| `department_id` | string | PK |
| `tenant_id` | string | FK |
| `name` | string | Unique per tenant at the same parent |
| `parent_department_id` | string? | For hierarchy |
| `path` | string | Materialized path for fast queries (recommended) |
| `status` | enum | `active`, `archived` |

**Reporting Relationship / Approval Chain (Recommended)**

| Field | Type | Notes |
|---|---|---|
| `manager_admin_id` | string | Line manager |
| `approval_chain` | array | Approver list for access requests |

### 2) Admin Identity (Internal User)

**AdminUser**

| Field | Type | Constraints / Notes |
|---|---|---|
| `admin_id` | string | PK; e.g., `admin-10001` (SRD) |
| `username` | string | Current SRD uses email-as-username; unique |
| `display_name` | string | Human name |
| `email` | string | Required; unique (or unique per tenant) |
| `phone` | string? | Optional; E.164 |
| `employee_id` | string? | Optional; unique per tenant (recommended) |
| `department_id` | string? | FK (recommended) |
| `position_title` | string? | Optional |
| `status` | enum | `active`, `disabled`, `locked`, `pending_activation` |
| `two_factor_enabled` | boolean | In SRD |
| `two_factor_required` | boolean | In SRD create request |
| `last_login_at` | datetime? | In SRD |
| `last_login_ip` | string? | In SRD |
| `created_at/by` | datetime/string | In SRD |
| `updated_at/by` | datetime/string | Recommended |
| `disabled_at/by` | datetime/string? | In SRD disable response |

### 3) Role Assignment & Scopes

**AdminRoleAssignment**

| Field | Type | Constraints / Notes |
|---|---|---|
| `admin_id` | string | FK |
| `role_code` | string | e.g., `super_admin`, `admin`, `finance` (SRD) |
| `tenant_id` | string? | Required for multi-tenant scoping |
| `status` | enum | `active`, `expired`, `revoked` |
| `effective_from/to` | datetime? | For temporary roles |
| `reason` | string | Mandatory for audit |
| `approved_by` | string? | For workflow-gated changes |

**DataScope (Recommended)**

Use scopes to avoid “role explosion” (per-team roles). Examples:

- `vault_ids[]`: which vaults can be viewed/operated
- `chain_ids[]`: which chains can be configured
- `business_units[]`: business partitions for reporting and approvals

### 4) Authentication & Sessions

**MFA Device**

| Field | Type | Notes |
|---|---|---|
| `mfa_device_id` | string | PK |
| `admin_id` | string | FK |
| `type` | enum | `totp`, `webauthn`, `sms` (discourage), `backup_codes` |
| `added_at` | datetime | - |
| `last_used_at` | datetime? | - |

**AdminSession (Recommended)**

| Field | Type | Notes |
|---|---|---|
| `session_id` | string | PK |
| `admin_id` | string | FK |
| `created_at` | datetime | - |
| `expires_at` | datetime | - |
| `ip` | string | - |
| `user_agent` | string | - |
| `revoked_at/by` | datetime/string? | For forced logout |

**LoginAttempt (Recommended)**

| Field | Type | Notes |
|---|---|---|
| `admin_id` | string | FK |
| `attempted_at` | datetime | - |
| `ip` | string | - |
| `result` | enum | `success`, `failure` |
| `failure_reason` | string? | e.g., wrong password, MFA failure |

**PasswordHistory (Recommended)**

| Field | Type | Notes |
|---|---|---|
| `admin_id` | string | FK |
| `password_hash` | string | Store hashed; never store plaintext |
| `set_at` | datetime | - |
| `set_by` | string | `self` or admin ID (reset) |

---

## UI / UX Specifications

### Admin List (Current “管理员列表”)

**Primary actions**:

- Create admin
- Edit admin
- Disable/Enable admin
- Reset password

**Table columns** (as documented in legacy file):

| Column | Field | Notes |
|---|---|---|
| Username | `username` | Login identifier |
| Name | `name` | Display name |
| Role(s) | `roles` | Legacy doc implies multi-role; SRD currently uses one `role` |
| Status | `status` | Active/Disabled |
| Last Login | `last_login_at` | - |
| Last IP | `last_login_ip` | - |
| Actions | - | Edit, Disable, Reset password |

### Create Admin (Current)

Create form fields (SRD-aligned):

- `username` (email)
- `name`
- `role`
- `password` (temporary)
- `require_password_change`
- `two_factor_required`

Recommended UI additions (enterprise baseline):

- Tenant selection (if multi-tenant)
- Department / position / employee ID
- “Require MFA enrollment before access” checkbox
- IP allowlist binding (optional)

### Edit Admin (Current)

Legacy doc: editable fields include name, roles, email, status; username not editable.

Recommended guardrails:

- Prevent disabling self
- Prevent disabling last `super_admin`
- Force re-authentication (password/MFA) for sensitive actions

---

## Recommended UI Additions for Enterprise Scale

### Admin Detail View (Recommended)

Add a detail drawer/page to reduce risky inline editing and to centralize auditability.

**Sections**:

- Profile: identity, tenant, department, employee ID
- Access: role(s), scopes, SoD warnings, last access review date
- Authentication: MFA status, enrolled factors, last credential change
- Sessions: active sessions and “Revoke” actions
- Activity: last N audit events filtered to this admin

### Organization Structure (Departments) (Recommended)

Provide a department management screen to support reporting lines and approvals:

- Create/edit/archive departments
- Drag/drop hierarchy (with cycle prevention)
- Assign admins to departments

### Bulk Operations (Recommended)

- Bulk import (CSV): create/update admins; optional invitation mode
- Bulk role assignment / scope assignment
- Bulk disable (offboarding events)

Documentation requirements for bulk features:

- CSV templates and strict validation rules
- Row-level error reporting and safe re-run semantics
- Audit logging per record + batch summary event

### Access Policy UI (Recommended)

- IP allowlist management (per admin and/or per tenant)
- Time-based access windows (business hours)
- Geo restrictions (if supported by risk engine)

---

## Access Request & Approval (Recommended)

To support least privilege without operational bottlenecks, document (and ideally provide) an access request flow:

1. **Requester** selects target access (role and/or scopes), provides business justification, and optional ticket ID.
2. **Approver(s)** review request (manager + security/tenant admin, depending on policy).
3. **Provisioning** applies role/scopes with an effective window; high-risk requests may require step-up auth.
4. **Audit evidence** is recorded end-to-end (request, approvals, provisioning, expiry/revocation).
5. **Expiry** automatically revokes temporary access and logs the change.

Edge rules:

- SoD conflict requests should be blocked or require exceptional approval.
- Requests for privileged roles should require stronger authentication and tighter network policies.

---

## Lifecycle Workflows (Joiner / Mover / Leaver)

### 1) Onboarding (Recommended)

1. Create admin via invitation (email link) or direct creation.
2. Assign initial role(s) + data scopes.
3. Require MFA enrollment on first login.
4. Require password change (if temporary password was used).
5. Record audit events for creation + assignment + activation.

Recommended variants:

- **Invitation flow**: admin receives email link; sets password + enrolls MFA; account becomes `active`.
- **Just-in-time (SSO) provisioning**: first SSO login creates account; default role is applied; MFA enforced by IdP.

### 2) Changes / Transfers (Mover)

Common changes:

- Department/position change
- Role/scopes change
- Temporary elevation (e.g., incident response window)

Recommended governance:

- Require “reason”
- Approval workflow for privileged roles
- Effective date/time support

### 3) Offboarding (Leaver)

1. Disable account immediately (force session revocation).
2. Revoke privileged scopes.
3. Transfer ownership/approvals (handover) if applicable.
4. Keep audit records immutable; do not delete identities for compliance.

---

## Access Control & Security Controls (Enterprise Baseline)

### Status Model

| Status | Meaning | Typical Trigger |
|---|---|---|
| `pending_activation` | Created but not fully enrolled | invitation not accepted / MFA not enrolled |
| `active` | Can log in | normal |
| `locked` | Temporarily blocked | too many login attempts |
| `disabled` | Deprovisioned | offboarding / security incident |

### Password Policy (Recommended)

- Minimum length: 12+
- Complexity: avoid “composition-only”; require entropy and block breached passwords
- Rotation: only for high-risk or regulated contexts; prefer risk-based rotation
- Password history: disallow last N (e.g., 5)

### MFA Policy (Required)

- Enforce MFA for all admins; require stronger factors for privileged roles.
- Support at least TOTP; recommend WebAuthn for super admins.

### Session & Concurrent Login Controls (Recommended)

- Session timeout (idle + absolute)
- Max concurrent sessions per admin
- Admin can revoke own sessions; super admins can revoke any session

### Privileged Access & Step-Up Authentication (Recommended)

For high-risk actions (e.g., changing fees/limits, editing RPC endpoints, disabling admins):

- Require recent MFA (“step-up”) even if the session is valid
- Require a reason and optionally a ticket/reference ID
- Apply stricter IP/geo/time policy

### Network / Geo / Time Restrictions (Recommended)

- IP allowlist/denylist per admin, per role, and/or per tenant
- Time-based policies (business hours)
- Geo-fencing for high-risk actions

---

## Audit & Compliance Requirements

Personnel management must produce high-quality audit events for:

- Admin creation / update / disable / re-enable
- Role/scopes assignment changes (before/after + reason + approver)
- Password reset and credential changes
- MFA enrollment and factor changes
- Session revocation and privilege elevation windows

Audit logs should be consumable by SIEM (recommended: webhook export or scheduled export).

---

## Privileged Admin Monitoring (Recommended)

For roles like `super_admin` (or any role with `settings.write`, key management, fee/limit edits):

- Dedicated audit views (“privileged actions” filter)
- Alerting on risky actions (e.g., disabling admins, changing limits, changing RPC endpoints)
- Periodic access reviews with evidence export (who has privileged roles and why)

---

## Integration Points (Recommended)

### SSO (SAML/OIDC)

- Support IdP-driven authentication with enforced MFA policies at the IdP
- Map IdP groups to roles (and scopes, if supported)
- Preserve local break-glass accounts for incident recovery (highly restricted)

### Automated Provisioning (SCIM / HRIS / LDAP)

- Joiner/mover/leaver automation via SCIM
- Attribute sync: department, manager, employee ID
- Immediate deprovisioning on termination events

### Cross-Module Dependencies

- Roles and permissions: `wallet_docs/admin-web/07-02-角色权限管理.md`
- Audit evidence: `wallet_docs/admin-web/07-05-审计日志.md`
- Global security defaults (timeout/lockout/MFA requirement): `wallet_docs/admin-web/07-03-系统配置.md`

---

## Self-Service Capabilities (Recommended)

Add a “My Profile” area for admins:

- Update contact info (with verification)
- Enroll/manage MFA
- View active sessions and revoke
- View “My permissions” (effective permissions)
- Request additional access (workflow)

---

## Documentation Completeness Checklist (Use Per Feature)

For every Personnel Management capability added/updated in docs, include:

- Functional description + threat model context (what risk it reduces)
- Data model (fields, constraints, relationships, retention)
- UI/UX (list, detail, forms, actions, confirmations, reason fields)
- Business rules (validation, approvals, SoD checks, idempotency)
- API mapping (endpoints, request/response, error codes)
- Workflows (happy path + rollback path)
- Edge cases (self-disable, last super admin, conflicts, partial failures)
- Security considerations (MFA, sessions, IP/geo/time, logging integrity)

---

## Industry Best Practices Benchmark (IAM)

### Okta / Azure AD / Auth0 Alignment (What to Borrow)

- Strong factor enforcement (MFA policies per group/role)
- Central lifecycle: invitation, activation, suspension, deactivation
- SCIM provisioning for automated joiner/mover/leaver (recommended)
- Continuous access evaluation signals (risk-based lockouts)

### NIST / OWASP Alignment (What to Require)

- MFA for privileged accounts
- Re-authentication for sensitive actions
- Brute-force protection and account lockout policy
- Secure session management and token revocation

### Compliance (SOC 2 / ISO 27001 / GDPR)

- Defined access review process (periodic certification)
- Principle of least privilege documented and enforced
- Audit retention policy and integrity controls
- Personal data minimization (only store needed personnel data)

---

## Gap Analysis Report (Current Docs vs Enterprise Baseline)

### Executive Summary

**Current completeness estimate (Personnel Management only)**: ~25% (basic CRUD + disable/reset exists; governance, multi-tenant, scopes, lifecycle automation, and compliance workflows are largely undocumented).

### Coverage Scorecard (Documentation Completeness)

| Area | Coverage Today | Notes |
|---|---:|---|
| Account CRUD + disable/reset | High | SRD is clear for core endpoints |
| Org structure (departments, managers) | Low | Not documented |
| MFA setup, recovery, enforcement | Low | Only flags exist; flows missing |
| Sessions & concurrent login controls | Low | Not documented |
| Data-level authorization (scopes) | Low | Not documented |
| Approval workflows (admin changes, role changes) | Low | Not documented |
| SoD controls | Low | Not documented |
| Access review / certification | Low | Not documented |
| Integrations (SSO/SCIM/LDAP) | Low | Not documented |

### Gap Table

| Priority | Capability Gap | Why It Matters (Crypto Admin Context) | Recommended Documentation Additions |
|---|---|---|---|
| Critical | Multi-tenant identity model (tenant scoping, isolation) | Prevents cross-tenant data leakage | Define tenant-aware admin identity + role assignment model; add scope rules |
| Critical | Data-level permissions (vault/wallet/account scopes) | Prevents broad access to funds and sensitive ops | Add scope definitions, UI filters, assignment workflows |
| Critical | MFA policy and enrollment flows | Reduces takeover risk for privileged accounts | Document MFA types, enrollment, recovery, enforcement rules |
| Critical | Session management + forced logout | Incident response and offboarding correctness | Document session list/revocation, concurrent limits, timeout settings |
| Critical | Approval workflows for privileged changes | Dual control is common requirement | Document proposer/approver steps, reason fields, audit diffs |
| Critical | SoD conflict matrix | Prevents fraud/abuse | Document conflicting roles/permissions and enforcement behavior |
| Important | Bulk operations (import/export, batch disable) | Admin efficiency at scale | Document CSV templates, validations, rollback and audit logging |
| Important | Access reviews / certifications | Compliance and ongoing risk | Document periodic review flows, evidence export |
| Important | IP/Geo/Time access policies | Reduces attack surface | Document policies, exceptions, and monitoring |
| Nice-to-have | Custom user attributes, avatars | UX / HR integration | Document optional fields and display behaviors |
| Nice-to-have | Activity dashboard for admins | Faster investigations | Document “my recent actions”, “my access”, anomalies |

### Best-Practice Comparison (High-Level)

| Standard / Platform | Expected Capability | Current Documentation Status |
|---|---|---|
| Okta / Azure AD | MFA policies and conditional access | Partial (flags only) |
| Okta / Azure AD | Automated provisioning (SCIM) | Missing |
| NIST 800-63 / OWASP ASVS | Step-up authentication for sensitive actions | Missing |
| SOC 2 / ISO 27001 | Periodic access review evidence | Missing |
| Financial controls | Dual control / SoD | Missing |

---

## Documentation Enhancement Roadmap (Recommended Order)

1. **Lock down “as-is” SRD alignment**: roles (single vs multi), permission names, and admin management permissions (SuperAdmin vs Admin).
2. **Add enterprise security baseline**: MFA policy, password policy, session controls, forced logout, lockout behavior.
3. **Add multi-tenant model**: tenant scoping for admins, roles, and data access; clarify tenant admin vs platform admin.
4. **Add data-level scopes**: vault/wallet/account scoping, assignment UI, and enforcement rules.
5. **Add lifecycle workflows**: onboarding/invitation, mover processes, offboarding playbook.
6. **Add governance workflows**: approval chains for privileged changes, SoD rules, access requests.
7. **Add compliance operations**: access review process, audit evidence export, retention policies.

Dependencies:

- Scopes and SoD depend on a stable permission taxonomy (see `wallet_docs/admin-web/07-02-角色权限管理.md`).
- Approval workflows should reuse audit log schema and reason fields (see `wallet_docs/admin-web/07-05-审计日志.md`).

Suggested phasing (documentation work only):

- **Phase 1 (Week 1–2)**: align current SRD vs UI docs; clearly mark permissions and constraints; add endpoint summaries and error cases.
- **Phase 2 (Week 3–4)**: document MFA + password + session policies and lifecycle workflows (invitation/offboarding).
- **Phase 3 (Month 2)**: document multi-tenant model + scopes + access policy UI (IP/time/geo) and add SoD guidance.
- **Phase 4 (Month 3)**: document access review processes, reporting, and SIEM integration patterns.

---

> Back to [Admin Web Docs](./README.md)
