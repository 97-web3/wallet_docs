# 登录与认证

> 返回 [后台管理前端目录](./README.md)

---

## 页面概述

- **页面路径**: `/login`
- **权限要求**: 公开（未登录可访问）
- **主要功能**: 管理员登录、身份验证、会话管理

---

## 页面布局

### 登录页面结构

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                     ┌───────────────────────┐                   │
│                     │                       │                   │
│                     │        Logo           │                   │
│                     │   Admin Management    │                   │
│                     │                       │                   │
│                     ├───────────────────────┤                   │
│                     │                       │                   │
│                     │   账号输入框           │                   │
│                     │   [________________]  │                   │
│                     │                       │                   │
│                     │   密码输入框           │                   │
│                     │   [________________]  │                   │
│                     │                       │                   │
│                     │   [    登 录    ]     │                   │
│                     │                       │                   │
│                     │   忘记密码?           │                   │
│                     │                       │                   │
│                     └───────────────────────┘                   │
│                                                                 │
│                     © 2025 Enterprise Wallet                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2FA 验证页面结构

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                     ┌───────────────────────┐                   │
│                     │                       │                   │
│                     │        Logo           │                   │
│                     │   两步验证             │                   │
│                     │                       │                   │
│                     ├───────────────────────┤                   │
│                     │                       │                   │
│                     │   请输入验证码         │                   │
│                     │   [  ] [  ] [  ] [  ] [  ] [  ]          │
│                     │                       │                   │
│                     │   打开 Google         │                   │
│                     │   Authenticator 获取   │                   │
│                     │                       │                   │
│                     │   [    验 证    ]     │                   │
│                     │                       │                   │
│                     │   [返回登录]          │                   │
│                     │                       │                   │
│                     └───────────────────────┘                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 功能模块

### 1. 账号密码登录

**功能描述**: 使用管理员账号和密码进行身份验证

**用户角色**: 所有管理员（Admin / Finance）

**UI 组件**:
- **账号输入框**: Input 组件，支持邮箱或用户名
- **密码输入框**: Password 组件，带密码显示/隐藏切换
- **登录按钮**: Primary Button，点击提交登录

**表单校验规则**:
| 字段 | 规则 | 错误提示 |
|------|------|----------|
| 账号 | 必填，有效邮箱格式 | "请输入有效的邮箱地址" |
| 密码 | 必填，6-32 字符 | "密码长度为 6-32 字符" |

**用户交互流程**:
1. 用户输入账号和密码
2. 点击「登录」按钮
3. 显示 Loading 状态
4. 验证成功 → 跳转到 2FA 验证页面（如已启用）
5. 验证成功且无 2FA → 跳转到 Dashboard
6. 验证失败 → 显示错误提示

**错误处理**:
| 错误码 | 错误信息 | 处理方式 |
|--------|----------|----------|
| 401 | 账号或密码错误 | 显示错误提示，清空密码框 |
| 403 | 账户已被禁用 | 显示错误提示，提供联系管理员链接 |
| 429 | 登录次数过多 | 显示冷却时间倒计时 |

---

### 2. 两步验证 (2FA)

**功能描述**: 使用 Google Authenticator 进行二次验证

**用户角色**: 已启用 2FA 的管理员

**UI 组件**:
- **验证码输入框**: 6 位数字输入，自动跳转焦点
- **验证按钮**: Primary Button
- **返回链接**: 返回登录页面

**用户交互流程**:
1. 登录成功后自动跳转到 2FA 页面
2. 用户打开 Google Authenticator 获取验证码
3. 输入 6 位验证码
4. 系统验证
5. 验证成功 → 跳转到 Dashboard
6. 验证失败 → 显示错误提示，可重试

**验证码输入行为**:
- 自动聚焦第一个输入框
- 输入数字后自动跳转到下一个
- 支持粘贴 6 位数字
- 删除时自动跳转到前一个输入框
- 输入完成后自动提交

---

### 3. 忘记密码

**功能描述**: 通过邮箱重置密码

**用户角色**: 所有管理员

**UI 组件**:
- **邮箱输入框**: Input 组件
- **发送重置链接按钮**: Primary Button

**用户交互流程**:
1. 点击「忘记密码?」链接
2. 弹出重置密码对话框
3. 输入注册邮箱
4. 点击「发送重置链接」
5. 显示成功提示，引导查看邮箱
6. 用户通过邮件链接重置密码

---

### 4. 会话管理

**功能描述**: 管理用户登录状态和 Token 刷新

**技术说明**:
- **Token 存储**: JWT Token 存储在 localStorage
- **Token 刷新**: 过期前 5 分钟自动刷新
- **会话超时**: 默认 24 小时，可配置
- **强制登出**: 账户冻结或密码变更时强制登出

**自动登出场景**:
| 场景 | 处理方式 |
|------|----------|
| Token 过期 | 跳转登录页，提示"会话已过期" |
| 账户被冻结 | 跳转登录页，提示"账户已被禁用" |
| 权限变更 | 刷新权限，必要时跳转登录页 |
| 多设备登录 | 根据配置决定是否强制登出其他设备 |

---

## UI 组件列表

| 组件名称 | 类型 | 功能说明 |
|----------|------|----------|
| LoginForm | Form | 登录表单容器 |
| EmailInput | Input | 邮箱/账号输入框 |
| PasswordInput | Input.Password | 密码输入框，带显隐切换 |
| OTPInput | Custom | 6 位验证码输入组件 |
| LoginButton | Button | 登录/验证提交按钮 |
| ForgotPasswordModal | Modal | 忘记密码弹窗 |
| ErrorAlert | Alert | 错误提示组件 |

---

## 状态与交互

### 页面状态

| 状态 | 描述 | UI 表现 |
|------|------|---------|
| 初始 | 页面加载完成 | 显示登录表单 |
| Loading | 提交验证中 | 按钮显示 Loading，禁用表单 |
| Error | 验证失败 | 显示错误提示，按钮恢复可用 |
| Locked | 账户锁定 | 显示锁定提示和倒计时 |
| 2FA Required | 需要两步验证 | 跳转到 2FA 页面 |

### 表单状态

```
┌─────────────────────────────────────────┐
│  初始状态                               │
│  - 按钮可用                             │
│  - 无错误提示                           │
└─────────────────────────────────────────┘
        │
        ▼ (点击登录)
┌─────────────────────────────────────────┐
│  Loading 状态                           │
│  - 按钮显示 Loading 图标                │
│  - 表单输入禁用                          │
└─────────────────────────────────────────┘
        │
        ├─────────── (验证失败) ───────────┐
        │                                  │
        ▼                                  ▼
┌──────────────────────┐    ┌──────────────────────┐
│  成功状态            │    │  错误状态            │
│  - 跳转到 Dashboard   │    │  - 显示错误提示      │
│    或 2FA 页面       │    │  - 按钮恢复可用      │
└──────────────────────┘    └──────────────────────┘
```

### 用户操作响应

| 操作 | 响应 |
|------|------|
| 登录成功 | Toast 提示"登录成功"，跳转 Dashboard |
| 登录失败 | Alert 显示错误原因 |
| 2FA 验证成功 | Toast 提示"验证成功"，跳转 Dashboard |
| 2FA 验证失败 | Alert 显示"验证码错误"，清空输入 |
| 重置密码邮件发送 | Toast 提示"重置邮件已发送" |

---

## 安全考虑

### 前端安全措施

1. **密码不缓存**: 不在前端存储明文密码
2. **Token 安全**: Token 存储在 localStorage，设置 HttpOnly Cookie 作为备选
3. **登录限流**: 显示登录失败次数和冷却时间
4. **敏感操作日志**: 所有登录尝试记录审计日志

### 错误信息处理

- 登录失败时不明确提示是账号还是密码错误（防止枚举攻击）
- 统一显示"账号或密码错误"

---

> 返回 [后台管理前端目录](./README.md)
