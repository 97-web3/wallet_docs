# 员工目录与映射（Employee Directory & Wallet UID Mapping）

> 返回 [后台管理前端目录](./README.md)

---

## 页面概述

- **页面路径**：`/admin/employees`
- **权限建议**：`hr_staff`/`hr_manager`（读写），`finance`（只读），`auditor`（只读+导出）
- **目标**：为“薪资发放（payroll）”提供可治理的员工主数据（Employee Master）与 `employeeId → wallet uid` 映射，减少纯 Excel 依赖导致的长期错误与重复发放风险。

---

## 为什么需要（闭环补齐）

转账管理的薪资导入模型要求 `employeeId/department/uid` 等字段（见 `wallet_docs/admin-web/transfer/01-数据模型与字段.md`），但当前“用户管理”中员工身份/业务组仍为规划项（见 `wallet_docs/admin-web/03-用户管理.md`）。

若缺少统一的员工目录，会导致：

- 同一员工在不同批次出现不同 `department`（部门汇总与审批难以可信）
- `employeeId ↔ uid` 映射漂移，造成导入失败或误发放
- “同周期同员工不重复发放（E023）”无法可靠落地

---

## 数据模型（建议）

```typescript
type EmployeeStatus = 'active' | 'on_leave' | 'terminated';

interface Employee {
  employee_id: string;          // HR系统工号（主键）
  name: string;                 // 员工姓名
  department_id: string;        // 部门ID
  department_name: string;      // 冗余展示字段（避免列表频繁 join）
  status: EmployeeStatus;

  wallet_uid?: string;          // 钱包系统用户UID（可为空：未开通/未绑定）
  preferred_currency?: string;  // 薪资默认币种（可选：USDT 等）

  effective_from?: string;      // 生效期（可选）
  effective_to?: string;        // 失效期（可选）

  created_at: string;
  created_by: string;
  updated_at: string;
  updated_by: string;
}
```

---

## 页面布局（建议）

```
┌──────────────────────────────────────────────────────────────────────────┐
│ 员工目录与映射                                             [导入] [新增] │
├──────────────────────────────────────────────────────────────────────────┤
│ 筛选: [部门▼] [状态▼] [是否已绑定UID▼] [关键词(工号/姓名/UID)]          │
├──────────────────────────────────────────────────────────────────────────┤
│ │工号│姓名│部门│状态│钱包UID│最近更新│操作(查看/编辑/绑定/解绑)│        │
└──────────────────────────────────────────────────────────────────────────┘
```

**关键交互**：

- 绑定/解绑 `wallet_uid` 必须二次确认，并写入审计日志（含 reason）
- 终止（terminated）员工默认禁止出现在“薪资批次导入的有效名单”中（导入时报错或警告，取决于策略）

---

## 与薪资导入的联动（必须）

在 `wallet_docs/admin-web/transfer/03-导入模板与验证.md` 的校验中加入“主数据优先”的规则：

- 若导入行包含 `employeeId`：
  - 优先从员工目录查询 `employeeId → wallet_uid/department_id`
  - 当导入 `department` 与主数据不一致：提示 **警告**（可配置为阻断）
  - 当 `wallet_uid` 缺失：导入报错并提示“去员工目录完成绑定”

这使导入从“纯文本校验”升级为“业务主数据校验”，显著降低误发与返工成本。

---

## 导入/同步（建议最小闭环）

- **Excel 导入**：支持 HR 导出格式（工号/姓名/部门/状态/UID(可选)）
- **API 同步（规划）**：可对接 HRIS（按日/按月同步）；同步必须有审计、支持 dry-run 差异预览

---

## 审计与合规

- 记录：新增/编辑/导入/绑定/解绑/状态变更
- 导出：按部门/周期导出员工名单与 UID 映射（用于薪资审计底稿）

---

> 返回 [后台管理前端目录](./README.md)
