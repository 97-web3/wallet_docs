# Vault / 余额调整与审批（Maker-Checker）

> 返回 [Vault 资金管理索引](../10-Vault资金管理.md)

---

## 目标

用于处理“链外/链上已发生的资金变动”在系统侧的确认与留痕（例如冷钱包调拨、对账调整、紧急补充等），并通过 Maker-Checker 控制风险。

> 注意：该流程是高风险操作，文档必须明确权限、幂等、审批、审计与证据链要求。

---

## 1. 发起调整（申请）

> SRD 对齐：`POST /api/v1/admin/vault/adjust`（请求需带 `Idempotency-Key`）

### 1.1 触发入口（建议）

- 网络卡片/详情页的资产行：`[发起调整]`
- 调整抽屉/弹窗中选择：网络、币种、类型、金额、来源、备注、附件

### 1.2 表单字段（与 SRD 对齐）

- `network` / `chain_id`
- `currency`
- `adjustment_type`: `increase | decrease`
- `amount`
- `reason`
- `source`: `cold_wallet | exchange | other`
- `source_address`（可选）
- `tx_hash`（可选：若链上交易已存在）
- `attachments[]`（可选：证明材料）

---

## 2. 审批（通过/拒绝）

> SRD 对齐：`POST /api/v1/admin/vault/adjustments/{id}/approve`（需 2FA）

### 2.1 审批要求（建议写清）

- 审批人必须与发起人不同（禁止自批）
- 大额调整需更严格审批（双人/多级/仅 SuperAdmin）
- 审批动作需二次验证（2FA）

---

## 3. 调整历史与状态

> SRD 对齐：`GET /api/v1/admin/vault/adjustments`（支持分页与筛选）

### 3.1 列表筛选（建议）

- `status`：pending_approval / approved / rejected / processing / completed / failed
- `network` / `currency` / `adjustment_type`
- `date_from` / `date_to`

### 3.2 状态枚举（与 SRD 对齐）

| 状态 | 代码 | 描述 |
|------|------|------|
| 待审批 | `pending_approval` | 等待审批 |
| 已通过 | `approved` | 审批通过 |
| 已拒绝 | `rejected` | 审批拒绝 |
| 处理中 | `processing` | 链上处理中 |
| 已完成 | `completed` | 调整完成 |
| 失败 | `failed` | 调整失败 |

---

## 4. 风险控制（文档必须明确）

- 幂等：重复提交需用 `Idempotency-Key` 防重放
- 审计：记录发起人/审批人/时间/2FA 校验结果/证据材料链接
- 对账：调整完成后应能关联到“对账说明/链上交易哈希”（若存在）

