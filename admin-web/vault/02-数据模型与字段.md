# Vault / 数据模型与字段

> 返回 [Vault 资金管理索引](../10-Vault资金管理.md)

---

## 术语与边界

- **Network Vault（当前实现视角）**：以 `chain_id` 为单位的“链级金库地址”（SRD 返回 `vault_address`）。
- **Wallet Address List（前端扩展视角）**：同一网络下可维护多个地址（1 个活跃 + 若干备用）。若后端仅提供 `vault_address`，则前端只能展示“当前活跃地址”，备用地址需要额外接口支持。
- **余额字段**：需要区分 `balance`（总额）、`available_balance`（可用）、`locked_balance`（锁定/预留），并标注**数据新鲜度**（`last_sync_at`、`blocks_behind`）。

---

## 支持的网络与链标识（建议在文档统一口径）

| 网络 | `network`（展示名示例） | `chain_id` | 备注 |
|------|--------------------------|-----------:|------|
| Ethereum | Ethereum | 1 | EVM |
| BNB Smart Chain | BSC | 56 | EVM |
| Polygon | Polygon | 137 | EVM（示例，按项目实际为准） |
| Tron | Tron | -1 | SRD 示例使用 -1 |

> 建议：在 UI 同时展示 `network + chain_id`，避免“同名网络/测试网”混淆。

---

## 支持的资产/币种口径（建议）

- **原生币**：ETH / BNB / MATIC / TRX
- **稳定币（示例）**：USDT / USDC
- **Token 唯一性**：建议以 `currency + contract_address` 唯一定位（原生币 `contract_address = null`）

---

## 与 SRD 对齐的数据结构（推荐以 SRD 为准）

> 字段来源：`wallet_docs/admin-api/srds/10-Vault资金管理.md`

### 1) Vault 概览（Overview）

```typescript
interface VaultOverviewResponse {
  summary: {
    total_balance_usd: string;
    total_networks: number;
    healthy_networks: number;
    pending_adjustments: number;
    alerts_count: number;
  };
  networks: Array<{
    network: string;           // 展示名：Ethereum/BSC/Tron/Polygon
    chain_id: number;          // Tron 使用 -1
    vault_address: string;     // 当前活跃 Vault 地址
    status: 'healthy' | 'warning' | 'critical';
    total_balance_usd: string;
    balances: Array<{
      currency: string;        // ETH/USDT/...
      balance: string;
      balance_usd: string;
      threshold_low?: string;
      threshold_critical?: string;
      status: 'normal' | 'low' | 'critical';
    }>;
    last_sync_at?: string;     // ISO8601
    sync_status?: 'synced' | 'syncing' | 'delayed' | 'failed';
    alert?: { type: string; message: string };
  }>;
}
```

### 2) Vault 详情（Detail）

```typescript
interface VaultDetailResponse {
  network: string;
  chain_id: number;
  vault_address: string;
  status: 'healthy' | 'warning' | 'critical';
  balances: Array<{
    currency: string;
    contract_address: string | null;
    balance: string;
    balance_usd: string;
    locked_balance?: string;
    available_balance?: string;
    pending_withdrawals?: number;
    pending_withdrawals_amount?: string;
    threshold_config?: {
      low: string;
      critical: string;
      notify_email: boolean;
      notify_webhook: boolean;
    };
    status: 'normal' | 'low' | 'critical';
  }>;
  recent_transactions: Array<{
    id: string;
    type: 'inflow' | 'outflow';
    currency: string;
    amount: string;
    to_address?: string;
    from_address?: string;
    tx_hash: string;
    status: 'pending' | 'completed' | 'failed';
    created_at: string;
  }>;
  sync_info: {
    last_sync_at: string;
    last_block_synced: number;
    current_block: number;
    blocks_behind: number;
    sync_status: 'synced' | 'syncing' | 'delayed' | 'failed';
  };
  gas_info?: {
    balance: string;
    balance_usd: string;
    estimated_transactions: number;
    avg_gas_price_gwei: string;
  };
}
```

---

## 关键字段解释（文档必须写清）

### 余额口径

- `balance`：链上总余额（包含锁定/预留/待处理部分，具体以 SRD 定义为准）
- `available_balance`：可用于新交易/新提现的余额（运营最关心）
- `locked_balance`：已锁定或预留（例如待处理提现、风控冻结、策略预留）
- `pending_withdrawals_amount`：已发起但未完成的资金流出（流动性风险指标）

### 数据新鲜度与可靠性

- `last_sync_at`：最后同步时间（必须在 UI 显示）
- `blocks_behind`：区块高度落后（必须用于判断“数据陈旧/同步异常”）
- `sync_status`：synced/syncing/delayed/failed（用于状态徽章与告警）

---

## 与“多地址管理”的差异（需明确）

当前 admin-web 规划支持“同一网络多个地址（1 活跃 + 若干备用）”的操作设计；但 SRD 示例接口返回的是单一 `vault_address`。

建议在产品/接口侧明确二选一：

1. **单地址模式（SRD 当前）**：每条链固定一个 Vault 地址；前端移除“备用地址列表”或将其标记为“规划能力”。
2. **多地址模式（前端规划）**：需要新增/扩展接口返回 `wallets[]`（含 `isActive`、`addedAt` 等），并支持启用/删除等操作。
