# Swap 配置

> 返回 [后台管理前端目录](./README.md)

---

## 页面概述

- **页面路径**: `/admin/swap`
- **权限要求**: Admin 角色
- **主要功能**: DEX 协议管理、滑点规则配置、兑换历史查询

**重要说明**: Swap/闪兑功能仅支持 Web3 钱包，Web2 托管钱包不支持 Swap 操作。

---

## 页面布局

### Swap 配置主页面结构

```
┌──────────────────────────────────────────────────────────────────────────┐
│  Header                                                                   │
├──────────┬───────────────────────────────────────────────────────────────┤
│          │  Breadcrumb: 首页 / Swap 配置                                  │
│  Sidebar ├───────────────────────────────────────────────────────────────┤
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ Tab 切换                                                  │ │
│          │  │ [DEX 管理] [滑点配置] [兑换历史]                          │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  ════════════════════════════════════════════════════════════ │
│          │                                                                │
│          │  [DEX 管理] Tab 内容:                                         │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │                                              [添加 DEX]   │ │
│          │  ├──────────────────────────────────────────────────────────┤ │
│          │  │ │DEX名称     │链  │路由合约         │状态  │优先级│操作  │ │
│          │  │ ├────────────┼────┼─────────────────┼──────┼──────┼──────┤ │
│          │  │ │Uniswap V3  │ETH │0x68b3...4f2a   │已启用│1     │[编辑]│ │
│          │  │ │PancakeSwap │BSC │0x10ed...8c7b   │已启用│1     │[编辑]│ │
│          │  │ │SunSwap V2  │TRX │T9yD14...Ww     │已禁用│2     │[编辑]│ │
│          │  │ ...                                                       │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
└──────────┴───────────────────────────────────────────────────────────────┘
```

---

## 功能模块

### 1. DEX 管理

**功能描述**: 管理支持的去中心化交易所协议

**用户角色**: Admin

#### 1.1 DEX 列表

**UI 组件**:
- **Table**: DEX 列表表格
- **Switch**: 启用/禁用开关
- **Button**: 添加、编辑按钮

**表格列**:
| 列名 | 字段 | 说明 |
|------|------|------|
| DEX 名称 | name | 交易所名称 |
| 链 | chain | 所属区块链 |
| 路由合约 | router_address | 路由器合约地址 |
| 工厂合约 | factory_address | 工厂合约地址 |
| 状态 | enabled | 启用/禁用 |
| 优先级 | priority | 使用优先级 |
| 健康状态 | health | 连接状态 |
| 操作 | - | 编辑、删除 |

**支持的 DEX 列表**:
| DEX 名称 | 支持链 | 协议版本 | 说明 |
|----------|--------|----------|------|
| 1inch | ETH, BSC, Polygon | 聚合器 | DEX 聚合器，自动选择最优路径 |
| Uniswap | ETH | V2, V3 | 以太坊主流 DEX |
| PancakeSwap | BSC | V2, V3 | BSC 主流 DEX |
| SushiSwap | ETH, BSC, Polygon | V2 | 多链支持的 DEX |
| SunSwap | TRX | V2 | 波场主流 DEX |
| QuickSwap | Polygon | V2, V3 | Polygon 主流 DEX |

**健康状态指示**:
| 状态 | 图标 | 说明 |
|------|------|------|
| 正常 | 🟢 | RPC 连接正常，合约可用 |
| 异常 | 🔴 | RPC 连接失败或合约异常 |
| 未知 | ⚪ | 尚未检测 |

#### 1.2 添加/编辑 DEX

**UI 组件**:
- **Modal**: 对话框
- **Form**: 配置表单

**配置表单**:
```
┌────────────────────────────────────────┐
│  添加 DEX                         [×]  │
├────────────────────────────────────────┤
│                                        │
│  DEX 名称 *                            │
│  [________________________]            │
│                                        │
│  区块链 *                              │
│  [ETH              ▼]                 │
│                                        │
│  路由合约地址 *                        │
│  [0x________________________]         │
│                                        │
│  工厂合约地址                          │
│  [0x________________________]         │
│                                        │
│  Quoter 合约地址 (V3)                  │
│  [0x________________________]         │
│                                        │
│  协议版本 *                            │
│  [○ V2 (UniswapV2)]                   │
│  [○ V3 (UniswapV3)]                   │
│                                        │
│  优先级 *                              │
│  [1          ] (数字越小优先级越高)    │
│                                        │
│  备注                                  │
│  [________________________]            │
│                                        │
│  [○ 启用] [○ 禁用]                    │
│                                        │
│         [取消]    [保存]               │
│                                        │
└────────────────────────────────────────┘
```

**验证规则**:
| 字段 | 验证规则 | 错误提示 |
|------|----------|----------|
| DEX 名称 | 必填，2-50 字符 | "请输入 DEX 名称" |
| 区块链 | 必选 | "请选择区块链" |
| 路由合约 | 必填，有效地址格式 | "请输入有效的合约地址" |
| 优先级 | 必填，1-10 | "优先级范围 1-10" |

---

### 2. 汇率与费率配置

**功能描述**: 配置交易所汇率系数和平台费率

**用户角色**: Admin

**页面路径**: `/admin/swap` → DEX 管理 Tab 内的配置区域

#### 2.1 汇率系数配置

**配置界面**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 汇率配置                                              [保存配置] │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ 交易所汇率系数                                                   │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │                                                              │ │
│ │ 汇率系数: [100]%                                            │ │
│ │ (100% 表示使用交易所原始汇率，低于100%表示用户获得更优汇率)  │ │
│ │                                                              │ │
│ │ 示例: 设置 99.5% 时，用户兑换 1000 USDT                      │ │
│ │ 原始可得: 0.5 ETH → 实际可得: 0.5025 ETH                    │ │
│ │                                                              │ │
│ └──────────────────────────────────────────────────────────────┘ │
│                                                                  │
│ 平台服务费                                                       │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │                                                              │ │
│ │ 服务费类型: [○ 无服务费] [● 固定比例] [○ 阶梯费率]         │ │
│ │                                                              │ │
│ │ 服务费率: [0.3]%                                            │ │
│ │ (从兑换金额中扣除)                                          │ │
│ │                                                              │ │
│ └──────────────────────────────────────────────────────────────┘ │
│                                                                  │
│ 第三方 API 状态                                                  │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │                                                              │ │
│ │ 1inch API:      🟢 已连接    [测试连接]                     │ │
│ │ Uniswap API:    🟢 已连接    [测试连接]                     │ │
│ │ PancakeSwap:    🔴 连接失败  [重试]                         │ │
│ │                                                              │ │
│ │ 最后检测时间: 2025-12-10 14:30:00                          │ │
│ │                                                              │ │
│ └──────────────────────────────────────────────────────────────┘ │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

#### 2.2 测试执行

**功能描述**: 在不实际执行交易的情况下测试 Swap 配置

**测试执行对话框**:
```
┌────────────────────────────────────────┐
│  测试 Swap 执行                    [×]  │
├────────────────────────────────────────┤
│                                        │
│  选择 DEX *                            │
│  [Uniswap V3      ▼]                  │
│                                        │
│  卖出 Token *                          │
│  [USDT           ▼] [1000        ]    │
│                                        │
│  买入 Token *                          │
│  [ETH            ▼]                   │
│                                        │
│  [执行测试查询]                        │
│                                        │
│  ─────────────────────────────────────  │
│  测试结果:                             │
│  ┌──────────────────────────────────┐  │
│  │ 预计获得: 0.4985 ETH             │  │
│  │ 汇率: 1 ETH = 2006 USDT          │  │
│  │ 价格影响: 0.15%                  │  │
│  │ 路由路径: USDT → WETH → ETH      │  │
│  │ 预估 Gas: 0.003 ETH ($6.00)      │  │
│  │ 状态: ✓ 查询成功                 │  │
│  └──────────────────────────────────┘  │
│                                        │
│         [关闭]                         │
│                                        │
└────────────────────────────────────────┘
```

---

### 3. 滑点配置

**功能描述**: 配置 Swap 交易的滑点规则

**用户角色**: Admin

**页面路径**: `/admin/swap` → 滑点配置 Tab

#### 2.1 滑点设置

**UI 组件**:
- **Card**: 配置卡片
- **Radio**: 预设选项
- **Slider**: 自定义滑点滑块
- **InputNumber**: 数值输入

**配置界面**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 滑点配置                                              [保存配置] │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ 默认滑点设置                                                     │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │                                                              │ │
│ │ 预设选项 (用户可选)                                          │ │
│ │ [  0.5%  ]  [  1%  ]  [  3%  ]  [自定义]                    │ │
│ │                                                              │ │
│ │ 默认值: 0.5%                                                 │ │
│ │                                                              │ │
│ │ 用户自定义范围:                                              │ │
│ │ 最小: [0.1]%    最大: [50]%                                 │ │
│ │                                                              │ │
│ │ ⚠️ 滑点过高可能导致用户损失，建议最大不超过 50%              │ │
│ │                                                              │ │
│ └──────────────────────────────────────────────────────────────┘ │
│                                                                  │
│ 交易截止时间                                                     │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │                                                              │ │
│ │ 默认交易截止时间: [20] 分钟                                  │ │
│ │                                                              │ │
│ │ 用户可选范围: [1] - [60] 分钟                               │ │
│ │                                                              │ │
│ └──────────────────────────────────────────────────────────────┘ │
│                                                                  │
│ 高级设置                                                        │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │                                                              │ │
│ │ Gas 价格策略:                                                │ │
│ │ [○ 标准]  [○ 快速]  [○ 用户自定义]                         │ │
│ │                                                              │ │
│ │ 价格影响警告阈值: [5]%                                      │ │
│ │ (超过此阈值时向用户显示警告)                                │ │
│ │                                                              │ │
│ └──────────────────────────────────────────────────────────────┘ │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

#### 2.2 滑点预设管理

**UI 组件**:
- **Table**: 预设列表
- **Button**: 添加预设

**预设选项表**:
| 预设值 | 显示标签 | 推荐场景 | 是否默认 |
|--------|----------|----------|----------|
| 0.5% | 0.5% | 稳定币交易 | ✓ |
| 1% | 1% | 常规交易 | |
| 3% | 3% | 波动较大的代币 | |

---

### 4. 兑换历史

**功能描述**: 查看用户的 Swap 交易历史记录

**用户角色**: Admin

**页面路径**: `/admin/swap` → 兑换历史 Tab

#### 4.1 兑换记录筛选

**UI 组件**:
- **Select**: 链、状态筛选
- **DatePicker.RangePicker**: 日期范围
- **Input**: 用户 UID 搜索

**筛选条件**:
| 字段 | 组件 | 选项 |
|------|------|------|
| 链 | Select | 全部、TRX、ETH、BSC、Polygon |
| DEX | Select | 全部、Uniswap、PancakeSwap、QuickSwap... |
| 状态 | Select | 全部、成功、失败、处理中 |
| 日期范围 | RangePicker | 交易时间 |
| 用户UID | Input | 搜索指定用户 |

#### 4.2 兑换记录列表

**表格列**:
| 列名 | 字段 | 说明 |
|------|------|------|
| 交易ID | swap_id | Swap 记录 ID |
| 用户 | user_id | 用户 UID |
| From | from_token | 卖出代币和数量 |
| To | to_token | 买入代币和数量 |
| DEX | dex | 使用的 DEX |
| 滑点 | slippage | 实际滑点 |
| 状态 | status | 交易状态 |
| 时间 | created_at | 交易时间 |
| 操作 | - | 查看详情 |

**状态标签**:
| 状态 | 颜色 | 说明 |
|------|------|------|
| success | 绿色 | 兑换成功 |
| failed | 红色 | 兑换失败 |
| pending | 蓝色 | 处理中 |

#### 4.3 兑换详情

**详情抽屉**:
```
┌────────────────────────────────────────┐
│  Swap 详情                        [×]  │
├────────────────────────────────────────┤
│                                        │
│  交易信息                              │
│  ┌──────────────────────────────────┐  │
│  │ 交易ID:     SWAP001              │  │
│  │ 用户UID:    10001                │  │
│  │ 交易时间:   2025-12-10 14:30     │  │
│  │ 状态:       成功 ✓               │  │
│  └──────────────────────────────────┘  │
│                                        │
│  兑换详情                              │
│  ┌──────────────────────────────────┐  │
│  │ 卖出:       1,000 USDT           │  │
│  │ 买入:       2.5 ETH              │  │
│  │ 汇率:       1 ETH = 400 USDT     │  │
│  │ 滑点设置:   0.5%                 │  │
│  │ 实际滑点:   0.32%                │  │
│  │ 价格影响:   0.12%                │  │
│  └──────────────────────────────────┘  │
│                                        │
│  DEX 信息                              │
│  ┌──────────────────────────────────┐  │
│  │ DEX:        Uniswap V3           │  │
│  │ 链:         ETH                  │  │
│  │ 路由路径:   USDT → WETH → ETH    │  │
│  └──────────────────────────────────┘  │
│                                        │
│  链上信息                              │
│  ┌──────────────────────────────────┐  │
│  │ 交易哈希:   0x3a7b...   [复制]   │  │
│  │ Gas 费用:   0.005 ETH ($2.00)    │  │
│  │ 区块高度:   12345678             │  │
│  │ [在浏览器中查看 ↗]               │  │
│  └──────────────────────────────────┘  │
│                                        │
└────────────────────────────────────────┘
```

---

## UI 组件列表

| 组件名称 | 类型 | 功能说明 |
|----------|------|----------|
| DexTable | Table | DEX 列表表格 |
| DexModal | Modal | DEX 配置对话框 |
| SlippageConfig | Card | 滑点配置卡片 |
| PresetManager | Custom | 预设管理组件 |
| SwapHistoryTable | Table | 兑换历史表格 |
| SwapDetailDrawer | Drawer | 兑换详情抽屉 |
| HealthIndicator | Badge | 健康状态指示器 |
| ContractLink | Link | 合约地址链接 |

---

## 状态与交互

### 页面状态

| 状态 | 描述 | UI 表现 |
|------|------|---------|
| Loading | 数据加载中 | 显示骨架屏 |
| Empty | 无数据 | 显示空状态 |
| Saving | 保存配置中 | 按钮显示 Loading |

### 用户操作响应

| 操作 | 成功响应 | 失败响应 |
|------|----------|----------|
| 添加 DEX | Toast "DEX 添加成功" | Alert 显示错误 |
| 编辑 DEX | Toast "配置已保存" | Alert 显示错误 |
| 启用/禁用 DEX | Toast "状态已更新" | Alert 显示错误 |
| 保存滑点配置 | Toast "滑点配置已保存" | Alert 显示错误 |

---

## 权限控制

| 功能 | Admin | Finance |
|------|-------|---------|
| 查看 DEX 列表 | ✓ | - |
| 添加/编辑 DEX | ✓ | - |
| 启用/禁用 DEX | ✓ | - |
| 配置滑点规则 | ✓ | - |
| 查看兑换历史 | ✓ | - |

---

## 安全注意事项

### DEX 合约验证

1. **地址格式验证**: 验证合约地址格式正确
2. **合约存在性**: 检查链上合约是否存在
3. **合约接口**: 验证合约实现预期接口
4. **官方地址**: 建议使用官方文档提供的地址

### 滑点风险提示

1. **高滑点警告**: 滑点超过 5% 时显示警告
2. **价格影响**: 显示预估价格影响
3. **用户确认**: 高风险交易需二次确认

---

> 返回 [后台管理前端目录](./README.md)
