# 转账管理 / 数据模型与字段

> 返回 [转账管理索引](../11-转账管理.md)

---

## 概述

本文档定义转账管理模块的核心数据模型，重点覆盖薪资发放场景所需的员工信息、薪资明细、发放周期等字段。

---

## 1. 基础数据模型

### 1.1 转账用户（通用）

```typescript
interface TransferUser {
  uid: string;                // 用户UID（系统内唯一标识）
  phone: string;              // 手机号
  email: string;              // 邮箱
  amount: number;             // 转账金额
  currency: string;           // 币种
  transferStatus?: '待发放' | '发放中' | '已发放' | '失败';  // 发放状态
  txHash?: string;            // 交易哈希
  transferTime?: string;      // 发放时间
  failReason?: string;        // 失败原因
}
```

### 1.2 转账批次（通用）

```typescript
interface TransferBatch {
  id: string;                 // 批次ID
  name: string;               // 批次名称
  type: 'transfer' | 'payroll';  // 批次类型
  createTime: string;         // 创建时间
  executeTime?: string;       // 执行时间
  totalUsers: number;         // 用户总数
  totalAmount: number;        // 总金额
  currency: string;           // 币种
  status: BatchStatus;        // 批次状态
  users: TransferUser[];      // 用户列表
  successCount?: number;      // 成功数量
  failedCount?: number;       // 失败数量
  createdBy: string;          // 创建人ID
  createdByName: string;      // 创建人姓名
}
```

---

## 2. 薪资发放扩展模型

### 2.1 薪资用户（扩展 TransferUser）

```typescript
interface PayrollUser extends TransferUser {
  // ═══════════════════════════════════════════════════════════
  // 员工身份信息
  // ═══════════════════════════════════════════════════════════
  employeeId: string;              // 员工工号（HR系统标识）
  employeeName: string;            // 员工姓名
  position?: string;               // 职位（可选）

  // ═══════════════════════════════════════════════════════════
  // 薪资明细（可选，用于明细展示）
  // ═══════════════════════════════════════════════════════════
  baseSalary?: number;             // 基本工资
  bonuses?: number;                // 奖金
  allowances?: number;             // 补贴（含餐补、交通、住房等）
  deductions?: number;             // 扣款（含社保、公积金、个税等）
  netPay: number;                  // 实发金额 = 基本 + 奖金 + 补贴 - 扣款

  // ═══════════════════════════════════════════════════════════
  // 发放周期
  // ═══════════════════════════════════════════════════════════
  payPeriod: string;               // 薪资周期，格式: "YYYY-MM"（如 "2025-12"）
  payDate?: string;                // 计划发放日期
}
```

### 2.2 薪资批次（扩展 TransferBatch）

```typescript
interface PayrollBatch extends TransferBatch {
  type: 'payroll';                 // 固定为 payroll

  // ═══════════════════════════════════════════════════════════
  // 薪资周期信息
  // ═══════════════════════════════════════════════════════════
  payPeriod: string;               // 薪资周期，格式: "YYYY-MM"
  payDate: string;                 // 计划发放日期

  // ═══════════════════════════════════════════════════════════
  // 审批信息
  // ═══════════════════════════════════════════════════════════
  approvalStatus: ApprovalStatus;  // 审批状态
  currentApprovalLevel: number;    // 当前审批级别 (1/2/3)
  approvalHistory: ApprovalRecord[]; // 审批历史

  users: PayrollUser[];            // 薪资用户列表
}
```

---

## 3. 状态枚举定义

### 3.1 批次状态

```typescript
type BatchStatus =
  | '草稿'           // 新建未提交
  | '待一级审批'     // 已提交，等待HR审批
  | '待二级审批'     // HR已通过，等待财务审批
  | '待三级审批'     // 财务已通过，等待CFO审批（大额）
  | '待执行'         // 审批完成，等待执行
  | '执行中'         // 正在执行转账
  | '已完成'         // 全部完成
  | '部分完成'       // 部分成功，存在失败
  | '失败';          // 全部失败
```

### 3.2 审批状态

```typescript
type ApprovalStatus =
  | 'pending'        // 待审批
  | 'approved'       // 已通过
  | 'rejected'       // 已驳回
  | 'cancelled';     // 已取消
```

### 3.3 用户发放状态

```typescript
type TransferStatus =
  | '待发放'         // 等待执行
  | '发放中'         // 正在处理
  | '已发放'         // 转账成功
  | '失败';          // 转账失败
```

---

## 4. 辅助数据结构

### 4.1 审批记录

```typescript
interface ApprovalRecord {
  level: number;                   // 审批级别
  approverRole: string;            // 审批人角色
  approverId: string;              // 审批人ID
  approverName: string;            // 审批人姓名
  action: 'approve' | 'reject';    // 审批动作
  comments?: string;               // 审批意见
  timestamp: string;               // 审批时间
}
```

## 5. 字段定义表（薪资发放）

### 5.1 员工信息字段

| 字段名 | 字段标识 | 类型 | 必填 | 说明 | 示例 |
|--------|----------|------|------|------|------|
| 员工工号 | employeeId | string | 是 | HR系统中的员工唯一标识 | EMP001 |
| 员工姓名 | employeeName | string | 是 | 员工真实姓名 | 张三 |
| 职位 | position | string | 否 | 职位/岗位名称 | 高级工程师 |
| 用户UID | uid | string | 是 | 钱包系统内用户ID | 10001 |
| 手机号 | phone | string | 否 | 用于验证身份 | 138****1234 |
| 邮箱 | email | string | 否 | 用于通知（可选） | zhang@example.com |

### 5.2 薪资明细字段

| 字段名 | 字段标识 | 类型 | 必填 | 说明 | 示例 |
|--------|----------|------|------|------|------|
| 基本工资 | baseSalary | number | 否 | 固定薪资部分 | 20000.00 |
| 奖金 | bonuses | number | 否 | 绩效奖金、项目奖金等 | 5000.00 |
| 补贴 | allowances | number | 否 | 餐补、交通、住房等 | 2000.00 |
| 扣款 | deductions | number | 否 | 社保、公积金、个税等 | 3500.00 |
| 实发金额 | netPay | number | 是 | 最终发放金额 | 23500.00 |
| 币种 | currency | string | 是 | 发放币种 | USDT |

### 5.3 周期与时间字段

| 字段名 | 字段标识 | 类型 | 必填 | 说明 | 示例 |
|--------|----------|------|------|------|------|
| 薪资周期 | payPeriod | string | 是 | 格式 YYYY-MM | 2025-12 |
| 计划发放日 | payDate | string | 否 | ISO 8601 格式 | 2025-12-15 |
| 创建时间 | createTime | string | 自动 | 批次创建时间戳 | 2025-12-10T10:00:00Z |
| 执行时间 | executeTime | string | 自动 | 实际执行时间戳 | 2025-12-15T14:30:00Z |

---

## 6. 字段校验规则

| 字段 | 校验规则 | 错误代码 | 错误提示 |
|------|----------|----------|----------|
| employeeId | 非空，长度 1-50 | E_EMP_ID_REQUIRED | 员工工号不能为空 |
| employeeName | 非空，长度 1-100 | E_EMP_NAME_REQUIRED | 员工姓名不能为空 |
| uid | 非空，系统内存在 | E_UID_NOT_FOUND | 用户UID不存在 |
| netPay | 大于 0，≤ 单笔限额 | E_AMOUNT_INVALID | 实发金额无效 |
| payPeriod | 格式 YYYY-MM | E_PERIOD_FORMAT | 薪资周期格式错误 |
| currency | 系统支持的币种 | E_CURRENCY_INVALID | 不支持的币种 |

---

## 7. 批次类型对比

| 特性 | 普通转账 (transfer) | 薪资发放 (payroll) |
|------|---------------------|-------------------|
| 用户模型 | TransferUser | PayrollUser |
| 员工信息 | 不需要 | 必填（工号、姓名） |
| 薪资明细 | 不支持 | 可选（基本、奖金、补贴、扣款） |
| 发放周期 | 不需要 | 必填（payPeriod） |
| 审批流程 | 单级确认 | 多级审批（1-3级） |
| 审计级别 | 基础 | 完整 |
| 周期校验 | 无 | 防止同周期重复发放 |

---

> 返回 [转账管理索引](../11-转账管理.md) | 下一篇：[审批流程](./02-审批流程.md)
