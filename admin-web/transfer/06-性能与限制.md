# 转账管理 / 性能与限制

> 返回 [转账管理索引](../11-转账管理.md)

---

## 概述

本文档定义薪资发放模块的性能指标、系统限制和大批量处理的最佳实践。针对 1,000+ 员工的企业级薪资发放场景进行优化。

---

## 1. 系统限制

### 1.1 批次限制

| 限制项 | 默认值 | 最大值 | 说明 |
|--------|--------|--------|------|
| 单批次最大记录数 | 5,000 条 | 10,000 条 | 超过需拆分批次 |
| 单批次最大金额 | 10,000,000 USDT | 50,000,000 USDT | 需 CFO 审批 |
| 单笔最大金额 | 100,000 USDT | 500,000 USDT | 需特殊审批 |
| 单笔最小金额 | 1 USDT | - | 低于此值警告 |
| 同时执行批次数 | 3 个 | 5 个 | 避免资源竞争 |

### 1.2 文件限制

| 限制项 | 默认值 | 说明 |
|--------|--------|------|
| 导入文件最大大小 | 10 MB | 约支持 50,000 行 |
| 导入文件格式 | .xlsx, .xls | 不支持 .csv 直接导入 |
| 单文件最大行数 | 50,000 行 | 含表头 |
| 单文件最大列数 | 50 列 | 含扩展字段 |

### 1.3 时间限制

| 限制项 | 默认值 | 说明 |
|--------|--------|------|
| 批次审批超时 | 72 小时 | 超时自动提醒 |
| 批次执行超时 | 24 小时 | 超时自动暂停 |
| 单笔交易确认超时 | 30 分钟 | 超时标记待确认 |
| 导入会话超时 | 30 分钟 | 超时需重新上传 |

---

## 2. 性能指标

### 2.1 处理速度

| 操作 | 预期速度 | 说明 |
|------|----------|------|
| Excel 解析 | 1,000 行/秒 | 含验证 |
| 批次创建 | 5,000 条/秒 | 数据库写入 |
| 转账执行 | 10-50 笔/分钟 | 取决于链上拥堵 |
| 批量审批 | 即时 | < 1 秒 |

### 2.2 1,000+ 员工批次处理时间估算

| 员工数量 | 导入解析 | 审批流程 | 执行时间 | 总时间 |
|----------|----------|----------|----------|--------|
| 1,000 人 | ~1 分钟 | 人工决定 | 20-100 分钟 | 约 2 小时 |
| 2,000 人 | ~2 分钟 | 人工决定 | 40-200 分钟 | 约 4 小时 |
| 5,000 人 | ~5 分钟 | 人工决定 | 100-500 分钟 | 约 10 小时 |

> **注意**: 执行时间主要取决于区块链网络状况，高峰期可能更长。

### 2.3 并发处理

```
┌─────────────────────────────────────────────────────────────┐
│  批次执行架构                                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────┐    ┌─────────────────────────────────────┐    │
│  │ 批次队列 │ →  │ 执行引擎 (并发处理)                  │    │
│  └─────────┘    │                                     │    │
│                 │  ┌─────────┐ ┌─────────┐ ┌─────────┐│    │
│                 │  │Worker 1 │ │Worker 2 │ │Worker 3 ││    │
│                 │  │ 10笔/分 │ │ 10笔/分 │ │ 10笔/分 ││    │
│                 │  └─────────┘ └─────────┘ └─────────┘│    │
│                 │                                     │    │
│                 │  总吞吐量: 30 笔/分钟               │    │
│                 └─────────────────────────────────────┘    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 进度追踪

### 3.1 执行进度界面

```
┌────────────────────────────────────────────────────────────────┐
│  批次执行进度 - P202512001                                     │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  批次信息                                                      │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 批次名称:   2025年12月工资                               │  │
│  │ 总记录数:   1,256 条                                     │  │
│  │ 总金额:     2,512,000.00 USDT                            │  │
│  │ 开始时间:   2025-12-15 14:00:00                          │  │
│  │ 预计完成:   2025-12-15 15:30:00                          │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│  执行进度                                                      │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ ████████████████████████████████░░░░░░░░░░  71%          │  │
│  │                                                          │  │
│  │ 已处理: 892/1,256                                        │  │
│  │ 成功:   888 (99.6%)                                      │  │
│  │ 失败:   4 (0.4%)                                         │  │
│  │ 处理中: 3                                                │  │
│  │ 待处理: 361                                              │  │
│  │                                                          │  │
│  │ 处理速度: 28 笔/分钟                                     │  │
│  │ 剩余时间: 约 13 分钟                                     │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│  [暂停执行]    [查看失败记录]    [刷新]                        │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### 3.2 进度通知

| 进度节点 | 通知方式 | 通知内容 |
|----------|----------|----------|
| 开始执行 | 系统消息 | 批次开始执行 |


---

## 4. 大批量处理最佳实践

### 4.1 批次拆分策略

| 员工规模 | 建议拆分 | 说明 |
|----------|----------|------|
| < 1,000 人 | 不拆分 | 单批次处理 |
| 1,000-3,000 人 | 按批次容量拆分 | 2-3 个批次 |
| 3,000-5,000 人 | 按批次容量+金额拆分 | 3-5 个批次 |
| > 5,000 人 | 必须拆分 | 每批次 ≤ 2,000 人 |

### 4.2 执行时间规划

| 时间段 | 建议 | 原因 |
|--------|------|------|
| 工作日 9:00-18:00 | 不建议 | 链上交易高峰 |
| 工作日 22:00-06:00 | 推荐 | 链上交易低谷 |
| 周末 | 推荐 | 交易量较少 |
| 月末最后3天 | 避免 | 各企业发薪高峰 |

### 4.3 资金准备

| 检查项 | 建议 | 说明 |
|--------|------|------|
| Vault 余额 | 批次金额 × 1.1 | 预留 10% 缓冲 |
| 热钱包 Gas | 批次笔数 × 单笔 Gas × 2 | 预留双倍 Gas |
| 备用资金 | 批次金额 × 0.05 | 应对重试需求 |

---

## 5. 监控与告警

### 5.1 监控指标

| 指标 | 正常范围 | 告警阈值 | 说明 |
|------|----------|----------|------|
| 处理速度 | 20-50 笔/分 | < 10 笔/分 | 链上拥堵 |
| 失败率 | < 1% | > 5% | 需人工干预 |
| 队列积压 | < 100 笔 | > 500 笔 | 处理能力不足 |
| Vault 余额 | > 批次金额 | < 批次金额 × 0.5 | 资金不足 |
| 热钱包 Gas | > 0.1 ETH | < 0.05 ETH | Gas 不足 |

### 5.2 监控面板

```
┌────────────────────────────────────────────────────────────────┐
│  系统监控 - 转账模块                                           │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  实时指标                                                      │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 处理速度     ████████████████░░░░  32 笔/分 (正常)       │  │
│  │ 失败率       ██░░░░░░░░░░░░░░░░░░  0.4% (正常)           │  │
│  │ 队列积压     ████░░░░░░░░░░░░░░░░  45 笔 (正常)          │  │
│  │ Vault余额    ████████████████████  5,000,000 USDT (充足) │  │
│  │ 热钱包Gas    ████████████░░░░░░░░  0.15 ETH (正常)       │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│  活跃批次                                                      │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ │批次ID      │名称          │进度    │速度    │状态    │ │  │
│  │ ├────────────┼──────────────┼────────┼────────┼────────┤ │  │
│  │ │P202512001  │12月工资-批次A│71%     │32笔/分 │执行中  │ │  │
│  │ │P202512002  │12月工资-批次B│等待中  │-       │队列中  │ │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

---

## 6. 配置参数

### 6.1 可配置参数

| 参数 | 默认值 | 范围 | 说明 |
|------|--------|------|------|
| `batch.maxRecords` | 5,000 | 1,000-10,000 | 单批次最大记录数 |
| `batch.maxAmount` | 10,000,000 | 1,000,000-50,000,000 | 单批次最大金额 |
| `batch.concurrentWorkers` | 3 | 1-10 | 并发执行线程数 |
| `transfer.maxSingleAmount` | 100,000 | 10,000-500,000 | 单笔最大金额 |
| `transfer.retryCount` | 3 | 1-10 | 自动重试次数 |
| `transfer.retryInterval` | 30 | 10-300 | 重试间隔(秒) |
| `import.maxFileSize` | 10 | 1-50 | 导入文件最大大小(MB) |
| `approval.timeout` | 72 | 24-168 | 审批超时时间(小时) |

### 6.2 配置界面

```
┌────────────────────────────────────────────────────────────────┐
│  转账模块配置                                              [×]  │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  批次限制                                                      │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 单批次最大记录数:  [5000    ] 条                         │  │
│  │ 单批次最大金额:    [10000000] USDT                       │  │
│  │ 并发执行线程数:    [3       ]                            │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│  转账限制                                                      │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 单笔最大金额:      [100000  ] USDT                       │  │
│  │ 自动重试次数:      [3       ] 次                         │  │
│  │ 重试间隔:          [30      ] 秒                         │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│  其他设置                                                      │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 导入文件最大大小:  [10      ] MB                         │  │
│  │ 审批超时时间:      [72      ] 小时                       │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│         [恢复默认]    [取消]    [保存]                         │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

---

## 7. 对应后端接口（参考）

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/v1/admin/transfer/config` | GET | 获取配置参数 |
| `/api/v1/admin/transfer/config` | PUT | 更新配置参数 |
| `/api/v1/admin/transfer/monitor` | GET | 获取监控指标 |
| `/api/v1/admin/transfer/monitor/batches` | GET | 获取活跃批次状态 |

---

> 返回 [转账管理索引](../11-转账管理.md) | 上一篇：[审计日志](./05-审计日志.md)
