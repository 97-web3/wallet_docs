# 报表与导出

> 返回 [后台管理前端目录](./README.md)

---

## 页面概述

- **页面路径**: `/admin/reports`
- **权限要求**: Admin / Finance（根据报表类型）
- **主要功能**: 交易报表生成、对账报表导出、数据分析图表、定时报表配置

---

## 页面布局

### 报表中心主页面结构

```
┌──────────────────────────────────────────────────────────────────────────┐
│  Header                                                                   │
├──────────┬───────────────────────────────────────────────────────────────┤
│          │  Breadcrumb: 首页 / 报表中心                                   │
│  Sidebar ├───────────────────────────────────────────────────────────────┤
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ Tab 切换                                                  │ │
│          │  │ [交易报表] [对账报表] [统计分析] [定时报表] [导出记录]   │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  ════════════════════════════════════════════════════════════ │
│          │                                                                │
│          │  [交易报表] Tab 内容:                                         │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ 筛选条件                                                  │ │
│          │  │ [日期范围][链][类型][用户UID][状态]        [查询][重置]  │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ 数据汇总                                      [导出报表] │ │
│          │  │ 总交易数: 1,234  |  总金额: $500,000  |  成功率: 98.5%   │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ 交易数据表格                                              │ │
│          │  │ │日期  │类型│链  │数量│金额    │手续费│状态  │         │ │
│          │  │ ├──────┼────┼────┼────┼────────┼──────┼──────┤         │ │
│          │  │ │12-10 │充值│ETH │125 │$50,000 │$100  │成功  │         │ │
│          │  │ │12-10 │提现│TRX │89  │$30,000 │$50   │成功  │         │ │
│          │  │ ...                                                       │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
│          │  ┌──────────────────────────────────────────────────────────┐ │
│          │  │ Pagination: [<] 1 2 3 ... 10 [>]     每页 [20] 条        │ │
│          │  └──────────────────────────────────────────────────────────┘ │
│          │                                                                │
└──────────┴───────────────────────────────────────────────────────────────┘
```

---

## 功能模块

### 1. 交易报表

**功能描述**: 生成各类交易的汇总报表

**用户角色**: Admin, Finance

**页面路径**: `/admin/reports` → 交易报表 Tab

#### 1.1 报表类型选择

**UI 组件**:
- **Select**: 报表类型下拉选择
- **Radio**: 快捷时间范围

**报表类型**:
| 类型 | 说明 | 包含数据 |
|------|------|----------|
| 充值报表 | 充值交易汇总 | 充值笔数、金额、手续费 |
| 提现报表 | 提现交易汇总 | 提现笔数、金额、手续费 |
| 综合报表 | 所有交易汇总 | 全部类型交易数据 |
| Swap 报表 | 兑换交易汇总 | 兑换笔数、滑点统计 |

**时间范围预设**:
| 选项 | 范围 |
|------|------|
| 今日 | 当天 00:00 - 当前 |
| 本周 | 本周一 - 当前 |
| 本月 | 本月 1 日 - 当前 |
| 自定义 | 用户选择日期范围 |

#### 1.2 筛选条件配置

**筛选表单**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 报表筛选条件                                                      │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ 日期范围 *                           报表类型 *                  │
│ [2025-12-01] - [2025-12-10]         [综合报表         ▼]        │
│                                                                  │
│ 区块链                              交易状态                     │
│ [全部          ▼]                   [全部             ▼]        │
│                                                                  │
│ 用户 UID                            金额范围                     │
│ [________________]                   [___] - [___] USDT          │
│                                                                  │
│ 币种                                                            │
│ [☑ 全部] [☑ USDT] [☑ ETH] [☑ TRX] [☑ BNB]                      │
│                                                                  │
│              [重置条件]    [生成报表]                            │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

**筛选字段说明**:
| 字段 | 组件 | 说明 |
|------|------|------|
| 日期范围 | DatePicker.RangePicker | 必选，最长 90 天 |
| 报表类型 | Select | 必选 |
| 区块链 | Select | 可选，默认全部 |
| 交易状态 | Select | 成功/失败/全部 |
| 用户 UID | Input | 可选，指定用户 |
| 金额范围 | InputNumber | 可选，USDT 计价 |
| 币种 | Checkbox.Group | 可多选 |

#### 1.3 报表数据展示

**数据汇总卡片**:
```
┌────────────────────────────────────────────────────────────────┐
│ 汇总数据                                                        │
│                                                                │
│ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────┐│
│ │  交易总数     │ │  交易总额     │ │  手续费总计   │ │ 成功率   ││
│ │    1,234     │ │  $500,000    │ │   $2,500     │ │  98.5%   ││
│ │  ↑ 12.5%     │ │  ↑ 8.3%      │ │   ↓ 2.1%     │ │  ↑ 0.5%  ││
│ └──────────────┘ └──────────────┘ └──────────────┘ └──────────┘│
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

**数据表格列**:
| 列名 | 字段 | 说明 |
|------|------|------|
| 日期 | date | 交易日期 |
| 类型 | type | 充值/提现/Swap |
| 链 | chain | 区块链 |
| 笔数 | count | 交易笔数 |
| 金额 | amount | 交易金额 |
| 手续费 | fee | 手续费总计 |
| 成功数 | success_count | 成功笔数 |
| 失败数 | failed_count | 失败笔数 |

---

### 2. 对账报表

**功能描述**: 生成链上与账本对账报表

**用户角色**: Admin, Finance

**页面路径**: `/admin/reports` → 对账报表 Tab

#### 2.1 对账类型

**UI 组件**:
- **Card**: 对账类型选择卡片
- **Button**: 开始对账按钮

**对账类型卡片**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 选择对账类型                                                      │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ ┌────────────────────┐  ┌────────────────────┐                  │
│ │  📊 日终对账        │  │  📋 Vault 对账      │                  │
│ │                    │  │                    │                  │
│ │  每日交易账本与    │  │  Vault 余额与       │                  │
│ │  链上数据对账      │  │  链上余额核对       │                  │
│ │                    │  │                    │                  │
│ │  [开始对账]        │  │  [开始对账]        │                  │
│ └────────────────────┘  └────────────────────┘                  │
│                                                                  │
│ ┌────────────────────┐  ┌────────────────────┐                  │
│ │  🔍 差异核查        │  │  📅 历史对账记录    │                  │
│ │                    │  │                    │                  │
│ │  对账差异明细      │  │  查看历史对账      │                  │
│ │  和处理状态        │  │  报表和结果        │                  │
│ │                    │  │                    │                  │
│ │  [查看差异]        │  │  [查看记录]        │                  │
│ └────────────────────┘  └────────────────────┘                  │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

#### 2.2 日终对账

**对账流程界面**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 日终对账                                                     [×] │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ 对账日期 *                                                       │
│ [2025-12-09    📅]                                              │
│                                                                  │
│ 对账范围                                                         │
│ [○ 全部链]  [○ 指定链]                                          │
│                                                                  │
│ 指定链 (多选)                                                    │
│ [☐ ETH] [☐ TRX] [☐ BSC]                                        │
│                                                                  │
│ ─────────────────────────────────────────────────────────────── │
│                                                                  │
│ 对账进度                                                         │
│ ┌──────────────────────────────────────────────────────────────┐│
│ │ ETH 链:  [████████████████████] 100%  ✓ 完成                ││
│ │ TRX 链:  [████████████░░░░░░░░]  60%  处理中...             ││
│ │ BSC 链:  [░░░░░░░░░░░░░░░░░░░░]   0%  等待中                ││
│ └──────────────────────────────────────────────────────────────┘│
│                                                                  │
│ 对账结果预览                                                     │
│ ┌──────────────────────────────────────────────────────────────┐│
│ │ 链   │账本记录│链上记录│匹配数│差异数│差异金额              ││
│ │ ETH  │ 1,234  │ 1,234  │1,232 │  2   │ $150.00              ││
│ │ TRX  │ 处理中...                                             ││
│ │ BSC  │ -                                                     ││
│ └──────────────────────────────────────────────────────────────┘│
│                                                                  │
│              [取消]    [导出报表]                                │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

#### 2.3 对账差异处理

**差异列表表格**:
| 列名 | 字段 | 说明 |
|------|------|------|
| 差异ID | diff_id | 差异记录 ID |
| 日期 | date | 对账日期 |
| 链 | chain | 区块链 |
| 类型 | type | 差异类型 |
| 账本金额 | ledger_amount | 账本记录金额 |
| 链上金额 | chain_amount | 链上实际金额 |
| 差异金额 | diff_amount | 差异值 |
| 状态 | status | 处理状态 |
| 操作 | - | 处理、查看 |

**差异类型**:
| 类型 | 说明 | 建议操作 |
|------|------|----------|
| 账本多记 | 账本有记录但链上无 | 核查后冲账 |
| 账本少记 | 链上有但账本未记录 | 补记账本 |
| 金额不符 | 双方金额不一致 | 核查后调整 |
| 状态不符 | 状态不一致 | 状态同步 |

**处理状态**:
| 状态 | 颜色 | 说明 |
|------|------|------|
| pending | 黄色 | 待处理 |
| processing | 蓝色 | 处理中 |
| resolved | 绿色 | 已解决 |
| ignored | 灰色 | 已忽略 |

---

### 3. 统计分析

**功能描述**: 可视化图表展示业务数据趋势

**用户角色**: Admin

**页面路径**: `/admin/reports` → 统计分析 Tab

#### 3.1 图表类型

**UI 组件**:
- **Chart**: 各类图表组件
- **DatePicker**: 时间范围选择
- **Radio**: 时间粒度选择

**统计分析页面**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 统计分析                                                          │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ 时间范围: [最近7天 ▼]  粒度: [○ 天] [○ 周] [○ 月]              │
│                                                                  │
│ ┌──────────────────────────────────────────────────────────────┐│
│ │  交易趋势图                                           [导出] ││
│ │                                                              ││
│ │     ^                                                        ││
│ │  500│      ╭─╮                                               ││
│ │     │    ╭─╯ ╰──╮     充值 ───                               ││
│ │  300│  ╭─╯      ╰─╮   提现 - - -                             ││
│ │     │╭─╯          ╰─╮                                        ││
│ │  100├──────────────────────────────────>                     ││
│ │     12/4 12/5 12/6 12/7 12/8 12/9 12/10                      ││
│ │                                                              ││
│ └──────────────────────────────────────────────────────────────┘│
│                                                                  │
│ ┌───────────────────────────┐ ┌───────────────────────────────┐ │
│ │ 链分布饼图                 │ │ 币种分布饼图                   │ │
│ │                           │ │                               │ │
│ │      ╭───╮                │ │      ╭───╮                    │ │
│ │    ╭─┤TRX├─╮              │ │    ╭─┤USDT├─╮                 │ │
│ │   │ ╰───╯  │              │ │   │ ╰────╯  │                 │ │
│ │  ETH      BSC             │ │  ETH       TRX                │ │
│ │                           │ │                               │ │
│ └───────────────────────────┘ └───────────────────────────────┘ │
│                                                                  │
│ ┌──────────────────────────────────────────────────────────────┐│
│ │ 用户活跃度排行                                       Top 10  ││
│ │                                                              ││
│ │ 1. UID 10001  ████████████████████████ 156 笔               ││
│ │ 2. UID 10025  █████████████████████   142 笔                ││
│ │ 3. UID 10003  ████████████████        125 笔                ││
│ │ ...                                                          ││
│ └──────────────────────────────────────────────────────────────┘│
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

#### 3.2 图表配置

**可选图表类型**:
| 图表 | 类型 | 数据维度 |
|------|------|----------|
| 交易趋势图 | Line | 时间 × 交易数量/金额 |
| 链分布图 | Pie | 各链交易占比 |
| 币种分布图 | Pie | 各币种交易占比 |
| 用户排行 | Bar | 用户交易活跃度 |
| 手续费趋势 | Line | 时间 × 手续费 |
| 成功率趋势 | Line | 时间 × 成功率 |

---

### 4. 定时报表

**功能描述**: 配置自动生成和发送的定时报表

**用户角色**: Admin

**页面路径**: `/admin/reports` → 定时报表 Tab

#### 4.1 定时报表列表

**UI 组件**:
- **Table**: 定时任务列表
- **Button**: 创建任务按钮
- **Switch**: 启用/禁用开关

**列表表格**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 定时报表                                            [创建报表任务] │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ │任务名称      │报表类型│频率  │接收方式│状态  │上次执行│操作  │ │
│ ├──────────────┼────────┼──────┼────────┼──────┼────────┼──────┤ │
│ │日交易汇总    │综合    │每日  │邮件    │已启用│12-10   │[编辑]│ │
│ │周对账报表    │对账    │每周  │邮件    │已启用│12-08   │[编辑]│ │
│ │月度统计      │统计    │每月  │邮件+下载│已禁用│11-30   │[编辑]│ │
│ ...                                                              │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

**表格列说明**:
| 列名 | 字段 | 说明 |
|------|------|------|
| 任务名称 | name | 定时任务名称 |
| 报表类型 | report_type | 生成的报表类型 |
| 频率 | frequency | 执行频率 |
| 接收方式 | delivery | 报表接收方式 |
| 状态 | enabled | 启用/禁用 |
| 上次执行 | last_run | 上次执行时间 |
| 操作 | - | 编辑、删除、立即执行 |

#### 4.2 创建/编辑定时报表

**配置表单**:
```
┌────────────────────────────────────────┐
│ 创建定时报表                      [×]  │
├────────────────────────────────────────┤
│                                        │
│ 任务名称 *                             │
│ [________________________]             │
│                                        │
│ 报表类型 *                             │
│ [交易报表         ▼]                  │
│                                        │
│ 报表范围配置                           │
│ ┌────────────────────────────────────┐ │
│ │ 区块链: [○ 全部] [○ 指定链]        │ │
│ │ 交易类型: [○ 全部] [○ 指定类型]    │ │
│ │ 包含数据: [☑ 明细] [☑ 汇总]        │ │
│ └────────────────────────────────────┘ │
│                                        │
│ 执行频率 *                             │
│ [○ 每日]  [○ 每周]  [○ 每月]         │
│                                        │
│ 执行时间                               │
│ [06:00 ▼] (建议选择非高峰时段)        │
│                                        │
│ 每周执行日 (仅每周)                    │
│ [☐ 一][☐ 二][☐ 三][☐ 四][☐ 五][☐ 六][☐ 日] │
│                                        │
│ 每月执行日 (仅每月)                    │
│ [1    ▼] 日                           │
│                                        │
│ 接收方式 *                             │
│ [☑ 邮件发送] [☑ 系统下载中心]         │
│                                        │
│ 接收邮箱 (邮件发送时)                  │
│ [admin@company.com          ]          │
│ [+ 添加邮箱]                           │
│                                        │
│ 导出格式                               │
│ [○ Excel (.xlsx)]                     │
│ [○ CSV (.csv)]                        │
│ [○ PDF (.pdf)]                        │
│                                        │
│ [○ 启用] [○ 禁用]                     │
│                                        │
│         [取消]    [保存]               │
│                                        │
└────────────────────────────────────────┘
```

**验证规则**:
| 字段 | 验证规则 | 错误提示 |
|------|----------|----------|
| 任务名称 | 必填，2-50 字符 | "请输入任务名称" |
| 报表类型 | 必选 | "请选择报表类型" |
| 执行频率 | 必选 | "请选择执行频率" |
| 接收邮箱 | 邮件发送时必填 | "请输入接收邮箱" |

---

### 5. 导出记录

**功能描述**: 查看和下载历史导出的报表文件

**用户角色**: Admin, Finance

**页面路径**: `/admin/reports` → 导出记录 Tab

#### 5.1 导出记录列表

**UI 组件**:
- **Table**: 导出记录表格
- **Button**: 下载按钮
- **DatePicker**: 日期筛选

**列表表格**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 导出记录                                                          │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│ 日期范围: [2025-12-01] - [2025-12-10]  报表类型: [全部 ▼] [查询] │
│                                                                  │
│ │文件名称              │报表类型│生成时间        │大小  │状态│操作│
│ ├──────────────────────┼────────┼────────────────┼──────┼────┼────┤
│ │交易报表_20251210.xlsx│交易    │12-10 06:00:00 │2.5MB │完成│[↓] │
│ │对账报表_20251209.xlsx│对账    │12-09 23:00:00 │1.2MB │完成│[↓] │
│ │统计分析_202512.pdf   │统计    │12-01 00:00:00 │850KB │完成│[↓] │
│ │交易报表_20251208.xlsx│交易    │12-08 06:00:00 │2.3MB │过期│[-] │
│ ...                                                              │
│                                                                  │
│ Pagination: [<] 1 2 3 [>]                                        │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

**表格列说明**:
| 列名 | 字段 | 说明 |
|------|------|------|
| 文件名称 | filename | 导出文件名 |
| 报表类型 | report_type | 报表类型 |
| 生成时间 | created_at | 生成时间 |
| 文件大小 | file_size | 文件大小 |
| 状态 | status | 完成/处理中/过期/失败 |
| 操作 | - | 下载、删除 |

**状态说明**:
| 状态 | 颜色 | 说明 | 可下载 |
|------|------|------|--------|
| processing | 蓝色 | 生成中 | 否 |
| completed | 绿色 | 已完成 | 是 |
| expired | 灰色 | 已过期（超过保留期限） | 否 |
| failed | 红色 | 生成失败 | 否 |

**文件保留策略**:
- 导出文件默认保留 7 天
- 超过保留期限的文件自动清理
- 可在系统设置中配置保留时长与最大导出条数（见 [系统设置 → 系统配置](./07-03-系统配置.md) 与 [系统设置 → 费率与限额配置](./07-06-费率与限额配置.md)），变更将影响新生成的导出任务。

---

## UI 组件列表

| 组件名称 | 类型 | 功能说明 |
|----------|------|----------|
| ReportFilter | Form | 报表筛选表单 |
| ReportSummary | Card | 数据汇总卡片组 |
| ReportTable | Table | 报表数据表格 |
| ReconcileProgress | Progress | 对账进度条 |
| DiffTable | Table | 差异列表表格 |
| TrendChart | Line | 趋势折线图 |
| DistributionPie | Pie | 分布饼图 |
| RankingBar | Bar | 排行柱状图 |
| ScheduleForm | Form | 定时任务配置表单 |
| ExportList | Table | 导出记录表格 |
| DownloadButton | Button | 文件下载按钮 |

---

## 状态与交互

### 页面状态

| 状态 | 描述 | UI 表现 |
|------|------|---------|
| Loading | 报表生成中 | 显示进度条和骨架屏 |
| Empty | 无数据 | 显示空状态提示 |
| Exporting | 导出中 | 按钮显示 Loading |
| Reconciling | 对账中 | 显示进度条 |

### 用户操作响应

| 操作 | 成功响应 | 失败响应 |
|------|----------|----------|
| 生成报表 | Toast "报表生成成功" | Alert 显示错误 |
| 导出报表 | 开始下载 | Alert 显示错误 |
| 创建定时任务 | Toast "任务创建成功" | Alert 显示错误 |
| 开始对账 | 显示进度条 | Alert 显示错误 |
| 处理差异 | Toast "差异已处理" | Alert 显示错误 |

---

## 权限控制

| 功能 | Admin | Finance |
|------|-------|---------|
| 查看交易报表 | ✓ | ✓ |
| 导出交易报表 | ✓ | ✓ |
| 查看对账报表 | ✓ | ✓ |
| 执行对账操作 | ✓ | - |
| 处理对账差异 | ✓ | - |
| 查看统计分析 | ✓ | ✓ |
| 配置定时报表 | ✓ | - |
| 查看导出记录 | ✓ | ✓ |
| 下载报表文件 | ✓ | ✓ |

---

## 导出格式说明

### 支持的导出格式

| 格式 | 扩展名 | 适用场景 |
|------|--------|----------|
| Excel | .xlsx | 数据分析、二次处理 |
| CSV | .csv | 系统导入、大数据量 |
| PDF | .pdf | 存档、打印、报告 |

### 导出内容规范

**Excel 报表结构**:
- Sheet 1: 报表汇总
- Sheet 2: 明细数据
- Sheet 3: 图表（如有）

**CSV 导出规范**:
- UTF-8 编码（带 BOM）
- 首行为表头
- 日期格式: YYYY-MM-DD HH:mm:ss
- 金额保留 8 位小数

**PDF 报表规范**:
- 公司 Logo 和报表标题
- 生成时间和操作人
- 分页和页码
- 汇总数据和关键图表

---

## 性能考虑

### 大数据量处理

1. **分页加载**: 报表数据分页展示，每页最多 100 条
2. **异步导出**: 大文件导出采用异步处理，完成后通知
3. **数据缓存**: 统计图表数据缓存 5 分钟
4. **日期限制**: 单次查询最长 90 天范围

### 导出限制

| 导出类型 | 最大记录数 | 预估时间 |
|----------|------------|----------|
| Excel | 100,000 条 | ~30 秒 |
| CSV | 500,000 条 | ~60 秒 |
| PDF | 10,000 条 | ~20 秒 |

---

> 返回 [后台管理前端目录](./README.md)
